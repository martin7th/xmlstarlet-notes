<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB">
<head>
  <meta charset="utf-8"/>
  <title>xmlstarlet usage notes</title>
  <link rel="stylesheet" href="index.css"/>
</head>
<body>

<section id="sec-xmlstarlet-usage-notes">
<h1 id="xmlstarlet-usage-notes" class="shew-tgt"><code>xmlstarlet</code> usage notes<a href="#xmlstarlet-usage-notes" class="permalink shew-hover"></a><div class="toolbar shew-hover h1"/></h1>
<div id="doc-version" title="15 August 2023">
version 2023-08-15 | <a href="news.html" title="Release news">news</a>
</div>
<div id="toc-short" class="nav">
<p><em>Short table of contents</em></p>
<ul>
<li><a href="#introduction">Introduction</a> | <a href="#documentation">Documentation</a> | <a href="#general-notes">General notes</a><sup><strong>*</strong></sup> | <a href="#global-options">Global options</a></li>
<li><a href="#elements"><code>elements</code></a> | <a href="#select"><code>select</code></a><sup><strong>*</strong></sup> | <a href="#edit"><code>edit</code></a><sup><strong>*</strong></sup> | <a href="#format"><code>format</code></a> | <a href="#c14n"><code>c14n</code></a> | <a href="#validate"><code>validate</code></a> | <a href="#pyx"><code>pyx</code>, <code>depyx</code></a> | <a href="#escape"><code>escape</code>, <code>unescape</code></a> | <a href="#list"><code>list</code></a> | <a href="#transform"><code>transform</code></a></li>
<li><a href="#namespaces">Namespaces</a> | <a href="#error-messages">Error messages</a> | <a href="#exslt">EXSLT</a><sup><strong>*</strong></sup> | <a href="#code-generation">Code generation</a><sup><strong>*</strong></sup><br/>
</li>
<li><a href="#appendix-a-xmlstarlet-xslt-extensions">A: XSLT extensions</a> | <a href="#appendix-b-xmlstarlet-news-summary">B: news summary</a> | <a href="#appendix-c-xmlstarlet-wishlist-ad-2003">C: wishlist AD 2003</a></li>
<li><a href="#toc">Table of contents</a> <span class="in-toc-cloud">[ <a href="#in-toc-select">sel</a> <a href="#in-toc-edit">ed</a> <a href="#in-toc-format">fo</a> <a href="#in-toc-c14n">c14n</a> <a href="#in-toc-validate">val</a> <a href="#in-toc-pyx">pyx</a> <a href="#in-toc-transform">tr</a> <a href="#in-toc-namespaces">xmlns</a> <a href="#in-toc-exslt">exslt</a>]</span></li>
</ul>
</div>
<section id="sec-introduction">
<h2 id="introduction" class="shew-tgt">Introduction<a href="#introduction" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#documentation"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p><code>xmlstarlet</code> (<a href="https://xmlstar.sourceforge.net/" title="xmlstarlet on SourceForge">xmlstar.sf.net</a>) is the no-nonsense XML multitool that lets you write simple queries or edits on the command line, avoids most of the stylesheet formal stuff, and gives your <code>&lt;o/&gt;&lt;o/&gt;</code>-looking eyes a moment of relief. It’s also a cranky minimalist tool which targets the 1.0 versions of XPath / XSLT / EXSLT still widely used and, it seems, users with little need for documentation.</p>
<p>This is an edited version of my personal notes on <code>xmlstarlet</code> with worked examples – knowledge gained as an outsider through use, trial and error – focusing on the <code>select</code> and <code>edit</code> commands and EXSLT. It’s not a tutorial or a FAQ, it requires a grasp of XML tools and the POSIX shell. Copyright is retained.</p>
<h4 id="xmlstarlet-features" class="shew-tgt"><code>xmlstarlet</code> features<a href="#xmlstarlet-features" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#introduction"></a><span class="relnop shew-hover"></span></div></h4>
<ul>
<li><code>xmlstarlet</code> relies on <code>libxml2</code> and <code>libxslt</code> which are limited to XPath 1.0 and XSLT 1.0, plus a number of EXSLT and extension functions</li>
<li><code>xmlstarlet</code> is currently at version 1.6.1 which appeared in 2014 (that’s more or less a century ago in internet years); a number of <code>FIXME</code>s and <code>TODO</code>s remain in the source code</li>
<li><code>xmlstarlet select</code> supports XPath 1.0, a subset of XSLT 1.0 (but not <code>xsl:apply-templates</code>, <code>xsl:key</code> a.o.), and EXSLT</li>
<li><code>xmlstarlet edit</code> supports XPath 1.0 – plus some EXSLT but no XSLT – functions in its <code>xpath</code> arguments</li>
<li><code>xmlstarlet transform</code> is a regular XSLT 1.0 processor with extensions, like <code>xsltproc</code></li>
<li>additional <code>xmlstarlet</code> commands do document formatting, canonicalization, validation, structure display, conversion of PYX and special characters, and file directory listing</li>
<li>string handling is an XPath 1.0 weakness, not improved by the lack of EXSLT regular expressions</li>
<li>memory requirements: <q>There should be no limit on input XML (apart from available memory on your system)</q> – forum <a href="https://sourceforge.net/p/xmlstar/discussion/226076/thread/1c0bb811/">posting</a> by the original <code>xmlstarlet</code> developer</li>
<li>rights: <code>xmlstarlet</code> is <q>Copyright (c) 2002-2004 Mikhail Grushinskiy. All Rights Reserved.</q> (cf. <a href="https://sourceforge.net/p/xmlstar/code/ci/master/tree/COPYING" title="`xmlstarlet` on SourceForge">SourceForge</a> or <a href="https://fossies.org/linux/xmlstarlet/COPYING" title="Fossies - the Fresh Open Source Software Archive">Fossies</a>)</li>
</ul>
<h4 id="notation-used-in-this-document" class="shew-tgt">Notation used in this document<a href="#notation-used-in-this-document" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#introduction"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-q (--quiet)</code> means either short option <code>-q</code> or long option <code>--quiet</code> can be used.</p>
<p><code>«name»</code> in a command or message is a placeholder for the actual name used, e.g. <code>xmlXPathCompOpEval: function «name» not found</code>.</p>
<p>Links look like this: <a href="https://xmlstar.sourceforge.net/doc/UG/">external</a>, <a href="#notation-used-in-this-document">internal</a>, internal <a class="link-cloud-ref" href="#toc-short">link</a> appearing in a navigation link cloud, <a class="link-cloud-ref" href="#toc-edit">ditto</a><sup><strong>*</strong></sup> linking to a larger section with a local link cloud, <span class="in-toc-cloud">[ <a href="#in-toc-select">sel</a> ]</span> linking into the table of contents. On mouseover headers display a permalink icon, on level 2 and 3 also navigation link icons, on level 4 a section link icon.</p>
<p>Code looks like this: <code>test -s file.xml || log …</code>, occasionally with an <code>…</code> (ellipsis) inside for brevity. For readability longer commands are usually <a href="#one-lining">split</a> across lines and indented.</p>
<p>Admonitions look like this: <span class="caution"><strong>Caution</strong></span>.</p>
<p>All shell code samples were made for a POSIX shell (<code>dash</code> 0.5.10) with <code>xmlstarlet</code> 1.6.1 (linked with libxml2 20913, libxslt 10134, and libexslt 820) from the <a href="https://packages.debian.org/unstable/text/xmlstarlet">Debian</a> distribution.</p>
<h4 id="a-word-about-stylesheet-syntax" class="shew-tgt">A word about stylesheet syntax<a href="#a-word-about-stylesheet-syntax" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#introduction"></a><span class="relnop shew-hover"></span></div></h4>
<blockquote>
<p>[T]he use of SGML syntax for stylesheets was proposed as long ago as 1994, and it seems that this idea gradually became the accepted wisdom. It’s difficult to trace exactly what the overriding arguments were, and when you find yourself writing something like:</p>
<pre class="lang-xsl"><code>    &lt;xsl:variable name="y"&gt;
      &lt;xsl:call-template name="f"&gt;
        &lt;xsl:with-param name="x"/&gt;
      &lt;/xsl:call-template&gt;
    &lt;/xsl:variable&gt;</code></pre>
<p>to express what in other languages would be written as <code>y = f(x);</code>, then you may find yourself wondering how such a decision came to be made.</p>
</blockquote>
<p>– Michael Kay, <em>XSLT Programmer’s Reference</em>, Ch.1, ISBN 1861005067</p>
</section>
<section id="sec-documentation">
<h2 id="documentation" class="shew-tgt">Documentation<a href="#documentation" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#introduction"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#xmlstarlet-commands"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<h4 id="users-guide-examples-source-code-forums" class="shew-tgt">User’s guide, examples, source code, forums<a href="#users-guide-examples-source-code-forums" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#documentation"></a><span class="relnop shew-hover"></span></div></h4>
<ul>
<li><code>man xmlstarlet</code><br/>
<code>xmlstarlet --help</code><br/>
<code>xmlstarlet «command-name» --help</code></li>
<li><code>xmlstarlet</code> on SourceForge: <a href="https://xmlstar.sourceforge.net/">homepage</a> | <a href="https://xmlstar.sourceforge.net/docs.php">docs</a> | <a href="https://xmlstar.sourceforge.net/doc/UG/">user’s guide</a> | <a href="https://sourceforge.net/p/xmlstar/news/">news</a> | <a href="https://xmlstar.sourceforge.net/source.php">source</a> | <a href="https://sourceforge.net/projects/xmlstar/files/xmlstarlet/">files</a> | <a href="https://sourceforge.net/p/xmlstar/discussion/">discussion</a> | <a href="https://sourceforge.net/p/xmlstar/bugs/">bugs</a><br/>
<span class="caution"><strong>Caution</strong></span>: the <a href="https://xmlstar.sourceforge.net/doc/xmlstarlet.txt"><code>doc/xmlstarlet.txt</code></a> there is not the latest version as it doesn’t mention <a href="#edit-prev"><code>$prev</code></a>, <a href="#edit-opt-var"><code>--var</code></a>, <a href="#edit-opt-inplace"><code>-L (--inplace)</code></a>, and <a href="#transform-opt-embed"><code>-E (--embed)</code></a> – the user’s guide is still silent on these</li>
<li><code>xmlstarlet</code> on <a href="https://fossies.org/about.html" title="Fossies - Fresh Open Source Software mainly for Internet, Engineering and Science">Fossies</a> – an accessible presentation of source, examples, and more:<br/>
<a href="https://fossies.org/linux/www/xmlstarlet"><code>xmlstarlet-1.6.1.tar.gz</code></a> contents | <a href="https://fossies.org/linux/xmlstarlet/doc/xmlstarlet-ug.html"><code>xmlstarlet</code> user’s guide</a> (1-page) | <a href="https://fossies.org/linux/xmlstarlet/doc/xmlstarlet.txt"><code>doc/xmlstarlet.txt</code></a> (latest version)</li>
<li><code>xmlstarlet</code> forums on StackExchange: <a href="https://stackoverflow.com/questions/tagged/xmlstarlet">stackoverflow.com</a> | <a href="https://unix.stackexchange.com/questions/tagged/xmlstarlet">unix.stackexchange.com</a></li>
</ul>
<h4 id="selected-resources" class="shew-tgt">Selected resources<a href="#selected-resources" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#documentation"></a><span class="relnop shew-hover"></span></div></h4>
<ul>
<li>W3C: <a href="https://www.w3.org/TR/xpath/">XPath cover page</a> | <a href="https://www.w3.org/TR/xslt/">XSLT cover page</a></li>
<li><code>github.io</code>: <a href="https://exslt.github.io/">EXSLT docs</a></li>
<li><code>gnome.org</code>: <a href="https://gitlab.gnome.org/GNOME/libxml2/-/wikis/home" title="'libxml2 Wiki Home' on gitlab.gnome.org">libxml2 Wiki Home</a> (with links to standards, API, utilities a.o.) | <a href="https://gitlab.gnome.org/GNOME/libxml2" title="libxml2 'XML parser and toolkit' source code on gitlab.gnome.org">libxml2 source</a> | <a href="https://gitlab.gnome.org/GNOME/libxslt/-/wikis/home" title="'libxslt Wiki Home' on gitlab.gnome.org">libxslt Wiki Home</a> (with links to XSLT + EXSLT API a.o.) | <a href="https://gitlab.gnome.org/GNOME/libxslt" title="libxslt 'XSLT processor' source code on gitlab.gnome.org">libxslt+libexslt source</a> | <a href="https://gitlab.gnome.org/GNOME/libxslt/-/wikis/Writing-extensions" title="Writing extensions">libxslt extensions</a><br/>
(<code>xmlsoft.org</code> now redirects to <code>gnome.org</code>)</li>
<li><code>packages.debian.org</code>: <a href="https://packages.debian.org/bullseye/xmlstarlet" title="command line XML toolkit">text/xmlstarlet</a> | <a href="https://packages.debian.org/bullseye/xsltproc" title="XSLT 1.0 command line processor">text/xsltproc</a> | <a href="https://packages.debian.org/bullseye/libxml2-utils" title="GNOME XML library - utilities">text/libxml2-utils</a> (<code>xmllint</code>) | <a href="https://packages.debian.org/bullseye/html-xml-utils" title="HTML and XML manipulation utilities">text/html-xml-utils</a> | <a href="https://packages.debian.org/bullseye/xml2" title="Convert between XML, HTML, CSV and a line-oriented format">utils/xml2</a> | <a href="https://packages.debian.org/bullseye/tidy" title="HTML/XML syntax checker and reformatter">web/tidy</a></li>
<li><code>stackoverflow.com</code> forums: <a href="https://stackoverflow.com/tags/xpath">XPath</a> | <a href="https://stackoverflow.com/tags/xslt-1.0">XSLT 1.0</a> | <a href="https://stackoverflow.com/tags/exslt">EXSLT</a> | <a href="https://stackoverflow.com/tags/xml">XML</a></li>
</ul>
<h4 id="list-the-generated-xslt-xmlstarlet-select--c" class="shew-tgt">List the generated XSLT: <code>xmlstarlet select -C</code><a href="#list-the-generated-xslt-xmlstarlet-select--c" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#documentation"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>select</code>’s <a href="#select-opt-comp"><code>-C (--comp)</code></a> option lists the stylesheet the current command line will generate – it requires no input file – e.g. </p>
<pre class="lang-sh"><code>xmlstarlet select -T -C -t -m 'str:tokenize("Hello, world",",o")' -v '.' -n</code></pre>
<p>Output:</p>
<pre class="lang-xsl"><code>&lt;?xml version="1.0"?&gt;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:str="http://exslt.org/strings" xmlns:exslt="http://exslt.org/common" version="1.0" extension-element-prefixes="exslt str"&gt;
  &lt;xsl:output omit-xml-declaration="yes" indent="no" method="text"/&gt;
  &lt;xsl:template match="/"&gt;
    &lt;xsl:for-each select="str:tokenize(&amp;quot;Hello, world&amp;quot;,&amp;quot;,o&amp;quot;)"&gt;
      &lt;xsl:call-template name="value-of-template"&gt;
        &lt;xsl:with-param name="select" select="."/&gt;
      &lt;/xsl:call-template&gt;
      &lt;xsl:value-of select="'&amp;#10;'"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template name="value-of-template"&gt;
    &lt;xsl:param name="select"/&gt;
    &lt;xsl:value-of select="$select"/&gt;
    &lt;xsl:for-each select="exslt:node-set($select)[position()&amp;gt;1]"&gt;
      &lt;xsl:value-of select="'&amp;#10;'"/&gt;
      &lt;xsl:value-of select="."/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</code></pre>
</section>
<section id="sec-commands">
<h2 id="xmlstarlet-commands" class="shew-tgt"><code>xmlstarlet</code> commands<a href="#xmlstarlet-commands" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#documentation"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#elements"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<h3 id="general-notes" class="shew-tgt">General notes<a href="#general-notes" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#xmlstarlet-commands"></a><a class="relnext shew-hover" href="#global-options"></a><span class="relnop shew-hover"></span></div></h3>
<p><span class="caution"><strong>Caution</strong></span>: <q>Other features need some work too</q> warns the <a href="https://xmlstar.sourceforge.net/doc/UG/ch01.html">user’s guide</a>.</p>
<p>Perhaps they’re thinking of these:</p>
<ul>
<li><code>edit</code>’s <a href="#no-kidding-issue">“no kidding” issue</a></li>
<li><a href="#xml-external-entities">external entity</a> issues</li>
<li><code>select</code>’s <a href="#select-exslt-namespace-issue">EXSLT namespace issue</a></li>
<li><code>pyx</code> and <code>depyx</code>’ <a href="#pyx">several issues</a></li>
<li>invalid command-line options are not flagged for <a href="#select"><code>select</code></a>, <a href="#c14n"><code>c14n</code></a>, and <a href="#transform"><code>transform</code></a> while <a href="#edit"><code>edit</code></a> returns non-zero printing nothing but its lengthy usage reminder</li>
<li>the user’s guide</li>
</ul>
<div class="dinkus1">

</div>
<div id="toc-general-notes" class="nav">
<ul>
<li><a href="#special-characters">Special characters</a> | <a href="#xml-declaration">XML declaration</a> | <a href="#xml-parsing-and-serialization">XML parsing and serialization</a> | <a href="#xml-external-entities">XML external entities</a><br/>
| <a href="#exit-values">Exit values</a> | <a href="#numeric-representation">Numeric representation</a> | <a href="#one-lining">One-lining</a> | <a href="#makefile-notes-gnu-make">makefile notes</a></li>
</ul>
</div>
<h4 id="special-characters" class="shew-tgt">Special characters<a href="#special-characters" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>The special XML characters are <code>&amp;&lt;&gt;'"</code> or – as references to <em>predefined general entities</em> – <code>&amp;amp;</code> <code>&amp;lt;</code> <code>&amp;gt;</code> <code>&amp;apos;</code> <code>&amp;quot;</code>. With few exceptions<sup>[1]</sup> they are never entered as entity references in an <code>xmlstarlet</code> command, and they are output as literals when <code>xmlstarlet select</code>’s <a href="#select-opt-text"><code>-T (--text)</code></a> option is in effect.</p>
<p>For example, in XPath predicates <code>xmlstarlet</code> wants <code>&lt;</code> (less-than) on the command line, as in <code>factor[. &lt; 2.19]</code>, whereas XSLT stylesheets require <code>&amp;lt;</code> inside attribute values, or <code>&gt;</code> (greater-than) with operands swopped. Likewise, a numeric character reference such as <code>&amp;#9;</code> for a tab character belongs in an XML file, not on the <code>xmlstarlet</code> command line.</p>
<div class="enhanced">
<p><sup>[1]</sup> <em>Exceptions</em></p>
<p>The predefined entity ref:s – as well as character ref:s below <code>&amp;#x100;</code> – are recognized in the following which therefore require <code>&amp;amp;</code> to represent an <code>&amp;</code> (ampersand) character:</p>
<ul>
<li>the <code>-v (--value)</code> clause of <code>xmlstarlet edit</code>’s <a href="#edit-opt-insert"><code>-i (--insert)</code></a>, <a href="#edit-opt-append"><code>-a (--append)</code></a>, and <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a> options <em>when used with</em> <code>-t (--type) elem</code></li>
<li>the input to the <a href="#escape"><code>xmlstarlet unescape</code></a> conversion utility</li>
</ul>
</div>
<p><span class="caution"><strong>Caution</strong></span>: The example in the user’s guide section <a href="https://xmlstar.sourceforge.net/doc/UG/ch04.html#idm47989546279904">4.1</a> meant to convert newlines to blanks using a character reference for the newline – <code>xml sel … -v "translate(. , '&amp;#10;', ' ')" …</code> – in fact converts <code>&amp;</code> (ampersand) characters to blanks, and strips <code>#</code>, <code>1</code>, <code>0</code>, and <code>;</code> characters. The <code>translate(…)</code> expression would work as intended in an XSLT stylesheet but <em>means something rather different</em> on the <code>xmlstarlet select</code> command line.</p>
<p><em>See also</em>: <a href="#escape"><code>xmlstarlet esc</code> / <code>xmlstarlet unesc</code></a> | <a href="#replace-text">Replace text</a> sample</p>
<div class="dinkus2">

</div>
<p><code>xmlstarlet edit</code> handling special characters:</p>
<pre class="lang-sh"><code>printf '%s' '&lt;e/&gt;'|
xmlstarlet edit -O \
  -s     '*' -t elem -n esuv -v '' -u '$prev' -v '&amp;Save as &lt;.oona&gt;' \
  -a '$prev' -t elem -n eaux -v '' -u '$prev' -x '"&amp;Save as &lt;.oona&gt;"' \
  -s     '*' -t elem -n esv1 -v '&amp;amp;Save as &lt;.oona&gt;' \
  -a '$prev' -t elem -n eav1 -v '&amp;amp;Save&amp;#x20;&amp;#x61;&amp;#x73;&amp;#x20;&amp;lt;.oona&amp;gt;' \
  -i '$prev' -t elem -n eiv1 -v "$(xmlstarlet escape '&amp;Save as &lt;.oona&gt;')"</code></pre>
<ul>
<li><a href="#edit-opt-update-value"><code>-u (--update)</code></a> follows <code>xmlstarlet</code>’s general rule for a literal (<code>esuv</code>) or an XPath expression (<code>eaux</code>): special characters are encoded behind the scenes</li>
<li><a href="#edit-opt-insert"><code>-i (--insert)</code></a>, <a href="#edit-opt-append"><code>-a (--append)</code></a>, and <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a> used with <code>-t (--type) elem</code> are special: certain entity/character ref:s are recognized so <code>&amp;amp;</code> is required for <code>&amp;</code> (<code>esv1</code>, <code>eav1</code>, <code>eiv1</code>) whereas <code>&lt;&gt;'"</code> may be used to represent themselves</li>
<li><code>-i</code>, <code>-a</code>, <code>-s</code>, and <a href="#edit-opt-rename"><code>-r (--rename)</code></a> accept their name argument without modification</li>
</ul>
<p>Output:</p>
<pre class="lang-none"><code>&lt;e&gt;
  &lt;esuv&gt;&amp;amp;Save as &amp;lt;.oona&amp;gt;&lt;/esuv&gt;
  &lt;eaux&gt;&amp;amp;Save as &amp;lt;.oona&amp;gt;&lt;/eaux&gt;
  &lt;esv1&gt;&amp;amp;Save as &amp;lt;.oona&amp;gt;&lt;/esv1&gt;
  &lt;eiv1&gt;&amp;amp;Save as &amp;lt;.oona&amp;gt;&lt;/eiv1&gt;
  &lt;eav1&gt;&amp;amp;Save as &amp;lt;.oona&amp;gt;&lt;/eav1&gt;
&lt;/e&gt;</code></pre>
<div class="dinkus2">

</div>
<p>Using variables with <code>xmlstarlet select</code>, e.g. </p>
<ul>
<li><code>--var newline -n -b</code></li>
<li><code>--var tab -o "$(printf '\t')" -b</code></li>
<li><code>--var sq -o "'" -b</code> … <code>-v 'concat($sq,"//_:",local-name(),$sq)'</code></li>
<li><code>--var eurosign='"€"'</code></li>
<li><code>--var eurosign -o "$(python3 -c 'print("{0:c}".format(0x20ac))')" -b</code></li>
</ul>
<p>Using variables with <code>xmlstarlet edit</code>, e.g.</p>
<ul>
<li><code>--var sq '"'\''"'</code></li>
<li><code>--var dq "'\"'"</code></li>
<li>outer double quotes to delimit tab and enable <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06" title="Shell command language at Open Group (POSIX)"><em>shell word expansions</em></a>, single quotes to delimit the <code>printf</code> argument, and inner double quotes to make an XPath string expression<br/>
<code>--var tab "$(printf '"\t"')"</code></li>
<li>a literal tab works too but is easily lost in translation<br/>
<code>--var tab '"	"'</code></li>
<li>newline<br/>
<code>--var nl 'substring-before('"$(printf '"\nA"')"',"A")'</code></li>
</ul>
<p><em>See also</em>: <a href="#select-opt-var-equals"><code>select</code> <code>--var</code></a> | <a href="#edit-opt-var"><code>edit</code> <code>--var</code></a></p>
<h4 id="xml-declaration" class="shew-tgt">XML declaration<a href="#xml-declaration" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>The various <code>xmlstarlet</code> commands each handle the XML declaration in their own way but all print it with a trailing newline if requested:</p>
<ul>
<li><code>xmlstarlet edit … -O (--omit-decl) …</code></li>
<li><code>xmlstarlet format … -o (--omit-decl) …</code></li>
<li><code>xmlstarlet list</code> never outputs an XML declaration</li>
<li><code>xmlstarlet pyx</code> always strips the XML declaration if present</li>
<li><code>xmlstarlet select … -D (--xml-decl) …</code> outputs an XML declaration</li>
<li><code>xmlstarlet transform … --omit-decl …</code></li>
</ul>
<p>Adding an XML declaration using <code>select</code>:</p>
<pre class="lang-shell"><code>$ printf '&lt;v w="x"/&gt;' |
  xmlstarlet select -D -E 'ISO-8859-2' -t -c '/'
&lt;?xml version="1.0" encoding="ISO-8859-2"?&gt;
&lt;v w="x"/&gt;</code></pre>
<h4 id="xml-parsing-and-serialization" class="shew-tgt">XML parsing and serialization<a href="#xml-parsing-and-serialization" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>Several <code>xmlstarlet</code> commands allow selected options to be passed to the <a href="#selected-resources"><code>libxml2</code></a> XML parser (cf. <a href="https://gnome.pages.gitlab.gnome.org/libxml2/devhelp/libxml2-parser.html">API reference</a> and <a href="https://gitlab.gnome.org/GNOME/libxml2/-/blob/master/parser.c">source code</a>) or the <a href="#selected-resources"><code>libxml2</code></a> XML serializer (cf. <a href="https://gnome.pages.gitlab.gnome.org/libxml2/devhelp/libxml2-xmlsave.html">API reference</a> and <a href="https://gitlab.gnome.org/GNOME/libxml2/-/blob/master/xmlsave.c">source code</a>).</p>
<ul>
<li><a href="#select"><code>select</code></a>
<ul>
<li><a href="#select-opt-net"><code>--net</code></a>: clears <code>XML_PARSE_NONET</code></li>
<li><a href="#select-opt-noblanks"><code>-B (--noblanks)</code></a>: sets <code>XML_PARSE_NOBLANKS</code></li>
<li><a href="#select-opt-xml-decl"><code>-D (--xml-decl)</code></a>: clears <code>XML_SAVE_NO_DECL</code>; sets <code>omit-xml-declaration="no"</code> on <code>xsl:output</code></li>
<li><a href="#select-opt-indent"><code>-I (--indent)</code></a>: sets <code>XML_SAVE_FORMAT</code>; sets <code>indent="yes"</code> on <code>xsl:output</code></li>
<li><a href="#select-opt-text"><code>-T (--text)</code></a>: sets <code>method="text"</code> on <code>xsl:output</code></li>
</ul></li>
<li><a href="#edit"><code>edit</code></a>
<ul>
<li><a href="#edit-opt-net"><code>--net</code></a>: clears <code>XML_PARSE_NONET</code></li>
<li><a href="#edit-opt-omit-decl"><code>-O (--omit-decl)</code></a>: sets <code>XML_SAVE_NO_DECL</code></li>
<li><a href="#edit-opt-pf"><code>-P (--pf)</code></a>: sets <code>XML_SAVE_FORMAT</code></li>
<li><a href="#edit-opt-ps"><code>-S (--ps)</code></a>: sets <code>XML_SAVE_WSNONSIG</code> (requires <code>libxml2</code> 2.7.8+)</li>
</ul></li>
<li><a href="#format"><code>format</code></a>
<ul>
<li><a href="#format-opt-net"><code>--net</code></a>: clears <code>XML_PARSE_NONET</code></li>
<li><a href="#format-opt-nocdata"><code>-C (--nocdata)</code></a>: sets <code>XML_PARSE_NOCDATA</code></li>
<li><a href="#format-opt-nsclean"><code>-N (--nsclean)</code></a>: sets <code>XML_PARSE_NSCLEAN</code></li>
<li><a href="#format-opt-recover"><code>-R (--recover)</code></a>: sets <code>XML_PARSE_RECOVER</code></li>
<li><a href="#format-opt-omit-decl"><code>-o (--omit-decl)</code></a>: sets <code>XML_SAVE_NO_DECL</code></li>
<li><a href="#format-opt-noindent"><code>-n (--noindent)</code></a>, <a href="#format-opt-indent-spaces"><code>-s (--indent-spaces)</code></a>, and <a href="#format-opt-indent-tab"><code>-t (--indent-tab)</code></a> offer an alternative to the default indentation</li>
</ul></li>
<li><a href="#c14n"><code>c14n</code></a>
<ul>
<li><a href="#c14n-opt-net"><code>--net</code></a>: clears <code>XML_PARSE_NONET</code></li>
</ul></li>
<li><a href="#validate"><code>validate</code></a>
<ul>
<li><a href="#validate-opt-net"><code>--net</code></a>: clears <code>XML_PARSE_NONET</code></li>
<li><a href="#validate-opt-embed"><code>-E (--embed)</code></a>: sets <code>XML_PARSE_DTDVALID</code></li>
<li><code>XML_PARSE_DTDLOAD</code> and <code>XML_PARSE_DTDATTR</code> are set by default (<a href="https://fossies.org/linux/xmlstarlet/src/xml_validate.c#l_292">src/validate.c#valMain()</a>)</li>
</ul></li>
<li><a href="#transform"><code>transform</code></a>
<ul>
<li><a href="#transform-opt-net"><code>--net</code></a>: clears <code>XML_PARSE_NONET</code></li>
<li><a href="#transform-opt-omit-decl"><code>--omit-decl</code></a>: sets <code>XML_SAVE_NO_DECL</code></li>
</ul></li>
</ul>
<p><code>format</code>’s <a href="#format-opt-html"><code>-H (--html)</code></a> and <code>transform</code>’s <a href="#transform-opt-html"><code>--html</code></a> options substitute the <a href="#selected-resources"><code>libxml2</code></a> HTML 4.0 parser.</p>
<p>The <a href="#c14n"><code>c14n</code></a> command converts an XML document to a normal format.</p>
<p>To expand empty-element tags, changing <code>&lt;p/&gt;</code> to <code>&lt;p&gt;&lt;/p&gt;</code>, for example:</p>
<pre class="lang-sh"><code>xmlstarlet edit --pf -s '//*[not(node())]' -t text -n ignored -v '' file.xml</code></pre>
<p><em>See also</em>: <a href="#global-opt-net">network access</a> | <a href="#try-out-xmlstarlet-edits-formatting-options">Try out <code>edit</code>’s formatting options</a> example</p>
<div class="dinkus2">

</div>
<p>The <code>xmlEscapeEntities</code> function in <a href="#selected-resources"><code>libxml2</code></a>’s <a href="https://gitlab.gnome.org/GNOME/libxml2/-/blob/master/xmlsave.c#L165"><code>xmlsave.c</code></a> serialization module gives special treatment to characters <code>&amp;&lt;&gt;</code> (output as <code>&amp;amp;</code>, <code>&amp;lt;</code>, and <code>&amp;gt;</code>) but neither apostrophe nor double quote (<code>'"</code>). <code>xmlstarlet</code> has no option to override this.</p>
<div class="dinkus2">

</div>
<p>Using a CDATA section to keep the serializer from applying default rules:</p>
<pre class="lang-shell"><code>$ printf '%s\n' '&lt;v&gt;&lt;w&gt;x&lt;/w&gt;&lt;x&gt;🧩&lt;/x&gt;&lt;/v&gt;' |
  xmlstarlet edit -O -P -d '*/w'
&lt;v&gt;&lt;x&gt;&amp;#x1F9E9;&lt;/x&gt;&lt;/v&gt;
$ :
$ printf '%s\n' '&lt;v&gt;&lt;w&gt;x&lt;/w&gt;&lt;x&gt;&lt;![CDATA[🧩]]&gt;&lt;/x&gt;&lt;/v&gt;' |
  xmlstarlet edit -O -P -d '*/w'
&lt;v&gt;&lt;x&gt;&lt;![CDATA[🧩]]&gt;&lt;/x&gt;&lt;/v&gt;</code></pre>
<h4 id="xml-external-entities" class="shew-tgt">XML external entities<a href="#xml-external-entities" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p><span class="caution"><strong>Caution</strong></span>: Of <code>xmlstarlet</code>’s commands only <a href="#c14n"><code>c14n</code></a>, <a href="#select"><code>select</code></a>, and <a href="#transform"><code>transform</code></a> seem to understand an entity reference like <code>&lt;doc&gt;&amp;e;&lt;/doc&gt;</code>, according to the following test script. This makes pre/post-processing a requirement if using <code>xmlstarlet</code>’s other commands to handle external entities.</p>
<pre class="lang-sh"><code>#!/bin/sh
# Test xmlstarlet commands with external general parsed entity.
# - ${xdata} holds data file contents, defaults to a few &lt;e&gt;N&lt;/e&gt;
# - ${keepf} non-empty to keep temporary files in $TMPDIR
# - ${dryrun} non-empty to print but not execute commands
# - ${doecho} non-empty to also print commands before executing

skelf=$(mktemp -t "xsskel-$$-XXXXXXXXXX.xml")
dataf=$(mktemp -t "xsdata-$$-XXXXXXXXXX.xml")
idxff=$(mktemp -t "xsidxf-$$-XXXXXXXXXX.xsl")
test "${keepf}" ||
    trap "rm '${skelf}' '${dataf}' '${idxff}'" INT EXIT

printf '%s\n' \
  '&lt;!DOCTYPE skel [&lt;!ENTITY e SYSTEM "'"${dataf}"'"&gt;]&gt;&lt;doc&gt;&amp;e;&lt;/doc&gt;' \
&gt; "${skelf}"
printf '%s' \
  "${xdata:-&lt;e&gt;1&lt;/e&gt;&lt;e&gt;2&lt;/e&gt;&lt;e&gt;3&lt;/e&gt;&lt;e&gt;4&lt;/e&gt;}" \
&gt; "${dataf}"
printf '&lt;v/&gt;' | xmlstarlet select -t \
 -e xsl:transform -a version -o 1.0 -b \
 -e xsl:template -a match -o '@*|node()' -b \
   -e xsl:copy -e xsl:apply-templates -a select -o '@*|node()' \
&gt; "${idxff}"    ## identity transform

for cmd  in  c14n ed el fo pyx sel tr val
do
  case ${cmd} in
    (c14n|el|fo|pyx|val)
            set -- ;;
    (ed)    set -- -d '*/*[3]' ;;
    (sel)   set -- -T -t -c / -n ;;
    (tr)    set -- "${idxff}" ;;
    (*)     break ;;
  esac
  set -- xmlstarlet "${cmd}" "$@" "${skelf}"
  if test "${dryrun}${doecho}"; then
    printf '\n\n# command:'; printf " '%s'" "$@"; printf '\n'
  fi
  if ! test "${dryrun}"; then
    "$@"; printf '\n## %s returned %d\n\n' "${cmd}" "$?"
  fi
done</code></pre>
<p>Given a data file containing <code>&lt;e&gt;1&lt;/e&gt;&lt;e&gt;2&lt;/e&gt;&lt;e&gt;3&lt;/e&gt;&lt;e&gt;4&lt;/e&gt;</code> (making it well-formed XML) <code>pyx</code> returns 4 (outputs the doctype but says <code>Entity 'e' not defined</code>) while <code>c14n</code>, <code>ed</code>, <code>el</code>, <code>fo</code>, <code>sel</code>, <code>tr</code>, and <code>val</code> all return zero. But <code>ed</code>, <code>el</code>, and <code>fo</code> (plus <code>val</code>, presumably) fail to expand the entity reference.</p>
<p>Given a data file containing <code>&lt;a&gt;B&lt;/c&gt;</code> (clearly making it non-XML) the <code>ed</code>, <code>el</code>, and <code>val</code> commands all return zero – and <code>val</code> even pronouncing <code>«datafile» - valid</code> – while <code>c14n</code>, <code>fo</code>, <code>pyx</code>, <code>sel</code>, and <code>tr</code> <a href="#exit-values">return</a> 3, 2, 4, 3, and 6, respectively.</p>
<p><code>xmllint</code> from the <a href="#selected-resources"><code>libxml2-utils</code></a> package has a <code>--noent</code> option to substitute entity values for entity references (e.g. <code>xmllint --noent --dropdtd file.xml</code>).</p>
<h4 id="exit-values" class="shew-tgt">Exit values<a href="#exit-values" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p><a href="https://fossies.org/linux/xmlstarlet/src/xmlstar.h#l_19">src/xmlstar.h</a> defines the following exit values for <code>xmlstarlet</code>:</p>
<ul>
<li>0 <code>EXIT_SUCCESS</code></li>
<li>1 <code>EXIT_FAILURE</code></li>
<li>2 <code>EXIT_BAD_ARGS</code></li>
<li>3 <code>EXIT_BAD_FILE</code></li>
<li>4 <code>EXIT_LIB_ERROR</code></li>
<li>5 <code>EXIT_INTERNAL_ERROR</code></li>
</ul>
<p>but mind these:</p>
<ul>
<li><code>xmlstarlet select</code> <a href="#select">exits</a> <code>grep</code>-style returning the query result as 0 or 1</li>
<li><code>xmlstarlet format</code>’s <a href="#format-opt-omit-decl"><code>--omit-decl</code></a> option exits, er, <code>shuf</code>-style</li>
<li>handling <a href="#xml-external-entities">external entities</a></li>
<li>exit value zero doesn’t mean there were no errors (e.g.  <a href="#use-the-document-function"><code>document()</code></a> failure, <a href="#escape">unescape</a> – both producing <code>stderr</code> output)</li>
</ul>
<h4 id="numeric-representation" class="shew-tgt">Numeric representation<a href="#numeric-representation" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>XPath 1.0 does not support numbers expressed in <a href="https://en.wikipedia.org/wiki/Scientific_notation" title="Article on Wikipedia">scientific notation</a>, cf. <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#NT-Number" title="NT-Number - W3C XPath 1.0 recommendation">W3C recommendation</a> (<code>Number ::= Digits ('.' Digits?)? | '.' Digits</code> and <code>Digits ::= [0-9]+</code>).</p>
<p>Tools based on <a href="#selected-resources"><code>libxml2</code></a> do support it, however, cf.  <a href="https://gitlab.gnome.org/GNOME/libxml2/-/blob/master/xpath.c#L3158" title="xpath.c on gitlab.gnome.org"><code>xmlXPathFormatNumber()</code></a> (<code>snprintf(work, sizeof(work),"%*.*e", integer_place, fraction_place, number);</code>).</p>
<p>Here are a few examples of <code>libxml2</code> handling XPath computations – and <code>libxslt</code> handling the XSLT <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-format-number" title="W3C XSLT 1.0 recommendation"><code>format-number()</code></a> function.</p>
<pre class="lang-xml"><code>printf '%s\n' '&lt;v&gt;1240057409536&lt;/v&gt;' |
xmlstarlet select -T -t \
  -v '*' -n \
  -v '0 + *' -n \
  -v '* div 1' -n \
  -v '* div 1000 * 1E3' -n \
  -v '* div 1.240057409536e+12' -n \
  -o '---' -n \
  -v 'round(* div 1)' -n \
  -v 'round(* div 10)' -n \
  -v 'round(* div 100)' -n \
  -v 'round(* div 1000)' -n \
  -o '---' -n \
  -v 'format-number(* div 1,"#")' -n \
  -v 'format-number(* div 1,"#,###")' -n</code></pre>
<p>Output:</p>
<pre class="lang-xml"><code>1240057409536
1.240057409536e+12
1.240057409536e+12
1.240057409536e+12
1
---
1.240057409536e+12
1.24005740954e+11
1.2400574095e+10
1240057410
---
1240057409536
1,240,057,409,536</code></pre>
<h4 id="one-lining" class="shew-tgt">One-lining<a href="#one-lining" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>In this document longer commands are usually split across lines and indented, like this:</p>
<pre class="lang-sh"><code>xmlstarlet select -T -t \
  --var sq -o "'" -b \
  -o 'xmlstarlet edit --omit-decl '\\ -n \
  -o "  --var N 'Names/Name' \\" -n \
  -m '*/*' \
    -o '  -r ' -v 'concat($sq,"$N[",position(),"]",$sq)' \
    -o '  -v ' -v 'concat($sq,name(),format-number(position(),"0000"),$sq)' -o ' '\\ -n \
  -b \
  -f -n \
"${infile:-file.xml}"</code></pre>
<p>To strip such a command of line continuation characters and leading whitespace pipe it through following <code>sed</code> command (changing one line, not an entire shell script),</p>
<pre class="lang-sh"><code>sed -e ':1' -e 's/^[[:blank:]]*//' -e '/\\$/!b' -e '$b' -e 'N' -e 's/\\\n[[:blank:]]*//' -e 'b1'</code></pre>
<p>or, as an alias, silently using <a href="https://packages.debian.org/sid/xsel" title="XSel - command-line tool to access X clipboard and selection buffers"><code>xsel</code></a> to paste from the clipboard, call <code>sed</code>, have <code>paste</code> add a trailing newline if needed, and return the result to the clipboard:</p>
<pre class="lang-sh"><code>alias mfyoi="xsel -b -o |
sed -e 's/^[[:blank:]]*//' -e ':1' -e '/\\\\\$/!b' \
    -e '\$b' -e 'N' -e 's/\\\\\\n[[:blank:]]*//' -e 'b1' |
paste -s -d '\\n' |
xsel -b -i"</code></pre>
<p>Thus minified:</p>
<pre class="lang-sh"><code>xmlstarlet select -T -t --var sq -o "'" -b -o 'xmlstarlet edit --omit-decl '\\ -n -o "  --var N 'Names/Name' \\" -n -m '*/*' -o '  -r ' -v 'concat($sq,"$N[",position(),"]",$sq)' -o '  -v ' -v 'concat($sq,name(),format-number(position(),"0000"),$sq)' -o ' '\\ -n -b -f -n "${infile:-file.xml}"</code></pre>
<h4 id="makefile-notes-gnu-make" class="shew-tgt"><code>makefile</code> notes (GNU Make)<a href="#makefile-notes-gnu-make" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<ul>
<li>special characters
<ul>
<li><code>$</code> (dollar sign) starts expansion of a variable / parameter
<ul>
<li>in <code>make</code>, e.g. <code>$&lt; $T $(mvar) ${mvar}</code>, use <code>$$</code> for a literal</li>
<li>in the shell, e.g. <code>$# $$ $svar ${svar}</code></li>
<li>in XSLT, e.g. <code>$xvar</code></li>
</ul></li>
<li><code>\</code> (backslash) is <code>make</code>’s (and the shell’s) escape character, it has no special meaning in XPath or XSLT</li>
<li>an unescaped newline ends a makefile statement or a recipe line</li>
</ul></li>
<li>all <code>make</code> functions and variables are expanded before the shell is invoked to execute a recipe</li>
<li><code>xmlstarlet</code>’s <a href="#exit-values">exit values</a> aren’t all orthodox</li>
</ul>
<p><em>Links</em>: <a href="https://www.gnu.org/software/make/manual/">GNU Make manual</a> | <a href="https://www.cmcrossroads.com/article/gnu-make-escaping-walk-wild-side" title="'GNU Make Escaping: A Walk on the Wild Side' on cmcrossroads.com">Ask Mr. Make article</a> on GNU Make escaping</p>
<div class="dinkus2">

</div>
<p>Sample <code>makefile</code>:</p>
<pre class="lang-makefile"><code>SHELL := /bin/sh
space := $(info) $(info)
tab   := $(shell printf '\t')
define newline =


endef
# next line defines U+0023 NUMBER SIGN (aka \043, pound sign, hashtag, …)
\H    := \#
.RECIPEPREFIX = &gt;
.PHONY: all
all:
&gt; printf '%s' '&lt;v a="fee" b="fi" c="fo" d="fum"/&gt;' | \
  xmlstarlet select -T -t --var x='*/@*' -v '$$x' -n | \
  paste -s -d '$$ ' -
&gt; printf '%s\n' '$(space)x$(tab)\$(newline)'"$${OLDPWD$(\H)$(\H)*/}" \
  "process $$$$ exiting"</code></pre>
<p>Output from <code>make -s</code>:</p>
<pre class="lang-none"><code>fee$fi fo$fum
 x	\
incubator
process 20965 exiting</code></pre>
<h3 id="global-options" class="shew-tgt">Global options and parameters<a href="#global-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#general-notes"></a><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<p>Global options go before the command, as in <code>xmlstarlet -q format file</code>.</p>
<p>An input filename starting with <code>-</code> (dash) – unless it’s short for <code>stdin</code> – must be prefixed with <code>./</code> (dot slash) otherwise it will be parsed as an option, possibly causing <a href="#select"><code>select</code></a> (<span class="caution"><strong>Caution</strong></span>) to ignore the file.</p>
<p>Beware of known bugs for filenames containing (<a href="https://sourceforge.net/p/xmlstar/bugs/123/" title="Invalid expression: '/​tmp/​foo's.nfo'">#123</a> ) <code>'</code> (single quote), or (<a href="https://sourceforge.net/p/xmlstar/bugs/110/" title="ed --inplace 'foo%20bar.xml' writes to 'foo bar.xml'">#110</a>) urlencoded characters, e.g. <code>%20</code>.</p>
<p><em>See also</em>: <a href="#couldnt-read-file">couldn’t read file</a> | <a href="#failed-to-load-external-entity">failed to load external entity</a></p>
<h4 id="global-opt-help" class="shew-tgt"><code>--help</code><a href="#global-opt-help" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet --help</code> shows the general usage reminder, <code>xmlstarlet «command» -h (--help)</code> the command-specific ditto.</p>
<h4 id="global-opt-version" class="shew-tgt"><code>--version</code><a href="#global-opt-version" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>Prints version information and terminates.</p>
<p>Sample output from <code>xmlstarlet --version</code>:</p>
<pre class="lang-none"><code>1.6.1
compiled against libxml2 2.9.4, linked with 20910
compiled against libxslt 1.1.33, linked with 10134</code></pre>
<h4 id="global-opt-quiet" class="shew-tgt"><code>-q (--quiet)</code>: suppress error output<a href="#global-opt-quiet" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>Error messages from <a href="#selected-resources"><code>libxml2</code></a> or <a href="#selected-resources"><code>libxslt</code></a> are suppressed by this option.</p>
<p><span class="caution"><strong>Caution</strong></span>: this option also suppresses ordinary output (to <code>stdout</code>) from <code>xmlstarlet select</code>.</p>
<p><em>See also</em>: <a href="#select-opt-quiet">select <code>-Q (--quiet)</code></a> local option | <a href="#format-opt-quiet">format <code>-Q (--quiet)</code></a> local option</p>
<h4 id="global-opt-no-doc-namespace" class="shew-tgt"><code>--no-doc-namespace</code>: don’t use namespace bindings from input’s root element<a href="#global-opt-no-doc-namespace" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="global-opt-doc-namespace" class="shew-tgt"><code>--doc-namespace</code>: extract namespace bindings from input’s root element (<em>default</em>)<a href="#global-opt-doc-namespace" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>By default (<code>--doc-namespace</code> being in effect) namespaces declared in input’s <strong>root element</strong> (aka document element) can be referred to without explicit <code>-N</code> options; if the default namespace is declared there it is bound to the <code>_</code> (underscore) (aka <code>DEFAULT</code>) prefix.</p>
<p>Although <code>--no-doc-namespace</code> and <code>--doc-namespace</code> are global options only <code>xmlstarlet select</code> and <code>xmlstarlet edit</code> use them.</p>
<p><em>See also</em>: User’s guide <a href="https://xmlstar.sourceforge.net/doc/UG/ch05.html#idm47989546158480">ch. 5</a> | <a href="#namespaces-use">Use a namespace</a> | <a href="#select-opt-n"><code>select -N</code></a> | <a href="#edit-opt-n"><code>edit -N</code></a></p>
<h4 id="global-opt-net" class="shew-tgt">Network access (<code>--net</code>)<a href="#global-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p>Several <code>xmlstarlet</code> commands - <code>select</code>, <code>edit</code>, <code>format</code>, <code>c14n</code>, <code>validate</code>, and <code>transform</code> - have a <code>--net</code> option to allow network access, to fetch remote DTDs and entities. <code>--net</code> clears the <code>XML_PARSE_NONET</code> flag for the <code>libxml2</code> XML parser (<a href="https://gnome.pages.gitlab.gnome.org/libxml2/devhelp/libxml2-parser.html">API ref</a>).</p>
<p>For security, network access is disallowed by default, cf. article on <a href="https://en.wikipedia.org/wiki/XML_external_entity_attack" title="'XML external entity attack' on Wikipedia">XML external entity attack</a>.</p>
<h4 id="global-param-uri" class="shew-tgt"><code>uri</code> replacing input file<a href="#global-param-uri" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#xmlstarlet-commands"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet --help</code> says,</p>
<blockquote>
Wherever file name mentioned in command help it is assumed that URL can be used instead as well.
</blockquote>
<p>Should work with HTTP and FTP protocols, not HTTPS (due to <a href="#selected-resources">libxml2</a> limitations). (Distribution-dependent?)</p>
<p><em>See also</em>: <a href="#global-opt-net"><code>--net</code></a></p>
<div class="dinkus1">

</div>
</section>
<section id="sec-elements">
<h2 id="elements" class="shew-tgt">Display structure: <code>xmlstarlet elements</code><a href="#elements" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#xmlstarlet-commands"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#select"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p><code>xmlstarlet elements</code> (aka <code>el</code>) displays the structure of an XML document by listing the paths of elements and optionally attributes and attribute values.</p>
<h4 id="elements-usage" class="shew-tgt">Usage: <code>elments [option] [«xml-file»]</code><a href="#elements-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span></div></h4>
<p>At most one option and one input file is accepted.</p>
<h3 id="elements-local-options" class="shew-tgt">Local options<a href="#elements-local-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#elements"></a><a class="relnext shew-hover" href="#elements-examples"></a><span class="relnop shew-hover"></span></div></h3>
<h4 id="elements-opt-a" class="shew-tgt"><code>-a</code> - include attributes<a href="#elements-opt-a" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="elements-opt-v" class="shew-tgt"><code>-v</code> - include attribute values<a href="#elements-opt-v" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="elements-opt-u" class="shew-tgt"><code>-u</code> - sorted unique lines<a href="#elements-opt-u" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="elements-opt-d" class="shew-tgt"><code>-dN</code> - sorted unique lines to depth N<a href="#elements-opt-d" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span></div></h4>
<h3 id="elements-examples" class="shew-tgt">Examples<a href="#elements-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#elements-local-options"></a><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="elements-sample-session" class="shew-tgt">Sample session<a href="#elements-sample-session" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#elements"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-shell"><code>$ : "${infile=recently-used.xbel}"
$ :
$ xmlstarlet elements -u "${infile}"
xbel
xbel/bookmark
xbel/bookmark/info
xbel/bookmark/info/metadata
xbel/bookmark/info/metadata/bookmark:applications
xbel/bookmark/info/metadata/bookmark:applications/bookmark:application
xbel/bookmark/info/metadata/bookmark:groups
xbel/bookmark/info/metadata/bookmark:groups/bookmark:group
xbel/bookmark/info/metadata/mime:mime-type
$ :
$ xmlstarlet el -d3 "${infile}"
xbel
xbel/bookmark
xbel/bookmark/info
$ :
$ # Skip repetitions
$ xmlstarlet el -a "${infile}" | awk '!seen[$1]++' | head -n 10
xbel
xbel/@xmlns:bookmark
xbel/@xmlns:mime
xbel/@version
xbel/bookmark
xbel/bookmark/@href
xbel/bookmark/@added
xbel/bookmark/@modified
xbel/bookmark/@visited
xbel/bookmark/info
$ :
$ xmlstarlet el -v "${infile}" | sed '2d;9q'
xbel[@xmlns:bookmark='http://www.freedesktop.org/standards/desktop-bookmarks' and @xmlns:mime='http://www.freedesktop.org/standards/shared-mime-info' and @version='1.0']
xbel/bookmark/info
xbel/bookmark/info/metadata[@owner='http://freedesktop.org']
xbel/bookmark/info/metadata/mime:mime-type[@type='image/jpeg']
xbel/bookmark/info/metadata/bookmark:groups
xbel/bookmark/info/metadata/bookmark:groups/bookmark:group
xbel/bookmark/info/metadata/bookmark:applications
xbel/bookmark/info/metadata/bookmark:applications/bookmark:application[@name='Image Viewer' and @exec="'eog %u'" and @modified='2022-03-28T07:27:27Z' and @count='1']
$ :
$ # Compute tree height as maximum branch node depth
$ xmlstarlet el -u "${infile}" | awk -F / '{d=NF-1;if(d&gt;h)h=d}END{print 0+h}'
5</code></pre>
<p><em>See also</em>: <a href="#print-xpath-of-selected-elements-or-attributes">Print XPath of selected elements or attributes</a> example</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-select">
<h2 id="select" class="shew-tgt">Query: <code>xmlstarlet select</code><a href="#select" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#elements"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#edit"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p><code>xmlstarlet select</code> (aka <code>sel</code>) is basically a shorthand XSLT generator that can either process or print the stylesheet it generates. Typically used to extract and format data it supports a subset of XSLT 1.0 elements, all XPath 1.0 and XSLT 1.0 functions, plus the <a href="#exslt">EXSLT</a> functions offered by <code>libexslt</code>.</p>
<p><code>select</code> implements 7 XSLT instruction elements – <code>xsl:attribute</code>, <code>xsl:choose</code>, <code>xsl:copy-of</code>, <code>xsl:element</code>, <code>xsl:for-each</code>, <code>xsl:text</code>, <code>xsl:value-of</code> – plus <code>xsl:variable</code> (and <code>xsl:stylesheet</code>, <code>xsl:template</code>, <code>xsl:output</code> partially) but note the absence of <code>xsl:apply-templates</code>, <code>xsl:key</code> a.o. This means recursion and <em>identity transform</em>s are off-limits (unless resorting to <a href="#code-generation">code generation</a>).</p>
<p><code>xmlstarlet select</code> returns the same <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-system-property" title="W3C XSLT 1.0 recommendation"><code>system-property()</code></a> values as <a href="#transform"><code>xmlstarlet transform</code></a>. A stylesheet generated by <code>select</code> appears as located in the current directory.</p>
<p>Like <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/grep.html#tag_20_55_14" title="'grep - search a file for a pattern' utility at Open Group (POSIX)"><code>grep</code></a> <code>xmlstarlet select</code> returns an <a href="#exit-values">exit value</a> of 1 if no nodes were selected, e.g.  <code>xmlstarlet select -T -t -m '(//xsl:document)[1]' -f *.xsl</code> returns 0 if at least one input file matches the XPath expression, otherwise 1 (with or without the <a href="#select-opt-quiet"><code>-Q (--quiet)</code></a> option).</p>
<p><em>See also</em>: <a href="#xml-parsing-and-serialization">XML parsing and serialization</a></p>
<div class="dinkus3">

</div>
<p><span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet select</code> does not flag invalid non-template options (<a href="https://fossies.org/linux/xmlstarlet/src/xml_select.c#l_191">src/xml_select.c#selParseOptions()</a>) and ignores characters following the first letter in short template options (<a href="https://fossies.org/linux/xmlstarlet/src/xml_select.c#l_334">src/xml_select.c#selGenTemplate()</a>). Next command outputs:</p>
<pre class="lang-none"><code>optfuscation</code></pre>
<pre class="lang-sh"><code>xmlstarlet select --nonet --rsn -:=% -C -t -i\*r 2=2 -eR_W- x -a'!e'ee y -omit z -bar -b:rrrf -newln | {
xmlstarlet select -C -t -i 2=2 -e x -a y -o z -b -b -n |
cmp -s - /dev/fd/3
} 3&lt;&amp;0 &amp;&amp; echo 'optfuscation' || echo 'returned non-zero'</code></pre>
<h4 id="select-usage" class="shew-tgt">Usage: <code>select</code> [option …] template … [«xml-file» …]<a href="#select-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<div id="toc-select" class="nav">
<ul>
<li><a href="#select-non-template-options">Non-template options</a><br/>
<a href="#select-opt-help"><code>-h (--help)</code></a> | <a href="#select-opt-quiet"><code>-Q (--quiet)</code></a> | <a href="#select-opt-comp"><code>-C (--comp)</code></a> | <a href="#select-opt-root"><code>-R (--root)</code></a> | <a href="#select-opt-text"><code>-T (--text)</code></a> | <a href="#select-opt-indent"><code>-I (--indent)</code></a> | <a href="#select-opt-xml-decl"><code>-D (--xml-decl)</code></a> | <a href="#select-opt-noblanks"><code>-B (--noblanks)</code></a> | <a href="#select-opt-encode"><code>-E (--encode)</code></a> | <a href="#select-opt-n"><code>-N «prefix»=«value»</code></a> | <a href="#select-opt-net"><code>--net</code></a></li>
<li><a href="#select-template-options">Template options</a><br/>
<a href="#select-opt-template"><code>-t (--template)</code></a> | <a href="#select-opt-match"><code>-m (--match)</code></a> | <a href="#select-opt-sort"><code>-s (--sort)</code></a> | <a href="#select-opt-var-break"><code>--var «name» «value» --break</code></a> | <a href="#select-opt-var-equals"><code>--var «name»=«value»</code></a> | <a href="#select-exslt-namespace-issue"><code>--var «name»=«value»</code> namespace issue</a> | <a href="#select-opt-output"><code>-o (--output)</code></a> | <a href="#select-opt-elem"><code>-e (--elem)</code></a> | <a href="#select-opt-attr"><code>-a (--attr)</code></a> | <a href="#select-opt-copy-of"><code>-c (--copy-of)</code></a> | <a href="#select-opt-value-of"><code>-v (--value-of)</code></a> | <a href="#select-opt-if"><code>-i (--if)</code></a> | <a href="#select-opt-break"><code>-b (--break)</code></a> | <a href="#select-opt-nl"><code>-n (--nl)</code></a> | <a href="#select-opt-inp-name"><code>-f (--inp-name)</code></a></li>
<li><a href="#select-examples">Examples</a><br/>
<a href="#query-euro-rates">Query Euro rates</a> | <a href="#list-xml-files-matching-xpath-expression">List XML files matching XPath expression</a> | <a href="#print-xpath-of-selected-elements-or-attributes">Print XPath of selected elements or attributes</a> | <a href="#mark-up-plaintext">Mark up plaintext</a> | <a href="#use-the-document-function">Use the <code>document()</code> function</a> | <a href="#extract-subtree-to-depth-n-removing-namespaces">Extract subtree to depth N removing namespaces</a></li>
</ul>
</div>
<h3 id="select-non-template-options" class="shew-tgt">Non-template options<a href="#select-non-template-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#select"></a><a class="relnext shew-hover" href="#select-template-options"></a><a class="rellast shew-hover" href="#select-examples"></a></div></h3>
<h4 id="select-opt-help" class="shew-tgt"><code>-h (--help)</code> - display help<a href="#select-opt-help" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="select-opt-quiet" class="shew-tgt"><code>-Q (--quiet)</code> - do not write anything to standard output<a href="#select-opt-quiet" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: global option <a href="#global-opt-quiet"><code>-q (--quiet)</code></a> (lowercase <code>-q</code>)</p>
<h4 id="select-opt-comp" class="shew-tgt"><code>-C (--comp)</code> - display generated XSLT<a href="#select-opt-comp" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Lists the XSLT stylesheet that will be generated from the current template options. No input file is required for this option. It produces no output other than a stylesheet or an error message.</p>
<p>Usage samples: <a href="#list-the-generated-xslt-xmlstarlet-select--c"><code>-t -m …</code></a> | <a href="#select-opt-output"><code>--output …</code></a> | <a href="#select-opt-value-of"><code>--value-of …</code></a> | <a href="#transform-opt-xinclude"><code>--xinclude</code></a></p>
<p><em>See also</em>: <a href="#ex3-introspection">Introspection</a> example</p>
<h4 id="select-opt-root" class="shew-tgt"><code>-R (--root)</code> - print root element <code>&lt;xsl-select&gt;</code><a href="#select-opt-root" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Wraps a container element named <code>xsl-select</code> around output. It includes any namespace nodes declared with <a href="#select-opt-n"><code>-N «prefix»=«value»</code></a> except the <a href="#namespaces-use">predefined</a> namespaces.</p>
<h4 id="select-opt-text" class="shew-tgt"><code>-T (--text)</code> - output is text (default is XML)<a href="#select-opt-text" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Sets <code>method="text"</code> on the <code>xsl:output</code> element.</p>
<pre class="lang-shell"><code>$ cat file.xml
&lt;v&gt;&lt;w&gt;a&amp;amp;&lt;/w&gt;&lt;w&gt;l&amp;lt;&lt;/w&gt;&lt;w&gt;q&amp;quot;&lt;/w&gt;&lt;w&gt;g&amp;gt;&lt;/w&gt;&lt;/v&gt;
$ :
$ xmlstarlet select -t -c '*/*[position()&gt;2]' -n file.xml
&lt;w&gt;q"&lt;/w&gt;&lt;w&gt;g&amp;gt;&lt;/w&gt;
$ :
$ xmlstarlet select --text -t -c '*/*[position()&lt;3]' -n file.xml
a&amp;l&lt;</code></pre>
<p><em>See also</em>: <a href="#special-characters">Special characters</a> | <a href="#select-opt-output"><code>-o (--output)</code></a></p>
<h4 id="select-opt-indent" class="shew-tgt"><code>-I (--indent)</code> - indent output<a href="#select-opt-indent" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Sets <code>indent="yes"</code> on the <code>xsl:output</code> element.</p>
<p>To re-indent, for example:</p>
<pre class="lang-sh"><code>xmlstarlet select -B -I -t -c / in.xml &gt; out.xml</code></pre>
<p><em>See also</em>: <a href="#xml-parsing-and-serialization">XML parsing and serialization</a> | <a href="#select-opt-noblanks"><code>-B (--noblanks)</code></a></p>
<h4 id="select-opt-xml-decl" class="shew-tgt"><code>-D (--xml-decl)</code> - do not omit XML declaration line<a href="#select-opt-xml-decl" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Sets <code>omit-xml-declaration="no"</code> on the <code>xsl:output</code> element.</p>
<p>Use with <code>-E (--encode)</code> to specify encoding.</p>
<p><em>See also</em>: <a href="#xml-declaration">XML declaration</a></p>
<h4 id="select-opt-noblanks" class="shew-tgt"><code>-B (--noblanks)</code> - remove nonsignificant whitespace from XML tree<a href="#select-opt-noblanks" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>To strip nonsignificant whitespace, for example:</p>
<pre class="lang-sh"><code>xmlstarlet select -B -t -c / in.xml &gt; out.xml</code></pre>
<p><em>See also</em>: <a href="#xml-parsing-and-serialization">XML parsing and serialization</a></p>
<h4 id="select-opt-encode" class="shew-tgt"><code>-E (--encode) «encoding»</code> - output in the given encoding<a href="#select-opt-encode" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Encoding value for the XML declaration, e.g. <code>UTF-8</code>, <code>ISO-8859-2</code>. Use with <code>-D (--xml-decl)</code>.</p>
<p><em>See also</em>: <a href="#xml-declaration">XML declaration</a></p>
<h4 id="select-opt-n" class="shew-tgt"><code>-N «prefix»=«value»</code> - declare namespaces<a href="#select-opt-n" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>This option is repeatable. E.g. <code>-N xsql='urn:oracle-xsql' -N X='http://www.w3.org/1999/xhtml'</code>. Either side of the equal sign may be empty<sup>[1]</sup>, e.g. <code>-N ''=''</code> (or <code>-N =</code>) for <code>xmlns=""</code>.</p>
<p>Not needed for <a href="#namespaces-use">predefined namespaces</a> or those declared in input’s root element (see <a href="#global-opt-doc-namespace"><code>--doc-namespace</code></a>) but required</p>
<ul>
<li>for namespaces not declared in input’s root element (e.g. if read by the <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#document" title="W3C XSLT 1.0 recommendation"><code>document()</code></a> function)</li>
<li>when the <a href="#global-opt-no-doc-namespace"><code>--no-doc-namespace</code></a> global option is in effect</li>
<li>to work around <code>select</code>’s <a href="#select-exslt-namespace-issue"><code>--var «name»=«value»</code> namespace issue</a></li>
<li>when referencing certain extensions such as <code>crypto</code> (see <a href="#exslt">EXSLT</a>)</li>
<li>to <a href="#namespaces-create">create</a> a namespace</li>
</ul>
<p><em>See also</em>: <a href="#namespaces-use">Use a namespace</a> | <a href="#select-opt-root"><code>-R (--root)</code></a> | <a href="#edit-opt-n"><code>edit -N</code></a></p>
<p><sup>[1]</sup> <code>-N foo=''</code> is <a href="https://web.archive.org/web/20180305021934/http://www.dpawson.co.uk/xsl/sect2/N5536.html#d7042e22">not</a> allowed; <code>echo '&lt;v/&gt;' | xmlstarlet sel -N foo= -t -e a -e foo:k</code> outputs <code>&lt;a&gt;&lt;k/&gt;&lt;/a&gt;</code>.</p>
<h4 id="select-opt-net" class="shew-tgt"><code>--net</code> - allow fetch DTDs or entities over network<a href="#select-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#global-opt-net">network access</a></p>
<h3 id="select-template-options" class="shew-tgt">Template options<a href="#select-template-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#select-non-template-options"></a><a class="relup shew-hover" href="#select"></a><a class="relnext shew-hover" href="#select-examples"></a><span class="relnop shew-hover"></span></div></h3>
<h4 id="select-opt-template" class="shew-tgt"><code>-t (--template)</code> is <code>&lt;xsl:template match="/"&gt;</code><a href="#select-opt-template" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>The <code>-t (--template)</code> option marks the beginning of an <code>xsl:template</code> element which ends at a following <code>-t</code> option (i.e. non-nestable) or at the last option after <code>-t</code>. <code>-t</code> must be followed by at least one template option. <strong>NB</strong>: <code>&lt;xsl:template match="expression"&gt;</code> <em>cannot</em> be generated by combining <code>-t</code> and <code>-m</code> options.</p>
<p><code>-t (--template)</code> makes the root node (<code>/</code>, not the root element <code>/*</code>) the <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#dt-current-node" title="W3C XSLT 1.0 recommendation">current node</a> so XPath expressions can be relative,</p>
<pre class="lang-sh"><code>xmlstarlet select -t -m '*/*/r' -v '@id' -n file</code></pre>
<p>even obscure,</p>
<pre class="lang-sh"><code>echo '&lt;q&gt;2&lt;/q&gt;' | xmlstarlet sel -t -v '*******************'</code></pre>
<p>with thanks to Michael Kay for his original Christmas <a href="https://web.archive.org/web/20180305021934/http://www.dpawson.co.uk/xsl/sect2/N3773.html#d5234e19">cracker</a> the output of which is <code>1024</code>.</p>
<div class="dinkus3">

</div>
<p>As <code>xmlstarlet select --help</code> shows, two or more <code>--template</code>s are implemented as:</p>
<pre class="lang-xml"><code>&lt;xsl:template match="/"&gt;
  &lt;xsl:call-template name="t1"/&gt;
  &lt;xsl:call-template name="t2"/&gt;
  …
&lt;/xsl:template&gt;</code></pre>
<p><em>See also</em>: List the generated XSLT <a href="#select-opt-comp"><code>-C (--comp)</code></a></p>
<h4 id="select-opt-match" class="shew-tgt"><code>-m (--match)</code> is <code>&lt;xsl:for-each select="xpath-expr"&gt;</code><a href="#select-opt-match" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-m (--match)</code> is a rare misnomer among <code>xmlstarlet</code>’s option names: it translates to the <code>xsl:for-each</code> element and has nothing to do with an <code>xsl:template</code> pattern. <code>-m (--match)</code> is nestable and can be explicitly terminated with <a href="#select-opt-break"><code>-b (--break)</code></a>.</p>
<p><em>Links</em>: XSLT <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#dt-current-node" title="W3C XSLT 1.0 recommendation">current node</a> | XSLT <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#for-each" title="W3C XSLT 1.0 recommendation"><code>xsl:for-each</code></a> | XSLT <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-current" title="W3C XSLT 1.0 recommendation"><code>current()</code></a> | XPath <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#dt-context-node" title="W3C XPath 1.0 recommendation">context node</a></p>
<div class="dinkus3">

</div>
<p><code>xsl:for-each</code> changes the current node. The XPath functions <a href="https://www.w3.org/TR/1999/REC-xpath-19991116##section-Node-Set-Functions" title="W3C XPath 1.0 recommendation"><code>position()</code></a> and <a href="https://www.w3.org/TR/1999/REC-xpath-19991116##section-Node-Set-Functions" title="W3C XPath 1.0 recommendation"><code>last()</code></a> return the context position and context size, respectively.</p>
<pre class="lang-shell"><code>$ printf '&lt;v w="a:b:c:d:e:f:g:h:i:j"/&gt;' |
  xmlstarlet select --text -t \
    -m 'str:split(v/@w,":")' \
      --if 'position() mod 3 = 0' \
        -v 'concat(position()," ",.,"  ")'
3 c  6 f  9 i  </code></pre>
<p>whereas <code>-m 'str:split(v/@w,":")[position() mod 3 = 0]' -v 'concat(…)'</code> outputs <code>1 c  2 f  3 i</code>.</p>
<div class="dinkus3">

</div>
<p>Keeping a reference to root for node changes.</p>
<pre class="lang-shell"><code>$ cat file.xml
&lt;r&gt;&lt;e id="a"&gt;fee&lt;/e&gt;&lt;e id="b"&gt;fi&lt;/e&gt;&lt;e id="c"&gt;fo&lt;/e&gt;&lt;e id="d"&gt;fum&lt;/e&gt;&lt;/r&gt;
$ :
$ xmlstarlet select -T -t \
  -m 'str:split("a b c d")' \
    -v 'concat(//e[@id=current()],". ")' \
  -b -n \
  file.xml
. . . . 
$ :
$ xmlstarlet select -T -t \
  --var R='/' \
  -m 'str:split("a b c d")' \
    -v 'concat($R//e[@id=current()],". ")' \
  -b -n \
  file.xml
fee. fi. fo. fum. </code></pre>
<h4 id="select-opt-sort" class="shew-tgt"><code>-s (--sort)</code> is <code>&lt;xsl:sort …/&gt;</code><a href="#select-opt-sort" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>To process a nodeset in sorted order add one or more <code>-s (--sort) 'X:Y:Z' 'xpath'</code> options immediately after <code>-m (--match)</code>.</p>
<ul>
<li><code>X</code> is one of <code>A | D | -</code> to set <code>order</code> ascending | descending | unspecified</li>
<li><code>Y</code> is one of <code>N | T | -</code> to set <code>data-type</code> number | text | unspecified</li>
<li><code>Z</code> is one of <code>U | L | -</code> to set <code>case-order</code> upper-first | lower-first | unspecified</li>
<li><span class="caution"><strong>Caution</strong></span>: invalid sort options are silently treated as <code>-</code> (unspecified)</li>
</ul>
<p>For example:</p>
<ul>
<li>ascending numerical order: <code>-s 'A:N:-' '.'</code></li>
<li>reverse document order: <code>-s 'D:N:-' 'position()'</code></li>
<li><code>DD.MM.YYYY</code> dates by year, month, date:<br/>
<code>-s 'A:T:-' 'concat(substring(.,7,4), substring(.,4,2), substring(.,1,2))'</code></li>
</ul>
<p><em>See also</em>: <a href="https://fossies.org/linux/www/xmlstarlet-1.6.1.tar.gz/" title="Fossies - the Fresh Open Source Software Archive">examples/sort*</a> | <a href="#query-euro-rates">Query Euro rates</a> | <a href="#remove-all-but-the-latest-member-of-each-group">Remove all but the latest member of each group</a></p>
<h4 id="select-opt-var-break" class="shew-tgt"><code>--var «name» «value» --break</code> is <code>&lt;xsl:variable name="…"&gt;«value»&lt;/xsl:variable</code>&gt;<a href="#select-opt-var-break" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="select-opt-var-equals" class="shew-tgt"><code>--var «name»=«value»</code> is <code>&lt;xsl:variable name="…"/&gt;</code><a href="#select-opt-var-equals" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet select</code> has 2 forms of <code>--var</code>, cf. <code>xsl:variable</code>:</p>
<ol type="1">
<li><code>--var name=value</code>, e.g.
<ul>
<li><code>--var n='5'</code></li>
<li><code>--var s='"fee fi fo fum"'</code></li>
<li><code>--var f='true()'</code></li>
<li><code>--var V='//_:abc[@class="def"]'</code></li>
<li><code>--var W='$V/_:ghi[boolean(@jkl)]'</code></li>
<li><code>-m 'str:split($ws)' --var w='.' …</code></li>
<li><code>--var lut='document("")//xsl:variable[@name="rtf"]/*'</code></li>
</ul></li>
<li><code>--var name value --break</code><br/>
defining string content and terminated with <a href="#select-opt-break"><code>-b (--break)</code></a>, e.g.
<ul>
<li><code>--var nl -n -b</code></li>
<li><code>--var s -o '&lt;f&amp;g&gt;' -b</code></li>
<li><code>--var stuff -e doranc -c 'a[c] | d[c]' -b -b</code></li>
<li><code>--var lines -m '$expr' -v '…' -n -b -b</code></li>
<li><code>--var reply --if '$v &gt; 4' -o 'yes' --elif '$v &lt; 2' -o 'no' --else -o 'maybe' -b -b</code></li>
</ul></li>
</ol>
<p>(<code>xmlstarlet edit</code> has 1 form: <a href="#edit-opt-var"><code>--var name xpath</code></a>.)</p>
<p><em>See also</em>: <a href="#select-exslt-namespace-issue"><code>--var «name»=«value»</code> namespace issue</a></p>
<div class="dinkus3">

</div>
<p>Result tree fragment (RTF) demo:</p>
<pre class="lang-sh"><code>printf '&lt;v/&gt;\n' |
xmlstarlet select -t \
  --var rtf \
    -e x  -a k -o 1st -b  -o First. -b \
    -e x  -a k -o 2nd -b  -o Second. -b \
    -e x  -a k -o 3rd -b  -o Third. -b \
  -b \
  --var tbl='exslt:node-set($rtf)' \
  -v 'exslt:object-type($rtf)' -o ' rtf ' -v '$rtf' -n -c '$rtf' -n \
  -v 'exslt:object-type($tbl)' -o ' tbl ' -v '$tbl' -n -c '$tbl' -n</code></pre>
<p>Output:</p>
<pre class="lang-none"><code>RTF rtf First.Second.Third.
&lt;x k="1st"&gt;First.&lt;/x&gt;&lt;x k="2nd"&gt;Second.&lt;/x&gt;&lt;x k="3rd"&gt;Third.&lt;/x&gt;
node-set tbl First.Second.Third.
&lt;x k="1st"&gt;First.&lt;/x&gt;&lt;x k="2nd"&gt;Second.&lt;/x&gt;&lt;x k="3rd"&gt;Third.&lt;/x&gt;</code></pre>
<p><code>$tbl/x[@k="2nd"]</code> is a valid XPath expression, <code>$rtf/x[@k="2nd"]</code> is not and triggers an <code>Invalid type</code> run-time error.</p>
<p><em>See also</em>: RTF examples <a href="#ex2-extract-and-merge-records">file list</a> | <a href="#ex4-external-lookup-table">accumulation</a></p>
<p><em>Links</em>: <a href="https://exslt.github.io/exsl/functions/node-set/index.html"><code>exslt:node-set</code></a> | <a href="https://web.archive.org/web/20180305021934/http://www.dpawson.co.uk/xsl/sect2/nodeset.html">nodeset vs. RTF</a> by David Carlisle, Jörg Pietschmann | <a href="https://stackoverflow.com/a/53026101">RTF background</a> by Michael Kay</p>
<h4 id="select-exslt-namespace-issue" class="shew-tgt"><code>--var «name»=«value»</code> namespace issue<a href="#select-exslt-namespace-issue" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><span class="caution"><strong>Caution</strong></span>: An <a href="#exslt">EXSLT</a> namespace prefix (other than <code>exslt</code> (?)) used only inside <code>xmlstarlet select</code>’s <code>--var name='…'</code> triggers runtime error <code>xmlXPathCompOpEval: function «func» bound to undefined prefix «ns»</code> unless option <a href="#select-opt-n"><code>-N ns=…</code></a> is given. Workaround: use <code>-N ns=…</code> or use the prefix outside <code>--var name='…'</code>, e.g. in <code>-v</code> or <code>-m</code> or (for string content) <code>--var name … -b</code>.</p>
<pre class="lang-shell"><code>$ printf '%s\n' '&lt;v s="a b c"/&gt;' |
xmlstarlet select -t \
  --var d='str:split(v/@s)' \
  -v '$d' -n 
xmlXPathCompOpEval: function split bound to undefined prefix str
runtime error: element variable
Failed to evaluate the expression of variable 'd'.
no result for -
$ :
$ printf '%s\n' '&lt;v s="a b c"/&gt;' |
xmlstarlet select -t \
  -m 'str:split(v/@s)' \
    -v . -b -n
abc</code></pre>
<h4 id="select-opt-output" class="shew-tgt"><code>-o (--output)</code> is <code>&lt;xsl:text&gt;«value»&lt;/xsl:text&gt;</code><a href="#select-opt-output" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-shell"><code>$ xmlstarlet select -T -C -t -o 'A&lt;&amp;'\''"&gt;z'
&lt;?xml version="1.0"?&gt;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"&gt;
  &lt;xsl:output omit-xml-declaration="yes" indent="no" method="text"/&gt;
  &lt;xsl:template match="/"&gt;
    &lt;xsl:text&gt;A&amp;lt;&amp;amp;'"&amp;gt;z&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</code></pre>
<p><code>-o ''</code> translates to an empty <code>&lt;xsl:text/&gt;</code> element.</p>
<p><em>See also</em>: <a href="#special-characters">Special characters</a></p>
<p>To manage parameters of the <code>xsl:output</code> element, see <a href="#xml-parsing-and-serialization">XML parsing and serialization</a>.</p>
<h4 id="select-opt-elem" class="shew-tgt"><code>-e (--elem)</code> is <code>&lt;xsl:element name="…"&gt;</code><a href="#select-opt-elem" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-e</code> is nestable and can be explicitly terminated with <a href="#select-opt-break"><code>-b (--break)</code></a>.</p>
<p><em>See also</em>: <a href="#namespaces-create">Create a namespace</a> | <a href="#create-a-soap-envelope">Create a SOAP envelope</a> example</p>
<h4 id="select-opt-attr" class="shew-tgt"><code>-a (--attr)</code> is <code>&lt;xsl:attribute name="…"&gt;</code><a href="#select-opt-attr" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-a</code> can be explicitly terminated with <a href="#select-opt-break"><code>-b (--break)</code></a>.</p>
<p>In XSLT, the latter of two same-named attributes is accepted, e.g.</p>
<pre class="lang-shell"><code>$ echo '&lt;v/&gt;' | 
  xmlstarlet select -t -e doc  -a f -o n -b  -a f -o y
&lt;doc f="y"/&gt;</code></pre>
<h4 id="select-opt-copy-of" class="shew-tgt"><code>-c (--copy-of)</code> is <code>&lt;xsl:copy-of select="xpath-expr"/&gt;</code><a href="#select-opt-copy-of" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>See examples at: <a href="#select-opt-text"><code>-T (--text)</code></a> | <a href="#select-opt-indent"><code>-I (--indent)</code></a></p>
<h4 id="select-opt-value-of" class="shew-tgt"><code>-v (--value-of)</code> is <code>string-join((xpath-expr),newline)</code><a href="#select-opt-value-of" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>With zero or one nodeset members in <code>xpath-expr</code> <code>-v (--value-of)</code> works exactly as XSLT 1.0’s <code>&lt;xsl:value-of select="xpath-expr"/&gt;</code>, otherwise (like <code>string-join()</code> in XSLT 2.0) all members are output, stringified and separated by newlines.</p>
<pre class="lang-shell"><code>$ echo '&lt;v&gt;&lt;w&gt;fee&lt;/w&gt;&lt;w&gt;fi&lt;/w&gt;&lt;w&gt;fo&lt;/w&gt;&lt;w&gt;fum&lt;/w&gt;&lt;/v&gt;' |
  xmlstarlet select -T -t -v '*/*' -t -n
fee
fi
fo
fum</code></pre>
<p>Adding <a href="#select-opt-comp"><code>-C (--comp)</code></a> option to list the XSLT code for the <code>value-of-template</code>:</p>
<pre class="lang-xsl"><code>&lt;?xml version="1.0"?&gt;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:exslt="http://exslt.org/common" version="1.0" extension-element-prefixes="exslt"&gt;
  &lt;xsl:output omit-xml-declaration="yes" indent="no" method="text"/&gt;
  &lt;xsl:template match="/"&gt;
    &lt;xsl:call-template name="t1"/&gt;
    &lt;xsl:call-template name="t2"/&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template name="t1"&gt;
    &lt;xsl:call-template name="value-of-template"&gt;
      &lt;xsl:with-param name="select" select="*/*"/&gt;
    &lt;/xsl:call-template&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template name="t2"&gt;
    &lt;xsl:value-of select="'&amp;#10;'"/&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template name="value-of-template"&gt;
    &lt;xsl:param name="select"/&gt;
    &lt;xsl:value-of select="$select"/&gt;
    &lt;xsl:for-each select="exslt:node-set($select)[position()&amp;gt;1]"&gt;
      &lt;xsl:value-of select="'&amp;#10;'"/&gt;
      &lt;xsl:value-of select="."/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</code></pre>
<h4 id="select-opt-if" class="shew-tgt"><code>-i (--if) [--elif …] [--else]</code> is <code>&lt;xsl:when&gt; … [&lt;xsl:otherwise&gt;]</code><a href="#select-opt-if" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-i (--if)</code> is nestable and can be explicitly terminated with <a href="#select-opt-break"><code>-b (--break)</code></a>. It translates to an <code>xsl:choose</code> element.</p>
<h4 id="select-opt-break" class="shew-tgt"><code>-b (--break)</code> ends current container element<a href="#select-opt-break" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-b (--break)</code> closes the currently open container element, one of:</p>
<ul>
<li><code>-m (--match)</code> (nestable)</li>
<li><code>-i (--if, --elif, --else)</code> (nestable)</li>
<li><code>-e (--elem)</code> (nestable)</li>
<li><code>-a (--attr)</code><br/>
e.g. <code>-a 'data-dec' -o 'pre' -v '.' -o 'suf' -b</code></li>
<li><code>--var</code> without <code>=</code> (nestable)<br/>
e.g. <code>--var idls -m 'was[not(was)]' -v 'concat(@id,$sep,@class)' -n -b -b</code><br/>
any nested <code>--var</code>s are local to the enclosing <code>--var</code> but must have unique variable names.</li>
<li><code>-t (--template)</code></li>
</ul>
<p>These can be followed by a variable number of options and so must be terminated explicitly unless followed by one of:</p>
<ul>
<li>a <code>-t (--template)</code> option</li>
<li>an input filename</li>
<li>end of <code>xmlstarlet</code> command</li>
</ul>
<p>closing all open elements. In other words, trailing <code>-b</code>s may be omitted if they’re the last options in the current template.</p>
<p>A <code>-b (--break)</code> too many can trigger compilation error: <code>xsltParseStylesheetTop: unknown «name» element</code>.</p>
<h4 id="select-opt-nl" class="shew-tgt"><code>-n (--nl)</code> prints a newline<a href="#select-opt-nl" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="select-opt-inp-name" class="shew-tgt"><code>-f (--inp-name)</code> prints pathname / URI of current input<a href="#select-opt-inp-name" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Shorthand for <code>-v '$inputFile'</code> (a predefined variable). Outputs <code>-</code> (dash) for standard input (<code>stdin</code>).</p>
<h3 id="select-examples" class="shew-tgt">Examples<a href="#select-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><a class="relfirst shew-hover" href="#select-non-template-options"></a><a class="relprev shew-hover" href="#select-template-options"></a><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="query-euro-rates" class="shew-tgt">Query Euro rates<a href="#query-euro-rates" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>Download (&lt; 2K) and convert the European Central Bank’s Euro rates sorted by currency in <code>A</code>scending order as <code>T</code>ext, <code>U</code>pper-first:</p>
<pre class="lang-sh"><code>wget -qO- 'https://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml' |
xmlstarlet select --text -t \
  -m '//_:Cube[@currency]' \
    -s 'A:T:U' '@currency' \
    -v 'concat(@currency," ",@rate)' -n</code></pre>
<p><em>See also</em>: <a href="#select-opt-sort"><code>-s (--sort)</code></a></p>
<h4 id="list-xml-files-matching-xpath-expression" class="shew-tgt">List XML files matching XPath expression<a href="#list-xml-files-matching-xpath-expression" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>List files in current dir and subdirs containing at least one <code>milk</code> element (returns non-zero if no match):</p>
<pre class="lang-sh"><code>find . -type f -name '*.xml' -exec \
  xmlstarlet select -T -t -m '(//*[local-name()="milk"])[1]' -f -n {} +</code></pre>
<p>Return zero if at least one XML element text exactly matches <code>milk</code>, otherwise non-zero (no output is produced):</p>
<pre class="lang-sh"><code>find . -type f -name '*.xml' -exec \
  xmlstarlet select -Q -T -t -m '(//*[text()="milk"])[1]' -f -n {} +</code></pre>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/find.html#tag_20_47_05" title="'find files' utility at Open Group (POSIX)"><code>find</code></a>’s <code>{} +</code> fills up the command line with pathnames.</p>
<p><em>See also</em>: <a href="#select-opt-inp-name"><code>-f (--inp-name)</code></a> | <a href="#select-opt-quiet"><code>-Q (--quiet)</code></a> | <a href="#exit-values">exit values</a></p>
<h4 id="print-xpath-of-selected-elements-or-attributes" class="shew-tgt">Print XPath of selected elements or attributes<a href="#print-xpath-of-selected-elements-or-attributes" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Note</em>: This handles element or attribute nodes but no other node types.</p>
<pre class="lang-sh"><code>: ${fileglob:=/usr/share/*/xslt/docbook/common/db-common.xsl}
: ${target:='//xsl:param[string(@select)]'}

xmlstarlet select --text -t \
  -m "${target}" \
    -m 'ancestor-or-self::*' \
      --var pos='1+count(preceding-sibling::*[name() = name(current())])' \
      -v 'concat("/",name(),"[",$pos,"]")' \
    -b \
    --if 'count(. | ../@*) = count(../@*)' \
      -v 'concat("/@",name())' \
    -b \
    -n \
${fileglob}</code></pre>
<p>where:</p>
<ul>
<li><code>${varname:=…}</code> assigns a default value by <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06_02" title="Shell command language at Open Group (POSIX)"><em>shell parameter expansion</em></a> via the built-in <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_16_01" title="'colon - null utility' at Open Group (POSIX)">colon</a> utility</li>
<li>the outer <a href="#select-opt-match"><code>-m (--match)</code></a> option specifies the target, with optional search conditions given as XPath <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#predicates" title="W3C XPath 1.0 recommendation">predicates</a></li>
<li>the inner <code>-m (--match)</code> builds the XPath of elements from root to target, calculating position by counting siblings using the XSLT 1.0 <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-current" title="W3C XSLT 1.0 recommendation"><code>current()</code></a> function</li>
<li>for an attribute node target – which doesn’t match <code>ancestor-or-self::*</code> – the <a href="#select-opt-if"><code>-i (--if)</code></a> clause adjusts the XPath</li>
</ul>
<p>Output:</p>
<pre class="lang-none"><code>/xsl:stylesheet[1]/xsl:template[1]/xsl:param[1]
/xsl:stylesheet[1]/xsl:template[4]/xsl:param[1]
/xsl:stylesheet[1]/xsl:template[5]/xsl:param[1]
/xsl:stylesheet[1]/xsl:template[5]/xsl:param[2]
/xsl:stylesheet[1]/xsl:template[6]/xsl:param[1]</code></pre>
<p>Output if called with <code>target='//xsl:*/@test[contains(.,"position")]'</code>:</p>
<pre class="lang-none"><code>/xsl:stylesheet[1]/xsl:template[2]/xsl:for-each[1]/xsl:if[1]/@test
/xsl:stylesheet[1]/xsl:template[3]/xsl:for-each[1]/xsl:if[1]/@test
/xsl:stylesheet[1]/xsl:template[7]/xsl:for-each[1]/xsl:choose[1]/xsl:when[1]/@test
/xsl:stylesheet[1]/xsl:template[7]/xsl:for-each[1]/xsl:choose[1]/xsl:when[3]/@test</code></pre>
<p><em>See also</em>: <a href="#elements"><code>xmlstarlet elements</code></a></p>
<h4 id="mark-up-plaintext" class="shew-tgt">Mark up plaintext<a href="#mark-up-plaintext" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p>If the plaintext input is uncomplicated perhaps <a href="#exslt">EXSLT</a>’s <a href="https://exslt.github.io/str/index.html"><code>string</code></a> functions can do the conversion. Note that <a href="https://exslt.github.io/str/functions/replace/index.html"><code>str:replace</code></a>, <a href="https://exslt.github.io/str/functions/split/index.html"><code>str:split</code></a>, and <a href="https://exslt.github.io/str/functions/tokenize/index.html"><code>str:tokenize</code></a> are <a href="#exslt">available</a> for <code>xmlstarlet select</code> (and <code>transform</code>), but not for <a href="#edit-exslt-in-xpath-arguments"><code>edit</code></a>.</p>
<pre class="lang-xml"><code>&lt;root&gt;
A;2022-08-10;db #1
B;sortie bidon;50.0
A;2022-08-12;db Cth
B;mali climber;40.0
C;fray illumine;9.75
&lt;/root&gt;</code></pre>
<ul>
<li>define input’s field, sub-record, and record separators as <code>ifs</code>, <code>iss</code>, and <code>irs</code>, respectively</li>
<li>split input by record, then by sub-record and by field using the EXSLT <a href="https://exslt.github.io/str/functions/split/index.html"><code>str:split</code></a> function, while applying XML markup</li>
<li>note the newline before the first <code>A</code> in input</li>
</ul>
<pre class="lang-sh"><code>xmlstarlet select --indent -t \
  --var ifs -o ';' -b \
  --var iss -n -b \
  --var irs='concat($iss,"A")' \
  -e recs \
    -m 'str:split(*,$irs)' \
      -e rec \
        --var sr='str:split(.,$iss)' \
        --var hd='str:split($sr[1],$ifs)' \
        -e hd \
          -e dt -v '$hd[1]' -b \
          -e wd -v '$hd[2]' -b \
        -b \
        -e bd \
          -m '$sr[position()!=1]' \
            --var f='str:split(.,$ifs)' \
            -e fld \
              -a typ -v '$f[1]' -b \
              -e dsc -v '$f[2]' -b \
              -e amt -v '$f[3]' -b \
"${infile:-file.xml}"</code></pre>
<p><em>See also</em>: <a href="#select-opt-var-break"><code>--var</code></a> | <a href="#select-opt-match"><code>-m (--match)</code></a> | <a href="#select-opt-elem"><code>-e (--elem)</code></a> | <a href="#select-opt-break"><code>-b (--break)</code></a></p>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;recs&gt;
  &lt;rec&gt;
    &lt;hd&gt;
      &lt;dt&gt;2022-08-10&lt;/dt&gt;
      &lt;wd&gt;db #1&lt;/wd&gt;
    &lt;/hd&gt;
    &lt;bd&gt;
      &lt;fld typ="B"&gt;
        &lt;dsc&gt;sortie bidon&lt;/dsc&gt;
        &lt;amt&gt;50.0&lt;/amt&gt;
      &lt;/fld&gt;
    &lt;/bd&gt;
  &lt;/rec&gt;
  &lt;rec&gt;
    &lt;hd&gt;
      &lt;dt&gt;2022-08-12&lt;/dt&gt;
      &lt;wd&gt;db Cth&lt;/wd&gt;
    &lt;/hd&gt;
    &lt;bd&gt;
      &lt;fld typ="B"&gt;
        &lt;dsc&gt;mali climber&lt;/dsc&gt;
        &lt;amt&gt;40.0&lt;/amt&gt;
      &lt;/fld&gt;
      &lt;fld typ="C"&gt;
        &lt;dsc&gt;fray illumine&lt;/dsc&gt;
        &lt;amt&gt;9.75&lt;/amt&gt;
      &lt;/fld&gt;
    &lt;/bd&gt;
  &lt;/rec&gt;
&lt;/recs&gt;</code></pre>
<h4 id="use-the-document-function" class="shew-tgt">Use the <code>document()</code> function<a href="#use-the-document-function" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#document" title="W3C XSLT 1.0 recommendation"><code>document()</code></a> in W3C rec</p>
<p>The XSLT <code>document()</code> function</p>
<ul>
<li>resolves relative URIs using a base URI (cf. <a href="#select-as-xslt-stylesheet-generator">code generation</a> example), the default base being the stylesheet’s location (which is the current directory if generated by <a href="#select"><code>xmlstarlet select</code></a>)</li>
<li>requires XML document(s) as input, not <a href="https://www.w3.org/TR/xml-fragment" title="XML Fragment Interchange - W3C Candidate Recommendation">fragments</a> (even if they’re well-balanced); otherwise <code>xmlstarlet</code> abends with an error message such as <code>Extra content at the end of the document</code> and (<span class="caution"><strong>Caution</strong></span>) exit value 0</li>
<li>returns the root node of the stylesheet when invoked as <code>document("")</code></li>
</ul>
<p><em>Examples</em>: <a href="#ex1-merge-2-xml-files">merge 2 XML files</a> | <a href="#ex2-extract-and-merge-records">extract and merge records</a> | <a href="#ex3-introspection">introspection</a> | <a href="#ex4-external-lookup-table">external lookup table</a></p>
<div class="dinkus2">

</div>
<h5 id="ex1-merge-2-xml-files" class="shew-tgt">ex1: merge 2 XML files<a href="#ex1-merge-2-xml-files" class="permalink shew-hover"></a></h5>
<p>Insert child nodes of <code>${partfile}</code>’s root element into <code>${infile}</code>’s <code>${destination}</code> element – using a 3-stage pipeline:</p>
<pre class="lang-sh"><code>xmlstarlet select -R -t \
  --var part -o "${partfile:-file2.xml}" -b \
  -c ' / | document($part)' "${infile:-file.xml}" |
xmlstarlet edit -m '/xsl-select/*[2]/node()' '/xsl-select'"${destination:-/..}" |
xmlstarlet select -B -I -t -c '/xsl-select/*[1]'</code></pre>
<ul>
<li><strong>assuming</strong> namespaces agree</li>
<li>invoke <code>select</code> to copy the 2 documents and wrap them (<code>-R</code>) as <code>/xsl-select/*[1]</code> and <code>/xsl-select/*[2]</code>, using <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#document" title="W3C XSLT 1.0 recommendation"><code>document()</code></a> to access the <code>${partfile}</code> – either <code>${infile}</code> or <code>${partfile}</code> can be <code>/dev/stdin</code></li>
<li>call <code>edit</code> to <a href="#edit-opt-move"><code>-m (--move)</code></a> children of <code>${partfile}</code>’s root element to <code>${destination}</code> – an XPath expression locating an element in <code>${infile}</code> – incoming nodes will be appended as last nodes there</li>
<li>default <code>${destination}</code> (<code>/..</code>) causes an error to be generated and must be <strong>overridden</strong></li>
<li>invoke <code>select</code> to extract and format the merged document</li>
</ul>
<p><em>See also</em>: <a href="#select-opt-root"><code>-R (--root)</code></a> | <a href="#select-opt-var-break"><code>--var … -b</code></a> | <a href="#select-opt-noblanks"><code>-B (--noblanks)</code></a> | <a href="#select-opt-indent"><code>-I (--indent)</code></a> | <a href="#select-opt-copy-of"><code>-c (--copy-of)</code></a></p>
<p>If called with this <code>${partfile}</code></p>
<pre class="lang-xml"><code>&lt;items&gt;
  &lt;item&gt;1&lt;/item&gt;&lt;item&gt;2&lt;/item&gt;&lt;item&gt;3&lt;/item&gt;
&lt;/items&gt;</code></pre>
<p>and this <code>${infile}</code></p>
<pre class="lang-xml"><code>&lt;doc&gt;&lt;g&gt;&lt;g1/&gt;&lt;g2/&gt;&lt;g3/&gt;&lt;/g&gt;&lt;/doc&gt;</code></pre>
<p>and <code>destination=/doc//g1</code>, then output becomes:</p>
<pre class="lang-xml"><code>&lt;doc&gt;
  &lt;g&gt;
    &lt;g1&gt;
      &lt;item&gt;1&lt;/item&gt;
      &lt;item&gt;2&lt;/item&gt;
      &lt;item&gt;3&lt;/item&gt;
    &lt;/g1&gt;
    &lt;g2/&gt;
    &lt;g3/&gt;
  &lt;/g&gt;
&lt;/doc&gt;</code></pre>
<p><em>See also</em>: <a href="#transform-opt-xinclude"><code>transform --xinclude</code></a></p>
<h5 id="ex2-extract-and-merge-records" class="shew-tgt">ex2: extract and merge records<a href="#ex2-extract-and-merge-records" class="permalink shew-hover"></a></h5>
<p>Given a number of similar XML input files each containing a simple record set,</p>
<pre class="lang-sh"><code>echo '&lt;v/&gt;' |
xmlstarlet select -R -I -t \
  --var fls \
    -e f -o 'data/rs1.xml' -b \
    -e f -o 'data/rs2.xml' -b \
    -e f -o 'data/rs3.xml' -b \
  -b \
  -c 'document(exslt:node-set($fls)/f) /*/r'</code></pre>
<ul>
<li>collects a file list in a <em>result tree fragment</em> (RTF, cf. <a href="#select-opt-var-equals"><code>select --var</code></a>)</li>
<li>converts the RTF to a nodeset using the <a href="#exslt">EXSLT</a> <a href="https://exslt.github.io/exsl/functions/node-set/index.html"><code>exslt:node-set()</code></a> function</li>
<li>passes the pathnames as a nodeset ( <code>…/f</code>) to <code>document()</code></li>
<li><code>document()</code> returns the root nodes of the XML trees parsed from the input files</li>
<li><a href="#select-opt-copy-of"><code>-c (--copy-of)</code></a> copies the <code>r</code> elements (<code>…/*/r</code>) from the source trees to the result tree</li>
</ul>
<p><em>See also</em>: <a href="#select-opt-root"><code>-R (--root)</code></a> | <a href="#select-opt-indent"><code>-I (--indent)</code></a> | <a href="#select-opt-var-equals"><code>select --var</code></a> | <a href="#select-opt-elem"><code>-e (--elem)</code></a></p>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;xsl-select&gt;
  &lt;r a1="x" a2="42" a3="-2"/&gt;
  &lt;r a1="x" a2="41" a3="-2"/&gt;
  &lt;!-- etc. --&gt;
&lt;/xsl-select&gt;</code></pre>
<p>Also possible:</p>
<ul>
<li>an XPath <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#NT-UnionExpr" title="W3C XPath 1.0 recommendation">union</a>: <code>-c '(document("…1.xml") | document("…2.xml") | document("…3.xml")) /*/r'</code></li>
<li>copy separately: <code>-c 'document("…1.xml")/*/r</code> <code>-c 'document("…2.xml")/*/r' …</code></li>
</ul>
<div class="dinkus2">

</div>
<p>If file order determined by <code>sort</code> is sufficient the EXSLT <a href="https://exslt.github.io/str/functions/split/index.html"><code>str:split()</code></a> function can split the newline-separated output from <code>find</code> into a nodeset:</p>
<pre class="lang-sh"><code>echo '&lt;v/&gt;' |
xmlstarlet sel -R -I -t \
  --var sep -n -b \
  --var fls2 -o "$(find 'data' -type f -name 'rs*.xml' | sort)" -b \
  -c 'document(str:split($fls2,$sep)) /*/r'</code></pre>
<h5 id="ex3-introspection" class="shew-tgt">ex3: introspection<a href="#ex3-introspection" class="permalink shew-hover"></a></h5>
<p>With a different <code>-c (--copy-of)</code> argument in the <a href="#ex2-extract-and-merge-records">previous</a> example,</p>
<pre class="lang-sh"><code>  -c 'document("")'</code></pre>
<p>outputs the stylesheet like the <a href="#select-opt-comp"><code>-C (--comp)</code></a> option (but inside a wrapper element here because of <a href="#select-opt-root"><code>-R (--root)</code></a>).</p>
<p>With</p>
<pre class="lang-sh"><code>  -c 'document("")//xsl:variable[@name="fls"]'</code></pre>
<p>the file list variable is copied:</p>
<pre class="lang-xml"><code>&lt;xsl-select&gt;
  &lt;xsl:variable xmlns:xsl="http://www.w3.org/1999/XSL/Transform" name="fls"&gt;
    &lt;xsl:element name="f"&gt;data/rs1.xml&lt;/xsl:element&gt;
    &lt;xsl:element name="f"&gt;data/rs2.xml&lt;/xsl:element&gt;
    &lt;xsl:element name="f"&gt;data/rs3.xml&lt;/xsl:element&gt;
  &lt;/xsl:variable&gt;
&lt;/xsl-select&gt;</code></pre>
<h5 id="ex4-external-lookup-table" class="shew-tgt">ex4: external lookup table<a href="#ex4-external-lookup-table" class="permalink shew-hover"></a></h5>
<p>A simple food composition table lists – per 100 gram food – the calorie count (<code>kcal</code>) as well as the amount in grams of protein, fat, and carbohydrate:</p>
<pre class="lang-xml"><code>&lt;fc:foodcomp xmlns:fc="urn:foodcomp-subset"&gt;
  &lt;fc:nutrient nid="n0893" kcal="297" prot="24.3" fat="1.9" carb="48.8" name="Lentils, green, dried, raw"/&gt;
  &lt;fc:nutrient nid="n2443" kcal="98" prot="7.9" fat="0.6" carb="16.3" name="Garlic, raw"/&gt;
  &lt;!-- etc. --&gt;
&lt;/fc:foodcomp&gt;</code></pre>
<p>With an input file containing a culinary recipe on the form</p>
<pre class="lang-xml"><code>&lt;recipe servings="4" name="Lentil and goats' cheese salad"&gt;
  &lt;ingredients&gt;
    &lt;ing foodid="n0893" grams="200" name="green lentils"/&gt;
    &lt;ing foodid="n2443" grams="10" name="garlic"/&gt;
    &lt;!-- etc. --&gt;
  &lt;/ingredients&gt;
  &lt;method&gt;&lt;!-- etc. --&gt;&lt;/method&gt;
&lt;/recipe&gt;</code></pre>
<p>specify the calorie count per serving per ingredient:</p>
<ul>
<li>use <a href="#select-opt-n"><code>-N «prefix»=«value»</code></a> to declare lookup table’s namespace</li>
<li>use <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#document" title="W3C XSLT 1.0 recommendation"><code>document()</code></a> to access the external lookup table</li>
<li>keep references to the input (<code>RP</code>) and lookup (<code>FC</code>) documents as <a href="#select-opt-match"><code>-m (--match)</code></a> changes the current node</li>
<li>format the output as a fixed-width text table with <a href="#exslt">EXSLT</a> <a href="https://exslt.github.io/str/index.html">string</a> functions and XSLT’s <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-format-number" title="W3C XSLT 1.0 recommendation"><code>format-number()</code></a></li>
</ul>
<pre class="lang-sh"><code>xmlstarlet select --text -N fc='urn:foodcomp-subset' -t \
  --var fcfile -o "${lutfile:-file2.xml}" -b \
  --var FC='document($fcfile)/fc:foodcomp' \
  --var RP='/recipe' \
  -m '//ing' \
    --var kcal='$FC/*[@nid = current()/@foodid]/@kcal' \
    --var kcal-per-serv='$kcal div 100.0 * @grams div $RP/@servings' \
    -v 'str:align(current()/@name,str:padding(20," ."),"left")' \
    -o ' : ' \
    -v 'str:align(format-number($kcal-per-serv,"0 kcal"),str:padding(8),"right")' \
    -n \
  -b \
"${infile:-file.xml}"</code></pre>
<p>Output:</p>
<pre class="lang-none"><code>green lentils. . . . : 149 kcal
garlic . . . . . . . :   2 kcal
lemon juice. . . . . :   0 kcal
extra virgin olive o :  56 kcal
fresh basil. . . . . :   4 kcal
goats' cheese. . . . :  96 kcal
black pepper . . . . :   0 kcal
salt . . . . . . . . :   0 kcal</code></pre>
<div class="dinkus2">

</div>
<p>To compute nutritional values for an entire recipe collect the gram-weighted food composition data – here in a <em>result tree fragment</em> (RTF, cf. <a href="#select-opt-var-equals"><code>select --var</code></a>) as data size is modest – and <code>sum(…)</code> vertically, along the lines of:</p>
<pre class="lang-sh"><code>…
  --var attrib='str:split("kcal prot fat carb")' \
  --var nutr-weighted-rtf \
    -m '//ing' \
      --var ing='.' \
      -e data \
        -c '@foodid' \
        -m '$attrib' \
          -a '{.}' -v '$FC/*[@nid = $ing/@foodid]/@*[name() = current()] div 100.0 * $ing/@grams' -b \
        -b \
      -b \
    -b \
  -b \
  --var nutr-wt='exslt:node-set($nutr-weighted-rtf)' \
  -o 'Nutrition per serving: ' \
  -m '$attrib' \
    --var sum-per-serv='sum($nutr-wt/data/@*[name() = current()]) div $RP/@servings' \
    -v 'concat(.," ",format-number($sum-per-serv,"0"))' \
…</code></pre>
<p>Output:</p>
<pre class="lang-none"><code>Nutrition per serving: kcal 307, prot 19g, fat 15g, carb 26g</code></pre>
<h4 id="extract-subtree-to-depth-n-removing-namespaces" class="shew-tgt">Extract subtree to depth N removing namespaces<a href="#extract-subtree-to-depth-n-removing-namespaces" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#select"></a><span class="relnop shew-hover"></span></div></h4>
<div class="enhanced namespace">
<p><span class="caution"><strong>Caution</strong></span>:<br/>
This method does not preserve document order as element nodes are copied after other node types causing <a href="https://www.w3.org/TR/REC-xml/#sec-mixed-content" title="W3C XML 1.0 recommendation"><em>mixed content</em></a> (e.g. marked up text) to be <strong>messed up</strong>. Unless added to the argument of <a href="#select-opt-copy-of"><code>-c (--copy-of)</code></a> comments and processing-instructions are ignored.</p>
</div>
<p>Recursion and <code>xsl:template</code> are off-limits to <code>xmlstarlet select</code> but nesting <a href="#select-opt-match"><code>-m (--match)</code></a> options is OK, i.e. using nested <code>xsl:for-each</code> elements. To make this script extract a subtree to depth N – while (<span class="caution"><strong>Caution</strong></span>) removing selected prefixed namespaces – <strong>repeat</strong> the <code>-m '*'</code> line to reach the desired depth, and it might be the <strong>hack</strong> that works…</p>
<pre class="lang-sh"><code>: "${exclude:=(//namespace::xsi)[1] | (//namespace::ns3)[1] }"
: "${subroot:=//soupenv:body}"

xmlstarlet select -B -I -N ns3='https://www.example.com/ns/ns3' -t \
  --var nl -n -b \
  --var xlist -n -v "${exclude}" -n -b \
  -m "${subroot}" -e '{local-name()}' -c '@*[not(contains($xlist,concat($nl,namespace-uri(),$nl)))] | text()' \
           -m '*' -e '{local-name()}' -c '@*[not(contains($xlist,concat($nl,namespace-uri(),$nl)))] | text()' \
           -m '*' -e '{local-name()}' -c '@*[not(contains($xlist,concat($nl,namespace-uri(),$nl)))] | text()' \
"${infile:-file.xml}"</code></pre>
<p>Notes:</p>
<ul>
<li><code>${varname:=…}</code> assigns a default value by <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06_02" title="Shell command language at Open Group (POSIX)"><em>shell parameter expansion</em></a> via the built-in <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_16_01" title="'colon - null utility' at Open Group (POSIX)">colon</a> utility</li>
<li>the namespaces used in the target subtree must be matched by <a href="#select-opt-n"><code>-N «prefix»=«value»</code></a> options if not <a href="#namespaces-use">declared</a> in input’s root element; use <a href="#namespaces-create-null"><code>-N =</code></a> to change the default namespace to the null ditto</li>
<li>the XSLT variable <code>xlist</code> holds the list of namespace URIs to strip, all bookended by newlines to avoid a false match in <code>contains(…)</code>, cf. <a href="#select-opt-value-of"><code>-v (--value-of)</code></a>, so the <code>exclude</code> shell variable may be specified as an XPath string of newline-separated URIs</li>
<li><a href="#select-opt-match"><code>-m (--match)</code></a> changes the current node, recall, any <code>-m '*'</code> lines reaching beyond actual depth match nothing</li>
</ul>
<div class="dinkus1">

</div>
</section>
<section id="sec-edit">
<h2 id="edit" class="shew-tgt">Edit: <code>xmlstarlet edit</code><a href="#edit" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#select"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#format"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p><code>xmlstarlet edit</code> (aka <code>ed</code>) copies its input to output, supporting basic create, update, delete, rename, and move actions (operations).</p>
<p>Note that <code>edit</code></p>
<ul>
<li>executes in an XPath context; it is not an XSLT processor</li>
<li>uses the root node (<code>/</code>) as current node</li>
<li>supports multiple editing actions (operations) in one command – but prefer fewer XPath expressions (<a href="https://www.w3.org/TR/1999/REC-xpath-19991116#NT-UnionExpr" title="W3C XPath 1.0 recommendation">unions</a>!) to more actions</li>
<li>(re)defines its <a href="#edit-prev"><code>$prev</code></a> variable as a back reference to the most recently created node</li>
<li>supports a large subset of EXSLT (but no XSLT) functions in its <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a></li>
<li>by default formats its output</li>
<li>optionally performs <a href="#edit-opt-inplace">in-place</a> editing</li>
</ul>
<p>To do <a href="#add-if-condition">conditional</a> <a href="#update-or-add-if-not-exists">updates</a>, or to dynamically create <code>-n</code> names or <code>-v</code> values for an <code>edit</code> command, it may be worthwhile having <code>xmlstarlet select</code> <a href="#code-generation">generate</a> it.</p>
<h4 id="edit-usage" class="shew-tgt">Usage: <code>edit</code> option […] [action …] [«xml-file-or-uri» …]<a href="#edit-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<div id="toc-edit" class="nav">
<ul>
<li><a href="#edit-non-action-options">Non-action options</a><br/>
<a href="#edit-opt-help"><code>-h (--help)</code></a> | <a href="#edit-opt-omit-decl"><code>-O (--omit-decl)</code></a> | <a href="#edit-opt-pf"><code>-P (--pf)</code></a> | <a href="#edit-opt-ps"><code>-S (--ps)</code></a> | <a href="#edit-opt-inplace"><code>-L (--inplace)</code></a> | <a href="#edit-opt-net"><code>--net</code></a> | <a href="#edit-opt-n"><code>-N «prefix»=«value»</code></a></li>
<li><a href="#edit-action-options">Action options</a><br/>
<a href="#edit-opt-insert"><code>-i (--insert)</code></a> | <a href="#edit-opt-append"><code>-a (--append)</code></a> | <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a> | <a href="#edit-prev">Back reference <code>$prev</code> variable</a> | <a href="#edit-opt-var"><code>--var name 'xpath'</code></a> | <a href="#edit-opt-update-value"><code>-u (--update)</code></a> | <a href="#edit-opt-delete"><code>-d (--delete)</code></a> | <a href="#edit-opt-rename"><code>-r (--rename)</code></a> | <a href="#edit-opt-move"><code>-m (--move)</code></a> | <a href="#edit-xpath-arguments">xpath arguments</a> | <a href="#edit-exslt-in-xpath-arguments">EXSLT in xpath arguments</a> | <a href="#no-kidding-issue">“No kidding” issue</a></li>
<li><a href="#edit-examples">Examples</a><br/>
<a href="#insert-html-link">Insert HTML <code>&lt;link …/&gt;</code></a> | <a href="#toggle-01-or-falsetrue">Toggle 0/1 or false/true</a> | <a href="#replace-text">Replace text</a> | <a href="#update-or-add-if-not-exists">Update or add if not exists</a> | <a href="#add-if-condition">Add if «condition»</a> | <a href="#duplicate-an-element-keep-the-formatting">Duplicate an element, keep the formatting</a> | <a href="#edit-moving-nodes">Moving nodes using <code>edit</code> <code>-m</code> or <code>-a</code>, <code>-u</code>, <code>-r</code>, <code>-d</code></a> | <a href="#divide-a-document-into-sections">Divide a document into sections</a> | <a href="#try-out-xmlstarlet-edits-formatting-options">Try out <code>edit</code>’s formatting options</a></li>
</ul>
</div>
<h3 id="edit-non-action-options" class="shew-tgt">Non-action options<a href="#edit-non-action-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#edit"></a><a class="relnext shew-hover" href="#edit-action-options"></a><a class="rellast shew-hover" href="#edit-examples"></a></div></h3>
<h4 id="edit-opt-help" class="shew-tgt"><code>-h (--help)</code> - display help<a href="#edit-opt-help" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="edit-opt-omit-decl" class="shew-tgt"><code>-O (--omit-decl)</code> - omit XML declaration<a href="#edit-opt-omit-decl" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="edit-opt-pf" class="shew-tgt"><code>-P (--pf)</code> - preserve original formatting<a href="#edit-opt-pf" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="edit-opt-ps" class="shew-tgt"><code>-S (--ps)</code> - preserve non-significant spaces<a href="#edit-opt-ps" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-O (--omit-decl)</code>, <code>-P (--pf)</code>, and <code>-S (--ps)</code> set/unset <code>libxml2</code> flags, cf. <a href="#xml-parsing-and-serialization">XML parsing and serialization</a>.</p>
<p><em>See also</em>: <a href="#try-out-xmlstarlet-edits-formatting-options">Try out <code>edit</code>’s formatting options</a> | <a href="#select-opt-indent"><code>select -I (--indent)</code></a></p>
<h4 id="edit-opt-inplace" class="shew-tgt"><code>-L (--inplace)</code> - edit input file(s) in-place<a href="#edit-opt-inplace" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>This option</p>
<ul>
<li>produces no terminal output unless there are error messages</li>
<li>is ignored – sending output to <code>stdout</code> – if input is <code>stdin</code></li>
<li>makes no backup of input</li>
<li>is mentioned in <a href="https://fossies.org/linux/xmlstarlet/doc/xmlstarlet.txt">doc/xmlstarlet.txt</a> but not in the user’s guide</li>
<li>has a known bug for filenames containing urlencoded characters, e.g. <code>%20</code>, cf. <a href="#global-options">Global options and parameters</a></li>
<li>formats the input file(s) unless option <a href="#edit-opt-pf"><code>-P (--pf)</code></a> is given</li>
<li>updates the timestamps of the input file(s) even if output is identical to input</li>
</ul>
<h4 id="edit-opt-net" class="shew-tgt"><code>--net</code> - allow network access<a href="#edit-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#global-opt-net">network access</a></p>
<h4 id="edit-opt-n" class="shew-tgt"><code>-N «prefix»=«value»</code> - declare namespaces<a href="#edit-opt-n" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>This option is repeatable; must be last non-action option(s). E.g. <code>-N xsql='urn:oracle-xsql'</code>.</p>
<p>Not needed for <a href="#namespaces-use">predefined namespaces</a> or those declared in input’s root element (<a href="#global-opt-doc-namespace"><code>--doc-namespace</code></a>) but required</p>
<ul>
<li>for namespaces not declared in input’s root element</li>
<li>when the <a href="#global-opt-no-doc-namespace"><code>--no-doc-namespace</code></a> global option is in effect</li>
</ul>
<p><em>See</em>: <a href="#namespaces-use">Use a namespace</a> | <a href="#select-opt-n"><code>select -N</code></a></p>
<div class="dinkus3">

</div>
<p><span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet edit</code> isn’t an XSLT processor so with or without the <code>-N …</code> option,</p>
<pre class="lang-sh"><code>printf '%s' '&lt;a/&gt;' |
xmlstarlet edit --pf -O -N b='https://www.example.org/b' \
  -s '*' -t elem -n 'b:c' -v 'd'</code></pre>
<p>generates:</p>
<pre class="lang-xml"><code>&lt;a&gt;&lt;b:c&gt;d&lt;/b:c&gt;&lt;/a&gt;</code></pre>
<p><em>See also</em>: <a href="#create-a-soap-envelope">Create a SOAP envelope</a></p>
<h3 id="edit-action-options" class="shew-tgt">Action options<a href="#edit-action-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#edit-non-action-options"></a><a class="relup shew-hover" href="#edit"></a><a class="relnext shew-hover" href="#edit-examples"></a><span class="relnop shew-hover"></span></div></h3>
<h4 id="edit-opt-insert" class="shew-tgt"><code>-i (--insert)</code> - add node before<a href="#edit-opt-insert" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="edit-opt-append" class="shew-tgt"><code>-a (--append)</code> - add node after<a href="#edit-opt-append" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="edit-opt-subnode" class="shew-tgt"><code>-s (--subnode)</code> - add node as child<a href="#edit-opt-subnode" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>There are 3 ways to add an element, an attribute, or a text node to each member of a nodeset:</p>
<p><code>xmlstarlet edit OP xpath -t node-type -n node-name -v value</code></p>
<p>where</p>
<ul>
<li><code>xpath</code> is an <a href="#edit-xpath-arguments"><code>xpath</code> argument</a></li>
<li><code>OP</code> is one of:
<ul>
<li><code>-i (--insert)</code> - insert before <code>xpath</code> as preceding sibling</li>
<li><code>-a (--append)</code> - insert after <code>xpath</code> as following sibling</li>
<li><code>-s (--subnode)</code> - append as last child of <code>xpath</code></li>
<li>all (re)define the special <a href="#edit-prev"><code>$prev</code></a> (aka <code>$xstar:prev</code>) variable</li>
<li><span class="caution"><strong>Caution</strong></span>: <code>-i</code> and <code>-a</code> accept the root element (document element) as <code>xpath</code></li>
</ul></li>
<li><code>-t (--type) node-type</code> selects one of these node types:
<ul>
<li><code>elem</code> - element</li>
<li><code>attr</code> - attribute; <code>-i</code>, <code>-a</code>, and <code>-s</code> all create an attribute in the <code>xpath</code> element but do not influence attribute order</li>
<li><code>text</code> - text</li>
</ul></li>
<li><code>-n (--name) node-name</code> selects an XML <a href="https://www.w3.org/TR/xml-names11/#ns-qualnames" title="Namespaces in XML 1.1 - W3C recommendation">QName</a>, e.g. <code>item</code> or <code>svg:g</code>; required (and ignored) for <code>text</code> nodes<br/>
<span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet edit</code> will accept names such as <code>!--</code> and <code>, &lt;&amp;&gt; .</code> without turning a hair, cf. <a href="#edit-opt-rename"><code>-r (--rename)</code></a>.<br/>
<span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet edit</code> will create a namespace-prefixed element like <code>svg:g</code> but it will not be available as such in following <code>edit</code> actions (<a href="#namespaces-insert-issue">explanation</a>); workaround: use <a href="#edit-prev"><code>$prev</code></a>.<br/>
</li>
<li><code>-v (--value) value</code> may be omitted if creating an empty <code>elem</code> or <code>attr</code> node but it’s required for <code>text</code>, e.g.  <code>-a 'bean' -t text -n ignored -v ''</code>.<br/>
<strong>NB</strong>: Diverging from the general rule, references to the XML special character entities (<code>&amp;quot;</code>, <code>&amp;lt;</code> a.o.) and certain numeric character references (<code>&amp;#x9;</code> a.o.) are recognized in the <code>value</code> text – <em>when used with</em> <code>-t (--type) elem</code> – in which case <code>&amp;amp;</code> is required to represent <code>&amp;</code> (ampersand), cf. example at <a href="#special-characters">special characters</a>. (For <code>value</code> used with type <code>attr</code> or type <code>text</code> the general rule applies.)</li>
</ul>
<p>Basic usecase (<code>v/e</code> may replace <code>$prev</code> here):</p>
<pre class="lang-shell"><code>$ printf '%s' '&lt;v/&gt;' |
  xmlstarlet edit -O \
    -s 'v' -t elem -n 'e' -v '42' \
    -s '$prev' -t attr -n 'a' -v 'y'
&lt;v&gt;
  &lt;e a="y"&gt;42&lt;/e&gt;
&lt;/v&gt;</code></pre>
<p><em>Examples</em>: <a href="https://fossies.org/linux/xmlstarlet/examples/ed-append" title="Fossies - the Fresh Open Source Software Archive">examples/ed-append</a> | <a href="https://fossies.org/linux/xmlstarlet/examples/ed-insert" title="Fossies - the Fresh Open Source Software Archive">examples/ed-insert</a> | <a href="https://fossies.org/linux/xmlstarlet/examples/ed-subnode" title="Fossies - the Fresh Open Source Software Archive">examples/ed-subnode</a> | <a href="#insert-html-link">Insert HTML <code>&lt;link …/&gt;</code></a></p>
<p><em>See also</em>: <a href="#edit-opt-update-expr"><code>-u (--update)</code></a></p>
<h4 id="edit-prev" class="shew-tgt">Back reference <code>$prev</code> variable (aka <code>$xstar:prev</code>)<a href="#edit-prev" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>The <code>$prev</code> (aka <code>$xstar:prev</code>) variable refers to the nodeset created by the most recent <a href="#edit-opt-insert"><code>-i (--insert)</code></a>, <a href="#edit-opt-append"><code>-a (--append)</code></a>, or <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a> option, which all define or redefine it. To reset <code>$prev</code> (to avoid a false match later) for example <code>-a '/..' -t elem -n nil</code> which fails as the root node has no parent.</p>
<p><code>$prev</code> isn’t mentioned in the user’s guide; examples are given in <a href="https://fossies.org/linux/xmlstarlet/doc/xmlstarlet.txt">doc/xmlstarlet.txt</a> and in this section.</p>
<h4 id="edit-opt-var" class="shew-tgt"><code>--var name 'xpath'</code><a href="#edit-opt-var" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>The <code>--var name xpath</code> option to define an <code>xmlstarlet edit</code> variable is mentioned in <a href="https://fossies.org/linux/xmlstarlet/doc/xmlstarlet.txt">doc/xmlstarlet.txt</a> but not in the user’s guide. It uses a different format than <code>select</code>’s <a href="#select-opt-var-equals"><code>--var</code></a>.</p>
<p>Examples:</p>
<pre class="lang-sh"><code>xmlstarlet edit --inplace \
  --var T '//_:p[@class="eyg"] | //_:span[contains(@class,"eyg_")]' \
  --var res "$((3 * 7 * 2))" \
  -u '$T' -x 'concat(.,", currently ",$res)' \
file.xhtml</code></pre>
<pre class="lang-sh"><code>xmlstarlet edit \
  -s '/doc/abc' -t elem -n 'ns:nd' \
  --var nsnd '$prev' \
  # ...</code></pre>
<p><em>See also</em>: <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a> | <a href="#edit-opt-update-expr"><code>-u (--update)</code></a> | <a href="#edit-prev"><code>$prev</code></a></p>
<h4 id="edit-opt-update-value" class="shew-tgt"><code>-u (--update) 'xpath' -v (--value) 'value'</code><a href="#edit-opt-update-value" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="edit-opt-update-expr" class="shew-tgt"><code>-u (--update) 'xpath' -x (--expr) 'xpath'</code><a href="#edit-opt-update-expr" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>There are 2 ways to modify the value of each member of a nodeset:</p>
<ul>
<li><code>xmlstarlet edit -u (--update) 'xpath' -v (--value) 'value'</code></li>
<li><code>xmlstarlet edit -u (--update) 'xpath' -x (--expr) 'xpath'</code></li>
</ul>
<p>where</p>
<ul>
<li><code>-u 'xpath'</code> is an <a href="#edit-xpath-arguments"><code>xpath</code> argument</a> describing the destination nodeset<br/>
<span class="caution"><strong>Caution</strong></span>: <strong>beware</strong> of the <a href="#no-kidding-issue">“no kidding” issue</a></li>
<li><code>-v</code> expects a literal value, e.g. <code>hello</code>, <code>'a b c&lt;&amp;d&gt;'</code>, or <code>"$(grep -e '^rev' abc.txt)"</code></li>
<li><code>-x 'xpath'</code> is one of:
<ul>
<li>a non-relative <a href="#edit-xpath-arguments"><code>xpath</code> argument</a>: all <code>-u</code> nodes updated with same value / nodeset / variable</li>
<li>a relative <a href="#edit-xpath-arguments"><code>xpath</code> argument</a>: <code>-u</code> nodes updated with whatever the XPath resolves to,<br/>
for example:
<ul>
<li>update number: <code>-u '…' -x '. * 1.25'</code><br/>
</li>
<li>update text: <code>-u '…' -x 'concat("prefix-",.,"-suffix")'</code><br/>
</li>
<li>copy attribute node: <code>-u '…' -x '../../@name'</code><br/>
</li>
<li>copy attribute value: <code>-u '…' -x 'string(../../@name)'</code></li>
</ul></li>
</ul></li>
</ul>
<p><code>-x</code> makes a deep copy of its argument. Given an element <code>e</code>, <code>&lt;e a="v"&gt;&lt;c1/&gt;&lt;c2/&gt;&lt;/e&gt;</code>, <code>-x 'e'</code> copies the entire thing whereas <code>-x 'e/node() | e/@*'</code> copies <code>e</code>’s child nodes and <code>e</code>’s attribute nodes (cf. the <em>many-to-many</em> move <a href="#edit-moving-nodes-many-to-many">example</a>). (Attributes are not children of their parent – <a href="https://web.archive.org/web/20180305021934/http://www.dpawson.co.uk/xsl/sect2/N1553.html#d2256e190">background</a>.)</p>
<p>Creation of a new (empty) node is often followed by an update using <a href="#edit-prev"><code>$prev</code></a>, for example to enable an <code>-x</code> expression:</p>
<pre class="lang-sh"><code>xmlstarlet edit --inplace \
  -s '*' -t elem -n entry \
  -u '$prev' -x 'date:date-time()' \
  -s '$prev' -t attr -n user -v "${LOGNAME}" \
log.xml</code></pre>
<p><em>See also</em>: <a href="#edit-moving-nodes">Moving nodes</a></p>
<h4 id="edit-opt-delete" class="shew-tgt"><code>-d (--delete) 'xpath'</code><a href="#edit-opt-delete" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a> | <a href="#namespaces-delete">Delete a namespace</a></p>
<h4 id="edit-opt-rename" class="shew-tgt"><code>-r (--rename) 'xpath' -v (--value) 'new-name'</code><a href="#edit-opt-rename" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>new-name</code> is an XML <a href="https://www.w3.org/TR/xml-names11/#ns-qualnames" title="Namespaces in XML 1.1 - W3C recommendation">QName</a> such as <code>item</code> or <code>svg:g</code>.</p>
<p><span class="caution"><strong>Caution</strong></span>: The <code>-v (--value)</code> clause of this option admits its <code>new-name</code> argument unmodifed – accepting an empty string or one containing tab, newline, XML <a href="#special-characters">special characters</a> a.o. – ignoring XML QName requirements. In this respect it works like the <code>-n (--name)</code> clause of the <code>-i</code>, <code>-a</code>, and <a href="#edit-opt-subnode"><code>-s</code></a> options.</p>
<p><em>See also</em>: <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a> | <a href="#rename-elements">Rename elements</a> example</p>
<h4 id="edit-opt-move" class="shew-tgt"><code>-m (--move) 'xpath1' 'xpath2'</code><a href="#edit-opt-move" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>The source (<code>xpath1</code>) of the <code>-m (--move)</code> action can be nodes other than root and namespace: element, attribute, text, comment, or processing instruction.</p>
<p>The destination (<code>xpath2</code>) must be a single element (the only container node) – otherwise <code>xmlstarlet</code> exits with an <a href="#error-move-destination-is-not-a-single-node">error</a> message and a non-zero return code. Source nodes will be appended as last nodes at destination.</p>
<p><span class="caution"><strong>Caution</strong></span>: With overlapping source and destination <code>--move</code> completes with exit value 0 and no messages.</p>
<p><span class="caution"><strong>Caution</strong></span>: <code>-m (--move)</code> causes a segmentation fault (exit value 139) if attempting a many-to-many move.</p>
<p><em>See also</em>: <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a> | <a href="#edit-moving-nodes">Moving nodes</a> | <a href="#namespaces-move">Move a namespace</a></p>
<h4 id="edit-xpath-arguments" class="shew-tgt"><code>xpath</code> arguments<a href="#edit-xpath-arguments" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>For the <code>xpath</code> argument – in the <code>-i</code>, <code>-a</code>, <code>-s</code>, <code>-d</code>, <code>-r</code>, <code>-m</code>, <code>-u</code>, <code>-x</code>, and <code>--var</code> options – <code>xmlstarlet edit</code> can use an XPath 1.0 expression, incl. XPath 1.0 functions<sup>[1]</sup> and <a href="#edit-exslt-in-xpath-arguments" title="EXSLT in `xpath` arguments">selected</a> EXSLT functions, but using XSLT functions such as <code>current()</code>, <code>document()</code>, <code>generate-id()</code>, or <code>format-number()</code> triggers (as expected) the error <code>xmlXPathCompOpEval: function «name» not found</code>.</p>
<p><sup>[1]</sup> The XPath functions <code>position()</code> and <code>last()</code> rely on an <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#dt-context-node" title="W3C XPath 1.0 recommendation">evaluation context</a>. With <code>xmlstarlet edit</code> they can be used inside an XPath predicate (e.g. <code>--move '…' '…[last()]'</code>) – <code>last()</code> returning the context size – but used outside (as in <code>-u '…' -x 'substring("abcdef",position(),1)'</code>) triggering an <code>Invalid context position</code> error or an <code>Invalid context size</code> error.</p>
<p><code>position()</code> alternative: <code>1 + count(preceding-sibling::«node»)</code> or <code>count(preceding::«node»)</code>.</p>
<h4 id="edit-exslt-in-xpath-arguments" class="shew-tgt">EXSLT in <code>xpath</code> arguments<a href="#edit-exslt-in-xpath-arguments" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>Based on the <code>exslt«name»XpathCtxtRegister</code> functions in <a href="https://gnome.pages.gitlab.gnome.org/libxslt/EXSLT/devhelp/libexslt-exslt.html"><code>libexslt</code></a> <code>xmlstarlet edit</code> supports selected functions from the <a href="#exslt">EXSLT</a> modules <code>dates-and-times</code>, <code>math</code>, <code>sets</code>, and <code>strings</code> in its <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a>:</p>
<ul>
<li>from <code>dates-and-times</code> in namespace <code>date</code>, cf.  <a href="https://gitlab.gnome.org/GNOME/libxslt/-/blob/master/libexslt/date.c#L3786">libexslt/date.c</a>,<br/>
<code>add</code>, <code>add-duration</code>, <code>date</code>, <code>date-time</code>, <code>day-abbreviation</code>, <code>day-in-month</code>, <code>day-in-week</code>, <code>day-in-year</code>, <code>day-name</code>, <code>day-of-week-in-month</code>, <code>difference</code>, <code>duration</code>, <code>hour-in-day</code>, <code>leap-year</code>, <code>minute-in-hour</code>, <code>month-abbreviation</code>, <code>month-in-year</code>, <code>month-name</code>, <code>second-in-minute</code>, <code>seconds</code>, <code>sum</code>, <code>time</code>, <code>week-in-month</code>, <code>week-in-year</code>, <code>year</code><br/>
</li>
<li>from <code>math</code> in namespace <code>math</code>, cf.  <a href="https://gitlab.gnome.org/GNOME/libxslt/-/blob/master/libexslt/math.c#L1091">libexslt/math.c</a>,<br/>
<code>abs</code>, <code>acos</code>, <code>asin</code>, <code>atan</code>, <code>atan2</code>, <code>constant</code>, <code>cos</code>, <code>exp</code>, <code>highest</code>, <code>log</code>, <code>lowest</code>, <code>max</code>, <code>min</code>, <code>power</code>, <code>random</code>, <code>sin</code>, <code>sqrt</code>, <code>tan</code></li>
<li>from <code>sets</code> in namespace <code>set</code>, cf.  <a href="https://gitlab.gnome.org/GNOME/libxslt/-/blob/master/libexslt/sets.c#L284">libexslt/sets.c</a>,<br/>
<code>difference</code>, <code>distinct</code>, <code>has-same-node</code>, <code>intersection</code>, <code>leading</code>, <code>trailing</code></li>
<li>from <code>strings</code> in namespace <code>str</code>, cf.  <a href="https://gitlab.gnome.org/GNOME/libxslt/-/blob/master/libexslt/strings.c#L854">libexslt/strings.c</a>,<br/>
<code>align</code>, <code>concat</code>, <code>decode-uri</code>, <code>encode-uri</code>, <code>padding</code></li>
</ul>
<p>All <code>date</code>, <code>math</code>, and <code>set</code> are there but note the absence of <code>str:replace</code> (removed from <code>xmlstarlet edit</code> in <a href="#exslt">2012</a>), <code>str:split</code>, and <code>str:tokenize</code>.</p>
<div class="dinkus3">

</div>
<p><q>Hello, EXSLT</q>:</p>
<pre class="lang-sh"><code>printf '%s' '&lt;v y="." e="." pi="." z="." r="."/&gt;' | 
xmlstarlet edit -O \
  --var e 'math:constant("E",10)' \
  -u '*/@*[math:power(1e3,0)]' -x 'date:day-name("2011-09-24")' \
  -u '*/@e' -x '$e' \
  -u '*/@z' -x 'count(set:distinct(/*/@*))' \
  -u '*/@pi' -x 'math:constant("PI",10)' \
  -u '*/@r' -x '$e*/*/@z*/*/@pi' \
  -r '*/@*[starts-with(.,str:align(25,"  "))]' -v 'ezpi'</code></pre>
<p>The number <code>1e3</code> (in <a href="https://en.wikipedia.org/wiki/Scientific_notation" title="Article on Wikipedia">scientific notation</a>) isn’t XPath 1.0 but <a href="#numeric-representation">understood</a> by <a href="#selected-resources"><code>libxml2</code></a>.</p>
<p>Output:</p>
<pre class="lang-none"><code>&lt;v y="Saturday" e="2.71828182" pi="3.14159265" z="3" ezpi="25.6192025590219"/&gt;</code></pre>
<p><em>See also</em>: <a href="#divide-a-document-into-sections">Divide a document into sections</a> example</p>
<h4 id="no-kidding-issue" class="shew-tgt">“No kidding” issue<a href="#no-kidding-issue" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p><span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet edit -u '…' -x '…'</code> silently <strong>deletes</strong> the first child node at destination (whether absolute or relative <code>-x</code> XPath expression), <code>-u '…' -v '…'</code> silently <strong>deletes</strong> all child nodes. This suggests that the <a href="#edit-opt-update-value"><code>-u (--update)</code></a> option is intended to modify leaf nodes (aka <a href="https://en.wikipedia.org/wiki/Tree_(data_structure)#Terminology" title="Wikipedia: Tree (data structure)">external nodes</a>) but <code>xmlstarlet</code>’s silence in this matter extends to both documentation and source code.</p>
<p><em>Links</em>: <a href="https://fossies.org/linux/xmlstarlet/src/xml_edit.c#l_245" title="Fossies - the Fresh Open Source Software Archive">src/xml_edit.c#edUpdate()</a></p>
<p>Given this input,</p>
<pre class="lang-xml"><code>&lt;r&gt;&lt;a&gt;&lt;a1 k="v1"&gt;V1&lt;/a1&gt;
      &lt;a2 k="v2"&gt;V2&lt;/a2&gt;&lt;/a&gt;
   &lt;b&gt;&lt;b1&gt;&lt;D/&gt;&lt;/b1&gt;&lt;b2/&gt;&lt;b3&gt;&lt;F1/&gt;&lt;F2/&gt;&lt;/b3&gt;&lt;/b&gt;
&lt;/r&gt;</code></pre>
<pre class="lang-xml"><code>xmlstarlet edit -O -P \
  -u 'r/b/*' -x '../../a/a1/text()' \
"${infile:-file.xml}"</code></pre>
<p>produces:</p>
<pre class="lang-xml"><code>&lt;r&gt;&lt;a&gt;&lt;a1 k="v1"&gt;V1&lt;/a1&gt;
      &lt;a2 k="v2"&gt;V2&lt;/a2&gt;&lt;/a&gt;
   &lt;b&gt;&lt;b1&gt;V1&lt;/b1&gt;&lt;b2&gt;V1&lt;/b2&gt;&lt;b3&gt;&lt;F2/&gt;V1&lt;/b3&gt;&lt;/b&gt;
&lt;/r&gt;</code></pre>
<div class="dinkus3">

</div>
<p>Workaround for <code>-x</code>: insert a sacrificial element (or non-whitespace text) node as first child. The <a href="#edit-opt-insert"><code>-i (--insert)</code></a> option has no effect if no nodes exist on destination’s child axis.</p>
<pre class="lang-xml"><code>xmlstarlet edit -O -P \
  -i 'r/b/*/node()[1]' -t elem -n 'herenow' \
  -u 'r/b/*' -x '../../a/a1/text()' \
"${infile:-file.xml}"</code></pre>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;r&gt;&lt;a&gt;&lt;a1 k="v1"&gt;V1&lt;/a1&gt;
      &lt;a2 k="v2"&gt;V2&lt;/a2&gt;&lt;/a&gt;
   &lt;b&gt;&lt;b1&gt;&lt;D/&gt;V1&lt;/b1&gt;&lt;b2&gt;V1&lt;/b2&gt;&lt;b3&gt;&lt;F1/&gt;&lt;F2/&gt;V1&lt;/b3&gt;&lt;/b&gt;
&lt;/r&gt;</code></pre>
<p>If instead <code>-i …  -u 'r/b/*' -v 'gonethere'</code>:</p>
<pre class="lang-xml"><code>…  &lt;b&gt;&lt;b1&gt;gonethere&lt;/b1&gt;&lt;b2&gt;gonethere&lt;/b2&gt;&lt;b3&gt;gonethere&lt;/b3&gt;&lt;/b&gt; …</code></pre>
<h3 id="edit-examples" class="shew-tgt">Examples<a href="#edit-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><a class="relfirst shew-hover" href="#edit-non-action-options"></a><a class="relprev shew-hover" href="#edit-action-options"></a><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="insert-html-link" class="shew-tgt">Insert HTML <code>&lt;link …/&gt;</code><a href="#insert-html-link" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl --pf \
  -s '/_:html/_:head' -t elem -n link \
  --var lk '$prev' \
  -s '$lk' -t attr -n 'rel' -v 'stylesheet' \
  -s '$lk' -t attr -n 'type' -v 'text/css' \
  -s '$lk' -t attr -n 'href' -v 'style/www.css' \
in.xhtml &gt; out.xhtml</code></pre>
<p>… <code>&lt;link rel="stylesheet" type="text/css" href="style/www.css"/&gt;</code> …</p>
<p><em>See also</em>: <a href="#edit-opt-pf"><code>-P (--pf)</code></a> | <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a> | <a href="#edit-opt-var"><code>--var</code></a> | <a href="#edit-prev"><code>$prev</code></a> | <a href="#namespaces-use">Use a namespace</a></p>
<h4 id="toggle-01-or-falsetrue" class="shew-tgt">Toggle 0/1 or false/true<a href="#toggle-01-or-falsetrue" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-shell"><code>$ cat file.xml
&lt;doc&gt;&lt;e f="0"&gt;false&lt;c&gt;false&lt;/c&gt;&lt;/e&gt;&lt;/doc&gt;
$ :
$ xmlstarlet edit -L -O --pf --var T 'doc/e/@f' -u '$T' -x '($T+1) mod 2' file.xml
$ cat file.xml
&lt;doc&gt;&lt;e f="1"&gt;false&lt;c&gt;false&lt;/c&gt;&lt;/e&gt;&lt;/doc&gt;
$ :
$ xmlstarlet edit -O --pf --var T 'doc/e/text()' -u '$T' -x 'not($T="true")' file.xml
&lt;doc&gt;&lt;e f="1"&gt;true&lt;c&gt;false&lt;/c&gt;&lt;/e&gt;&lt;/doc&gt;</code></pre>
<p>The <a href="#edit-opt-inplace"><code>-L (--inplace)</code></a> option edits the input file in-place.</p>
<p><em>See also</em>: <a href="#edit-opt-pf"><code>-P (--pf)</code></a> | <a href="#edit-opt-var"><code>--var</code></a> | <a href="#edit-opt-update-expr"><code>-u (--update)</code></a></p>
<h4 id="replace-text" class="shew-tgt">Replace text<a href="#replace-text" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>The EXSLT function <code>str:replace</code> was removed from <code>xmlstarlet edit</code> in <a href="#exslt">2012</a> so it’s either straight XPath 1.0:</p>
<pre class="lang-sh"><code>xmlstarlet edit -O \
  -u 'doc/e' \
  -x 'concat(substring-before(.,"&amp;text=Ulysses"),
              substring-after(.,"&amp;text=Ulysses"))' \
"${infile:-file.xml}"</code></pre>
<p>or invoke <code>xmlstarlet select</code> first to apply <code>str:replace</code>:</p>
<pre class="lang-sh"><code>avar="$(xmlstarlet select --text -t \
  -v 'str:replace(doc/e,"&amp;text=Ulysses","")' "${infile:-file.xml}")"
xmlstarlet edit -O -u 'doc/e' -v "${avar}" "${infile:-file.xml}"</code></pre>
<p>With this XML input:</p>
<pre class="lang-xml"><code>&lt;doc&gt;
  &lt;e&gt;abcdefghi/q?sid=ry12345&amp;amp;text=Ulysses&amp;amp;ofmt=x'"ml&lt;/e&gt;
&lt;/doc&gt;</code></pre>
<p>both commands produce:</p>
<pre class="lang-xml"><code>&lt;doc&gt;
  &lt;e&gt;abcdefghi/q?sid=ry12345&amp;amp;ofmt=x'"ml&lt;/e&gt;
&lt;/doc&gt;</code></pre>
<p><em>See also</em>: <a href="#pyx"><code>pyx</code>, <code>depyx</code></a></p>
<h4 id="update-or-add-if-not-exists" class="shew-tgt">Update or add if not exists<a href="#update-or-add-if-not-exists" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>If a record <code>rec</code> has a <code>desc</code> element add the text of the sibling <code>name</code> element to it, otherwise add a new <code>desc</code> element and set its value to the text of <code>name</code>.</p>
<pre class="lang-sh"><code>xmlstarlet edit \
  -u '//recs/rec/desc' -x 'concat(.," - ",../name/text())' \
  -a '//recs/rec[not(desc)]/name' -t elem -n 'desc' \
  -u '$prev' -x '../name/text()' \
"${infile:-file.xml}"</code></pre>
<p><em>See also</em>: <a href="#edit-opt-update-expr"><code>-u (--update)</code></a> | <a href="#edit-opt-append"><code>-a (--append)</code></a> | <a href="#edit-prev"><code>$prev</code></a> | <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a></p>
<div class="dinkus3">

</div>
<p>If <code>desc</code> and <code>name</code> are attributes, instead:</p>
<pre class="lang-sh"><code>xmlstarlet edit \
  -u '//recs/rec/@desc' -x 'concat(.," - ",../@name)' \
  -s '//recs/rec[not(@desc)]' -t attr -n 'desc' \
  -u '$prev' -x 'string(../@name)' \
"${infile:-file.xml}"</code></pre>
<p>Note that <code>-x 'string(../@name)'</code> – and <code>../@name</code> as a <code>concat()</code> string argument – copies the attribute value, <code>-x '../@name'</code> the attribute node; the latter fails as attributes cannot contain other nodes (causing an empty value to be assigned to <code>@desc</code>).</p>
<h4 id="add-if-condition" class="shew-tgt">Add if «condition»<a href="#add-if-condition" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet edit</code> has no <code>if-then-else</code> construct so the following snippets use standard XPath 1.0 <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#predicates" title="W3C XPath 1.0 recommendation">expressions</a> and <code>edit</code>’s back reference <a href="#edit-prev"><code>$prev</code></a> variable to apply conditions. All use the following nodeset variable:</p>
<pre class="lang-sh"><code>--var T '/Server/Service[@name="Catalina"]'</code></pre>
<p>Add <code>$T/Connector</code> after last ditto:</p>
<pre class="lang-sh"><code>-a '$T/Connector[last()]' -t elem -n Connector \
--var C '$prev' -s '$C' -t attr -n port -v '7654'</code></pre>
<p>Nothing is added if no <code>$T/Connector</code> node exists – in which case <code>$prev</code> becomes <code>null</code> and <code>-s '$C' …</code> has no effect – otherwise a <code>Connector</code> element is appended as first following sibling (to become the new last <code>Connector</code>) and given a <code>port</code> attribute.</p>
<div class="dinkus3">

</div>
<p>Add <code>$T/Connector</code> if not exists, as last child of <code>$T</code>:</p>
<pre class="lang-sh"><code>-s '$T[not(Connector)]' -t elem -n Connector \
--var C '$prev' -s '$C' -t attr -n port -v '8765'</code></pre>
<p>Nothing is added if a <code>$T/Connector</code> node exists – if the first <code>-s …</code> matches nothing then the second <code>-s …</code> (due to a <code>null</code> <code>$prev</code>) will match nothing.</p>
<div class="dinkus3">

</div>
<p>Add <code>$T/Connector</code> if not exists, after <code>$T/Executor[1]</code> if exists:</p>
<pre class="lang-sh"><code>-a '$T[not(Connector)]/Executor[1]' -t elem -n Connector \
--var C '$prev' -s '$C' -t attr -n port -v '9876'</code></pre>
<p>Nothing is added if a <code>$T/Connector</code> node exists or no <code>$T/Executor</code> node exists, otherwise appended as first following sibling of first <code>$T/Executor</code>.</p>
<div class="dinkus3">

</div>
<p><em>See also</em>: <a href="#edit-opt-var"><code>--var</code></a> | <a href="#edit-opt-append"><code>-a (--append)</code></a> | <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a> | <a href="#edit-prev"><code>$prev</code></a> | <a href="#edit-opt-update-expr"><code>-u (--update)</code></a></p>
<h4 id="duplicate-an-element-keep-the-formatting" class="shew-tgt">Duplicate an element, keep the formatting<a href="#duplicate-an-element-keep-the-formatting" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>This code duplicates a <code>bean</code> element from a formatted input file, inserts the copy right after the original, changing its <code>@id</code>, and restores the inter-element whitespace that was. Use with <code>edit</code>’s <a href="#edit-opt-pf"><code>-P (--pf)</code></a> or <a href="#edit-opt-ps"><code>-S (--ps)</code></a> option.</p>
<pre class="lang-sh"><code>xmlstarlet edit --ps \
  --var N '/beans/bean[@id="bean4"]' \
  --var ws '$N/following::text()[1][normalize-space()=""]' \
  -a '$N' -t elem -n bean \
  -u '$prev' -x '$N/node() | $N/@*' \
  -u '$prev/@id' -v 'bean4a' \
  -i '$prev' -t text -n whitespace -v '' \
  -u '$prev' -x '$ws' \
file.xml &gt; newfile.xml</code></pre>
<p>Notes:</p>
<ul>
<li><code>--var N</code> references the original <code>bean</code> element</li>
<li>variable <code>ws</code> holds the first text node after original, provided it’s all whitespace (otherwise empty)</li>
<li><code>-a …</code> appends a new empty <code>bean</code> element as a <em>following-sibling</em> of the original</li>
<li>the first 3 <code>$prev</code>s refer to the new element</li>
<li>first <code>-u …</code> makes a deep copy of the original’s child and attribute nodes</li>
<li><code>-i … -u …</code> copies the whitespace following the original <code>bean</code>, to keep the formatting</li>
<li>a new node of type <code>text</code> requires a (dummy) name and an initial value</li>
<li>the 4th <code>$prev</code> refers to the text node created by <code>-i</code></li>
</ul>
<p><em>See also</em>: <a href="#edit-opt-var"><code>--var</code></a> | <a href="#edit-opt-append"><code>-a (--append)</code></a> | <a href="#edit-opt-update-expr"><code>-u (--update)</code></a> | <a href="#edit-prev"><code>$prev</code></a> | <a href="#edit-opt-insert"><code>-i (--insert)</code></a></p>
<h4 id="edit-moving-nodes" class="shew-tgt">Moving nodes using <code>xmlstarlet edit -m or -a, -u, -r, -d</code><a href="#edit-moving-nodes" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>The basic usecases for moving XML nodes (<a href="#namespaces-move">except</a> namespace nodes) from source to destination are:</p>
<ul>
<li><em>one-to-one</em></li>
<li><em>many-to-one</em></li>
<li><em>many-to-many</em></li>
</ul>
<p>The ground rules are:</p>
<ul>
<li>the <a href="#edit-opt-move"><code>-m (--move)</code></a> action can handle the <em>one-to-one</em> or <em>many-to-one</em> usecases if nodes are to be appended at destination (an element node)</li>
<li>any move can be handled by a series of actions involving
<ul>
<li><a href="#edit-opt-insert"><code>-i (--insert)</code></a> or <a href="#edit-opt-append"><code>-a (--append)</code></a></li>
<li><a href="#edit-opt-update-expr"><code>-u (--update) … -x (--expr) …</code></a></li>
<li><a href="#edit-opt-delete"><code>-d (--delete) …</code></a></li>
<li>possibly <a href="#edit-opt-rename"><code>-r (--rename) …</code></a></li>
</ul></li>
<li>moving to position N is sometimes implied, e.g. move to replace an ancestor (untagging), or required, e.g. to keep a list ordered</li>
<li><a href="#edit-opt-var"><code>--var name 'xpath'</code></a> collects a nodeset in a named variable</li>
<li>the back reference <a href="#edit-prev"><code>$prev</code></a> variable refers to the node created by the most recent <code>-i (--insert)</code>, <code>-a (--append)</code>, or <code>-s (--subnode)</code> action</li>
<li>the source (<code>-x</code>) <code>xpath</code> of the <a href="#edit-opt-update-expr"><code>-u (--update)</code></a> action can be relative or non-relative</li>
<li>prefer fewer XPath expressions (<a href="https://www.w3.org/TR/1999/REC-xpath-19991116#NT-UnionExpr" title="W3C XPath 1.0 recommendation">unions</a>!) to more actions</li>
<li><span class="caution"><strong>Caution</strong></span>: beware of overlap and the <a href="#no-kidding-issue">“No kidding” issue</a></li>
</ul>
<p>In this context <em>one-to-many</em> is a copy (update) operation handled by <code>-u … -v …</code> or <code>-u … -x …</code> followed by <code>-d …</code>.</p>
<p><em>See also</em>: <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a> | <a href="#namespaces">Namespaces</a></p>
<div class="dinkus2">

</div>
<p>The following examples (<a href="#edit-moving-nodes-one-to-one"><em>one-to-one</em></a> | <a href="#edit-moving-nodes-many-to-one"><em>many-to-one</em></a> | <a href="#edit-moving-nodes-many-to-many"><em>many-to-many</em></a> | <a href="#edit-moving-nodes-position-n">move to position N</a>) use this input XML file:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a2"&gt;value 2&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p id="vol"/&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<h5 id="edit-moving-nodes-one-to-one" class="shew-tgt">ex1: one-to-one<a href="#edit-moving-nodes-one-to-one" class="permalink shew-hover"></a></h5>
<p>Moving one node to another:</p>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl \
  -m '/div/p[4]' '/div/p[3]' \
  -m '/div/p[3]/@id' '/div/p[2]' \
  -m '/div/a' '/div' \
"${infile:-file.xml}"</code></pre>
<p>Note the placement of <code>a</code> as the last element in destination.</p>
<p><em>See also</em>: <a href="#edit-opt-move"><code>-m (--move)</code></a></p>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a1"&gt;value 1&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="vol"&gt;
    &lt;span&gt;
      &lt;a id="a2"&gt;value 2&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;p/&gt;
  &lt;/p&gt;
  &lt;a&gt;anchor&lt;/a&gt;
&lt;/div&gt;</code></pre>
<h5 id="edit-moving-nodes-many-to-one" class="shew-tgt">ex2: many-to-one<a href="#edit-moving-nodes-many-to-one" class="permalink shew-hover"></a></h5>
<p>Moving the first 3 <code>p</code> elements to the 4th <code>p</code>:</p>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl \
  -m '/div/p[position() &lt;= 3]' '/div/p[4]' \
"${infile:-file.xml}"</code></pre>
<p>Destination can also be expressed as <code>(//p)[4]</code>, being the 4th <code>p</code> in document order.</p>
<p><em>See also</em>: <a href="#edit-opt-move"><code>-m (--move)</code></a></p>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;
    &lt;p&gt;
      &lt;span&gt;
        &lt;a id="a1"&gt;value 1&lt;/a&gt;
      &lt;/span&gt;
    &lt;/p&gt;
    &lt;p&gt;
      &lt;span&gt;
        &lt;a id="a2"&gt;value 2&lt;/a&gt;
      &lt;/span&gt;
    &lt;/p&gt;
    &lt;p id="vol"/&gt;
  &lt;/p&gt;
&lt;/div&gt;</code></pre>
<p>Whereas overlapping <code>-m '/div/p[position() &lt;= 3]' '/div/p[3]'</code> gives:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<h5 id="edit-moving-nodes-many-to-many" class="shew-tgt">ex3: many-to-many<a href="#edit-moving-nodes-many-to-many" class="permalink shew-hover"></a></h5>
<p>Move all <code>a</code> children of <code>span</code> elements up one level, then remove the emptied <code>span</code>s (untagging).</p>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl --pf \
  --var N '//span[a]' \
  -a '$N' -t elem -n 'a' \
  -u '$prev' -x 'preceding-sibling::span[1]/a/node() | preceding-sibling::span[1]/a/@*' \
  -d '$N' \
"${infile:-file.xml}"</code></pre>
<ul>
<li>the <code>N</code> <a href="#edit-opt-var">variable</a> contains the nodeset of all <code>span</code> elements which have an <code>a</code> element as an immediate child</li>
<li><a href="#edit-opt-append"><code>-a (--append)</code></a> creates a sibling <code>a</code> element for each <code>span</code> element in <code>$N</code></li>
<li><a href="#edit-opt-update-expr"><code>-u (--update)</code></a> inserts values in each newly created <code>a</code> element (<a href="#edit-prev"><code>$prev</code></a>) using a relative XPath expression (<code>-x</code>) to make a deep copy of <code>a</code>’s child and attribute nodes (<code>span</code> being the first <code>preceding-sibling</code> of the new <code>a</code> element)</li>
<li><a href="#edit-opt-delete"><code>-d (--delete) …</code></a> deletes each element in <code>$N</code>, after conversion</li>
</ul>
<p>In the general case use the <code>following-sibling</code> axis with the <code>-i (--insert)</code> action and the <code>preceding-sibling</code> axis with <code>-a (--append)</code>. In this specific case <code>preceding::span[1]</code> or <code>../span</code> also refers to <code>preceding-sibling::span[1]</code>.</p>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/p&gt;
  &lt;p&gt;&lt;a id="a2"&gt;value 2&lt;/a&gt;&lt;/p&gt;
  &lt;p id="vol"/&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<p>Alternatively, untag using an <em>identity transform</em> plus a template such as:</p>
<pre class="lang-xsl"><code>&lt;xsl:template match="span[a]"&gt;
  &lt;xsl:xsl:apply-templates/&gt;
&lt;/xsl:template&gt;</code></pre>
<h5 id="edit-moving-nodes-position-n" class="shew-tgt">ex4: move to position N<a href="#edit-moving-nodes-position-n" class="permalink shew-hover"></a></h5>
<p>Move the 3rd <code>p</code> element to position 2, to become the new 1st <code>p</code>.</p>
<p>The move destination cannot be a list position so work around:</p>
<ul>
<li>insert temporary element at position N</li>
<li>update it from source element</li>
<li>delete source element</li>
<li>rename temporary element</li>
</ul>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl \
  --var src '/div/p[3]' \
  --var tgt '/div/*[2]' \
  -i '$tgt' -t elem -n 'p_TMP' \
  -u '$prev' -x '$src/node() | $src/@*' \
  -d '$src' \
  -r '$prev' -v 'p' \
"${infile:-file.xml}"</code></pre>
<p>Both <code>-u '$prev' -x '…'</code> and <code>-m '…' '$prev'</code> work here.</p>
<p><em>See also</em>: <a href="#edit-opt-insert"><code>-i (--insert)</code></a> | <a href="#edit-opt-update-expr"><code>-u (--update)</code></a> | <a href="#edit-prev"><code>$prev</code></a> | <a href="#edit-opt-delete"><code>-d (--delete)</code></a> | <a href="#edit-opt-rename"><code>-r (--rename)</code></a> | <a href="#edit-opt-move"><code>-m (--move)</code></a></p>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p id="vol"/&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a1"&gt;value 1&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a2"&gt;value 2&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<h4 id="divide-a-document-into-sections" class="shew-tgt">Divide a document into sections<a href="#divide-a-document-into-sections" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>This example – a <em>many-to-many</em> move operation – uses <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a> with relative expressions and the EXSLT <a href="https://exslt.github.io/set/functions/leading/index.html"><code>set:leading</code></a> function to group by <code>h2</code> and move elements into <code>div</code>s.</p>
<p><em>See also</em>: <a href="#edit-moving-nodes">Moving nodes</a> | <a href="#edit-opt-insert"><code>-i (--insert)</code></a> | <a href="#edit-prev"><code>$prev</code></a> | <a href="#edit-opt-update-expr"><code>-u … -x …</code></a> | <a href="#edit-opt-delete"><code>-d (--delete)</code></a> | <a href="#edit-exslt-in-xpath-arguments">EXSLT in <code>xpath</code> arguments</a></p>
<pre class="lang-xml"><code>&lt;doc&gt;
&lt;h1/&gt;
&lt;h2/&gt;&lt;p1/&gt;&lt;p2/&gt;
&lt;h2/&gt;&lt;p3/&gt;&lt;p4/&gt;&lt;p5/&gt;
&lt;h2/&gt;&lt;p id="p6"&gt;&lt;v/&gt;&lt;/p&gt;&lt;p/&gt;
&lt;/doc&gt;</code></pre>
<pre class="lang-xml"><code>xmlstarlet edit -O \
  -i 'doc/h2' -t elem -n div \
  -u '$prev' -x 'set:leading(following-sibling::*, following-sibling::div[1])' \
  -d 'doc/div/following-sibling::*[not(self::div)]' \
"${infile:-file.xml}"</code></pre>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;doc&gt;
  &lt;h1/&gt;
  &lt;div&gt;
    &lt;h2/&gt;
    &lt;p1/&gt;
    &lt;p2/&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;h2/&gt;
    &lt;p3/&gt;
    &lt;p4/&gt;
    &lt;p5/&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;h2/&gt;
    &lt;p id="p6"&gt;
      &lt;v/&gt;
    &lt;/p&gt;
    &lt;p/&gt;
  &lt;/div&gt;
&lt;/doc&gt;</code></pre>
<p><em>See also</em>: <a href="#use-setleading-and-settrailing">Use <code>set:leading</code> and <code>set:trailing</code></a> example</p>
<h4 id="try-out-xmlstarlet-edits-formatting-options" class="shew-tgt">Try out <code>xmlstarlet edit</code>’s formatting options<a href="#try-out-xmlstarlet-edits-formatting-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#edit"></a><span class="relnop shew-hover"></span></div></h4>
<p>Test <code>edit</code>’s various formatting options on this input file:</p>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;  &lt;a 
             id="a2"
            &gt;  value 2  &lt;/a
    &gt;       &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"&gt;&lt;/p&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<p><em>See also</em>: <a href="#xml-parsing-and-serialization">XML parsing and serialization</a> | <a href="#duplicate-an-element-keep-the-formatting">Duplicate an element, keep the formatting</a> | <a href="#edit-opt-omit-decl"><code>-O (--omit-decl)</code></a> | <a href="#edit-opt-pf"><code>-P (--pf)</code></a> | <a href="#edit-opt-ps"><code>-S (--ps)</code></a></p>
<hr/>
<p>Default formatting:</p>
<pre class="lang-sh"><code>xmlstarlet edit -O "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a1"&gt;value 1&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a2"&gt;  value 2  &lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<p><em>See also</em>: <a href="#select-opt-indent"><code>select -I (--indent)</code></a></p>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>xmlstarlet edit -O --pf "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;  &lt;a id="a2"&gt;  value 2  &lt;/a&gt;       &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>xmlstarlet edit -O --ps "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;  &lt;a id="a2"&gt;  value 2  &lt;/a&gt;       &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<div class="dinkus3">

</div>
<p>This combination appears to match that of <code>xmllint --pretty 2 file.xml</code>. It could prove a temptation to a regex user (but <a href="https://stackoverflow.com/questions/590747/using-regular-expressions-to-parse-html-why-not#comment3178812_590747" title="`… only Chuck Norris can parse HTML with regex`">beware</a>). Swopping <code>--pf</code> and <code>--ps</code> makes no difference.</p>
<pre class="lang-sh"><code>xmlstarlet edit -O --pf --ps "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div
  &gt;
  &lt;a
    &gt;anchor&lt;/a
  &gt;
  &lt;p
    &gt;&lt;span
      &gt;&lt;a
          id="a1"
        &gt;value 1&lt;/a
      &gt;&lt;/span
    &gt;&lt;/p
  &gt;
  &lt;p
    &gt;
    &lt;span
      &gt;  &lt;a
          id="a2"
        &gt;  value 2  &lt;/a
      &gt;       &lt;/span
    &gt;
  &lt;/p
  &gt;
  &lt;p
      id="empty"
  /&gt;
  &lt;p
  /&gt;
&lt;/div
&gt;</code></pre>
<hr/>
<p>Add a subnode:</p>
<pre class="lang-sh"><code>xmlstarlet edit -O -s '*/p[4]' -t elem -n added "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a1"&gt;value 1&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a2"&gt;  value 2  &lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p&gt;
    &lt;added/&gt;
  &lt;/p&gt;
&lt;/div&gt;</code></pre>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>xmlstarlet edit -O --pf -s '*/p[4]' -t elem -n added "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;  &lt;a id="a2"&gt;  value 2  &lt;/a&gt;       &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p&gt;&lt;added/&gt;&lt;/p&gt;
&lt;/div&gt;</code></pre>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>xmlstarlet edit -O --ps -s '*/p[4]' -t elem -n added "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;  &lt;a id="a2"&gt;  value 2  &lt;/a&gt;       &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p&gt;&lt;added/&gt;&lt;/p&gt;
&lt;/div&gt;</code></pre>
<hr/>
<p>Delete whitespace-only text nodes:</p>
<pre class="lang-sh"><code>xmlstarlet edit -O --pf -d '//text()[normalize-space()=""]' "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;&lt;a&gt;anchor&lt;/a&gt;&lt;p&gt;&lt;span&gt;&lt;a id="a1"&gt;value 1&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;a id="a2"&gt;  value 2  &lt;/a&gt;&lt;/span&gt;&lt;/p&gt;&lt;p id="empty"/&gt;&lt;p/&gt;&lt;/div&gt;</code></pre>
<p><em>See also</em>: <a href="#select-opt-noblanks"><code>select -B (--noblanks)</code></a></p>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>xmlstarlet edit -O --ps -d '//text()[normalize-space()=""]' "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div&gt;
  &lt;a&gt;anchor&lt;/a&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a1"&gt;value 1&lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;span&gt;
      &lt;a id="a2"&gt;  value 2  &lt;/a&gt;
    &lt;/span&gt;
  &lt;/p&gt;
  &lt;p id="empty"/&gt;
  &lt;p/&gt;
&lt;/div&gt;</code></pre>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>xmlstarlet edit -O --pf --ps -d '//text()[normalize-space()=""]' "${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;div
  &gt;&lt;a
    &gt;anchor&lt;/a
  &gt;&lt;p
    &gt;&lt;span
      &gt;&lt;a
          id="a1"
        &gt;value 1&lt;/a
      &gt;&lt;/span
    &gt;&lt;/p
  &gt;&lt;p
    &gt;&lt;span
      &gt;&lt;a
          id="a2"
        &gt;  value 2  &lt;/a
      &gt;&lt;/span
    &gt;&lt;/p
  &gt;&lt;p
      id="empty"
  /&gt;&lt;p
  /&gt;&lt;/div
&gt;</code></pre>
<div class="dinkus1">

</div>
</section>
<section id="sec-format">
<h2 id="format" class="shew-tgt">Format: <code>xmlstarlet format</code><a href="#format" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#edit"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#c14n"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>The <code>format</code> (aka <code>fo</code>) command is an XML <a href="https://en.wikipedia.org/wiki/Prettyprint" title="Prettyprint on Wikipedia">code formatter</a> which accepts one input file, default is <code>stdin</code>.</p>
<p><em>See also</em>: <a href="#xml-parsing-and-serialization">XML parsing and serialization</a> | <a href="#select-opt-indent"><code>select -I (--indent)</code></a> | <a href="#try-out-xmlstarlet-edits-formatting-options">Try out <code>edit</code>’s formatting options</a></p>
<h4 id="format-usage" class="shew-tgt">Usage: <code>format</code> [option …] [«xml-file»]<a href="#format-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<h3 id="format-local-options" class="shew-tgt">Local options<a href="#format-local-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="format-opt-help" class="shew-tgt"><code>-h (--help)</code> - display help<a href="#format-opt-help" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="format-opt-encode" class="shew-tgt"><code>-e (--encode) «encoding»</code> - output in the given encoding<a href="#format-opt-encode" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p>Cf. <a href="#select-opt-encode"><code>select</code>’s <code>-E</code> option</a></p>
<h4 id="format-opt-noindent" class="shew-tgt"><code>-n (--noindent)</code> - do not indent<a href="#format-opt-noindent" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p>Sets indentation to zero spaces, left-aligning the output. Does not strip nonsignificant whitespace from input.</p>
<p><em>See also</em>: <a href="#select-opt-noblanks"><code>select -B (--noblanks)</code></a></p>
<h4 id="format-opt-omit-decl" class="shew-tgt"><code>-o (--omit-decl)</code> - omit XML declaration<a href="#format-opt-omit-decl" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p><span class="caution"><strong>Caution</strong></span>: Setting this option causes <code>xmlstarlet format</code> to return an <a href="#exit-values">exit value</a> equal to the number of bytes written (or -1 in case of error) modulo 256 (<a href="https://fossies.org/linux/xmlstarlet/src/xml_format.c#l_342" title="Fossies - the Fresh Open Source Software Archive">src/xml_format.c#foProcess()</a>, cf. <code>&lt;libxml/xmlIO.h&gt;</code>).</p>
<p><em>See also</em>: <a href="#xml-declaration">XML declaration</a></p>
<h4 id="format-opt-indent-spaces" class="shew-tgt"><code>-s (--indent-spaces) «N»</code> - indent output with N spaces<a href="#format-opt-indent-spaces" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p>Default indentation per level is 2 spaces.</p>
<h4 id="format-opt-indent-tab" class="shew-tgt"><code>-t (--indent-tab)</code> - indent output with tabulation<a href="#format-opt-indent-tab" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="format-opt-nocdata" class="shew-tgt"><code>-C (--nocdata)</code> - replace CDATA section with text nodes<a href="#format-opt-nocdata" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-shell"><code>$ infile=$(mktemp)
$ printf '&lt;v&gt;&lt;![CDATA[A\t%s\nZ]]&gt;&lt;/v&gt;' '"&amp;'\''&lt;&gt;' &gt; "${infile}"
$ :
$ xmlstarlet format -o -C "${infile}"
&lt;v&gt;A	"&amp;amp;'&amp;lt;&amp;gt;
Z&lt;/v&gt;
$ :
$ xmlstarlet format -o "${infile}"
&lt;v&gt;&lt;![CDATA[A	"&amp;'&lt;&gt;
Z]]&gt;&lt;/v&gt;
$ :
$ xmlstarlet pyx "${infile}"
(v
[A\t"&amp;'&lt;&gt;\nZ
)v</code></pre>
<p><em>See also</em>: <a href="#pyx"><code>pyx</code></a></p>
<h4 id="format-opt-dropdtd" class="shew-tgt"><code>-D (--dropdtd)</code> - remove the DOCTYPE of the input doc<a href="#format-opt-dropdtd" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p>Alternatives: <code>xmllint --dropdtd a.xml | …</code> or <code>xsltproc --novalid b.xsl a.xml</code>.</p>
<h4 id="format-opt-html" class="shew-tgt"><code>-H (--html)</code> - input is HTML<a href="#format-opt-html" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p>Reads input using the <a href="#selected-resources"><code>libxml2</code></a> HTML 4.0 parser, cf. <a href="https://gnome.pages.gitlab.gnome.org/libxml2/devhelp/libxml2-HTMLparser.html">API reference</a>.</p>
<p>Attempt to convert HTML – or broken XML – to usable XHTML:</p>
<pre class="lang-sh"><code>wget -qO- "${url}" |
xmlstarlet -q format --html --recover --dropdtd --omit-decl &gt; output</code></pre>
<p><em>See also</em>: global <a href="#global-opt-quiet"><code>-q (--quiet)</code></a> option</p>
<p><em>Links</em>: <a href="https://www.html-tidy.org/" title="HTML/XML syntax checker and reformatter">HTML Tidy</a> | <a href="https://www.w3.org/Tools/HTML-XML-utils/README" title="A number of simple utilities for manipulating HTML and XML files">W3C’s html-xml-utils</a> | <a href="#selected-resources"><code>xmllint</code></a></p>
<h4 id="format-opt-nsclean" class="shew-tgt"><code>-N (--nsclean)</code> - remove redundant namespace declarations<a href="#format-opt-nsclean" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#namespaces-remove-redundant">Remove namespace declarations</a></p>
<h4 id="format-opt-quiet" class="shew-tgt"><code>-Q (--quiet)</code> [undocumented] - suppress error output<a href="#format-opt-quiet" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p>Does what the <a href="#global-opt-quiet"><code>-q (--quiet)</code></a> global option does.</p>
<h4 id="format-opt-recover" class="shew-tgt"><code>-R (--recover)</code> - try to recover what is parsable<a href="#format-opt-recover" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#format-opt-html"><code>-H (--html)</code></a></p>
<h4 id="format-opt-net" class="shew-tgt"><code>--net</code> - allow network access<a href="#format-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#format"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#global-opt-net">network access</a></p>
<div class="dinkus1">

</div>
</section>
<section id="sec-canonic">
<h2 id="c14n" class="shew-tgt">Compare: <code>xmlstarlet c14n</code><a href="#c14n" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#format"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#validate"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>The <code>c14n</code> (aka <code>canonic</code>) command is used to convert an XML document to <em>Canonical XML</em>, a normal format intended to allow relatively simple comparison of pairs of XML documents for equivalence.</p>
<p>The W3C recommendations list examples of XML canonicalization. Examples of the <code>c14n</code> command are given in the source code’s <a href="https://fossies.org/linux/www/xmlstarlet-1.6.1.tar.gz/" title="Fossies - the Fresh Open Source Software Archive">examples/c14n*</a>.</p>
<p><em>Links</em>: <a href="https://en.wikipedia.org/wiki/Canonical_XML">Canonical XML</a> - Wikipedia | <a href="https://www.w3.org/TR/xml-c14n">Canonical XML</a> - W3C rec | <a href="https://www.w3.org/TR/xml-exc-c14n/">Exclusive XML Canonicalization</a> - W3C rec</p>
<p><span class="caution"><strong>Caution</strong></span> <code>xmlstarlet c14n</code> does not flag invalid options, cf.  <a href="https://fossies.org/linux/xmlstarlet/src/xml_C14N.c#l_117" title="Fossies - the Fresh Open Source Software Archive">src/xml_C14N.c#c14nMain()</a>.</p>
<h4 id="c14n-usage" class="shew-tgt">Usage: <code>c14n [option] [«mode»] «xml-file» [«xpath-file»] [«inclusive-ns-list»]</code><a href="#c14n-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<h3 id="c14n-local-options" class="shew-tgt">Local options<a href="#c14n-local-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#c14n"></a><a class="relnext shew-hover" href="#c14n-parameters"></a><span class="relnop shew-hover"></span></div></h3>
<h4 id="c14n-opt-help" class="shew-tgt"><code>-h (--help)</code> - display help<a href="#c14n-opt-help" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="c14n-opt-net" class="shew-tgt"><code>--net</code> - allow network access<a href="#c14n-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#global-opt-net">network access</a></p>
<h3 id="c14n-parameters" class="shew-tgt">Parameters<a href="#c14n-parameters" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#c14n-local-options"></a><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="c14n-param-mode" class="shew-tgt"><code>«mode»</code> - canonicalization mode<a href="#c14n-param-mode" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>«mode»</code> is one of the following:</p>
<ul>
<li><code>--with-comments</code> - canonicalization with comments (this is the default mode)</li>
<li><code>--without-comments</code> - canonicalization without comments</li>
<li><code>--exc-with-comments</code> - exclusive canonicalization with comments</li>
<li><code>--exc-without-comments</code> - exclusive canonicalization without comments</li>
</ul>
<h4 id="c14n-param-xml-file" class="shew-tgt"><code>«xml-file»</code> - input XML document file name (stdin is used if <code>-</code>)<a href="#c14n-param-xml-file" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<p>Basic use case:</p>
<pre class="lang-sh"><code>xml-generator-command | xmlstarlet c14n |
{ xmlstarlet c14n expected.xml | diff -b -C 1 - /dev/fd/3; } 3&lt;&amp;0 || log …</code></pre>
<h4 id="c14n-xpath-file" class="shew-tgt"><code>«xpath-file»</code> - XML file with <em>document subset</em> expression<a href="#c14n-xpath-file" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<p>Cf. <em>document subset</em> in the W3C recommendation.</p>
<p>Sample xpath-file, from <a href="https://fossies.org/linux/xmlstarlet/examples/xml/c14n.xpath" title="Fossies - the Fresh Open Source Software Archive">examples/xml/c14n.xpath</a>:</p>
<pre class="lang-xml"><code>&lt;?xml version="1.0"?&gt;
&lt;XPath xmlns:n0="http://a.example.com" xmlns:n1="http://b.example"&gt;
(//. | //@* | //namespace::*)[ancestor-or-self::n1:elem1]
&lt;/XPath&gt;</code></pre>
<h4 id="c14n-param-inclusive-ns-list" class="shew-tgt">«inclusive-ns-list» - list of inclusive namespace prefixes<a href="#c14n-param-inclusive-ns-list" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#c14n"></a><span class="relnop shew-hover"></span></div></h4>
<p>The <em>InclusiveNamespaces PrefixList</em> as a comma-separated (<span class="caution"><strong>Caution</strong></span>: the <a href="https://xmlstar.sourceforge.net/doc/UG/ch04s06.html">user’s guide</a> says blank-separated) list of namespace prefixes; for exclusive canonicalization only.</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-validate">
<h2 id="validate" class="shew-tgt">Validate: <code>xmlstarlet validate</code><a href="#validate" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#c14n"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#pyx"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>The <code>validate</code> (aka <code>val</code>) command performs validation on XML documents. Examples of the <code>val</code> command are given in the source code’s <a href="https://fossies.org/linux/xmlstarlet/examples/valid1" title="Fossies - the Fresh Open Source Software Archive">examples/valid1</a>. <strong>NB</strong>: XML Schemas (XSD) are not fully supported due to incomplete support in <a href="#selected-resources"><code>libxml2</code></a>.</p>
<p><em>Wikipedia links</em>: <a href="https://en.wikipedia.org/wiki/XML_schema">XML schemas</a> in general | <a href="https://en.wikipedia.org/wiki/XML_Schema_(W3C)" title="XSD (XML Schema Definition)">XSD (W3C)</a> | <a href="https://en.wikipedia.org/wiki/RELAX_NG" title="REgular LAnguage for XML Next Generation">RELAX NG</a> | <a href="https://en.wikipedia.org/wiki/Document_Type_Definition" title="Document Type Definition">DTD</a></p>
<p><em>See also</em>: <a href="#xml-parsing-and-serialization">XML parsing and serialization</a> | <a href="#xml-external-entities">External entities</a></p>
<h4 id="validate-usage" class="shew-tgt">Usage: <code>validate</code> [option …] [«xml-file-or-uri» …]<a href="#validate-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h3 id="validate-local-options" class="shew-tgt">Local options<a href="#validate-local-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="validate-opt-well-formed" class="shew-tgt"><code>-w (--well-formed)</code> - validate well-formedness only (<em>default</em>)<a href="#validate-opt-well-formed" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-dtd" class="shew-tgt"><code>-d (--dtd) «dtd-file»</code> - validate against DTD<a href="#validate-opt-dtd" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-net" class="shew-tgt"><code>--net</code> - allow network access<a href="#validate-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#global-opt-net">network access</a></p>
<h4 id="validate-opt-xsd" class="shew-tgt"><code>-s (--xsd) «xsd-file»</code> - validate against XSD schema<a href="#validate-opt-xsd" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-embed" class="shew-tgt"><code>-E (--embed)</code> - validate using embedded DTD<a href="#validate-opt-embed" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-relaxng" class="shew-tgt"><code>-r (--relaxng) «rng-file»</code> - validate against Relax-NG schema<a href="#validate-opt-relaxng" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-err" class="shew-tgt"><code>-e (--err)</code> - print verbose error messages on stderr<a href="#validate-opt-err" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-stop" class="shew-tgt"><code>-S (--stop)</code> - stop on first error<a href="#validate-opt-stop" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-list-bad" class="shew-tgt"><code>-b (--list-bad)</code> - list only files which do not validate<a href="#validate-opt-list-bad" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-list-good" class="shew-tgt"><code>-g (--list-good)</code> - list only files which validate<a href="#validate-opt-list-good" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="validate-opt-quiet" class="shew-tgt"><code>-q (--quiet)</code> - do not list files (return result code only)<a href="#validate-opt-quiet" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#validate"></a><span class="relnop shew-hover"></span></div></h4>
<div class="dinkus1">

</div>
</section>
<section id="sec-pyx">
<h2 id="pyx" class="shew-tgt">PYX: <code>xmlstarlet pyx</code>, <code>depyx</code><a href="#pyx" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#validate"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#escape"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p><code>xmlstarlet</code>’s <code>pyx</code> (aka <code>xmln</code>) and <code>depyx</code> (aka <code>p2x</code>) commands are used to convert XML to PYX during processing. PYX is a simple line-oriented text-based format usable with standard text tools such as <code>grep</code>, <code>sed</code>, or <code>awk</code>. Given <code>xmlstarlet</code>’s lack of native support for <em>regular expressions</em> this type of processing is occasionally useful, but <strong>beware of side effects</strong>: a <code>pyx | depyx</code> pipeline <em>does not guarantee</em> an accurate roundtrip. <code>pyx</code> uses a <a href="https://en.wikipedia.org/wiki/Simple_API_for_XML" title="'Simple API for XML' on Wikipedia">SAX</a> parser.</p>
<p>PYX’s simplicity and lack of structure (and namespaces) makes it a good choice for certain types of operations – e.g. queries or editing of non-complex data like config files or database record sets – and a poor choice for handling complex documents or operations.</p>
<p>The PYX format lives a quiet life these days; <code>xml.com</code> still carries its article on <a href="https://www.xml.com/pub/2000/03/15/feature/index.html">Pyxie</a> whereas IBM’s intro is now at <a href="https://web.archive.org/web/20201031133517/https://www.ibm.com/developerworks/xml/library/x-matters17/index.html/">archive.org</a>.</p>
<p>The first character of each line of PYX indicates the type of parsing event:</p>
<pre><code>char  event
----  -----
 (    start-tag
 )    end-tag
 A    attribute or namespace
 -    character data
 ?    processing instruction
 C    comment
 [    CDATA section
 D    DTD declaration
 N    notation declaration
 U    unparsed entity
 &amp;    external entity</code></pre>
<p><span class="caution"><strong>Caution</strong></span>: <code>pyx</code> strips an XML declaration if present.<br/>
<span class="caution"><strong>Caution</strong></span>: <code>&amp;</code> (ampersand) is buggy, e.g. <a href="#xml-external-entities">external entities</a>, cf.  <a href="https://fossies.org/linux/xmlstarlet/src/xml_pyx.c" title="Fossies - the Fresh Open Source Software Archive">src/xml_pyx.c</a>.<br/>
<span class="caution"><strong>Caution</strong></span>: <code>depyx</code> outputs non-collapsed empty elements, e.g.  <code>&lt;void&gt;&lt;/void&gt;</code>.<br/>
<span class="caution"><strong>Caution</strong></span>: <code>depyx</code> outputs XML <a href="#special-characters">special characters</a> inside comments as entity references, e.g. <code>&amp;</code> as <code>&amp;amp;</code>.<br/>
<span class="caution"><strong>Caution</strong></span>: <code>depyx</code> may output spurious newlines, for example after a comment, cf.  <a href="https://fossies.org/linux/xmlstarlet/src/xml_depyx.c#l_176" title="Fossies - the Fresh Open Source Software Archive">src/xml_depyx.c</a>.</p>
<p><em>Links</em>: <code>packages.debian.org</code> <a href="https://packages.debian.org/bullseye/xml2" title="Convert between XML, HTML, CSV and a line-oriented format">xml2</a></p>
<h4 id="pyx-usage" class="shew-tgt">Usage: <code>pyx</code> [–help] [«xml-file»]<a href="#pyx-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="depyx-usage" class="shew-tgt">Usage: <code>depyx</code> [–help] [«pyx-file»]<a href="#depyx-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="pyx-output-sample" class="shew-tgt">PYX output sample<a href="#pyx-output-sample" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet pyx "${infile:-pom.xml}" | head -n 40</code></pre>
<p>Output:</p>
<pre class="lang-none"><code>(project
Axmlns http://maven.apache.org/POM/4.0.0
Axmlns:xsi http://www.w3.org/2001/XMLSchema-instance
Axsi:schemaLocation http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd
-\n  
(modelVersion
-4.0.0
)modelVersion
-\n\n  
(groupId
-com.github.example8
)groupId
-\n  
(artifactId
-maven-simple
)artifactId
-\n  
(version
-0.2-SNAPSHOT
)version
-\n  
(packaging
-jar
)packaging
-\n\n  
(name
-Simple Maven example
)name
-\n  
(url
-https://example8.io/#example8/maven-simple/0.1
)url
-\n\n  
(dependencies
-\n    
(dependency
-\n      
(groupId
-junit
)groupId</code></pre>
<h3 id="pyx-examples" class="shew-tgt">Examples<a href="#pyx-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="grep-for-dvorak-in-tags-text" class="shew-tgt">Grep for <code>Dvorak</code> in tags’ text<a href="#grep-for-dvorak-in-tags-text" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet pyx '/usr/share/X11/xkb/rules/base.xml' | grep '^-.*Dvorak'</code></pre>
<h4 id="extract-uris" class="shew-tgt">Extract URIs<a href="#extract-uris" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet pyx index.xhtml | sed -n 's/^Ahref //p'</code></pre>
<h4 id="convert-date-attributes-to-extended-iso-8601-format" class="shew-tgt">Convert <code>date</code> attributes to extended ISO 8601 format<a href="#convert-date-attributes-to-extended-iso-8601-format" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<p>Using <a href="https://www.gnu.org/software/sed/">GNU sed</a> (for <code>e</code> flag of <code>s</code> command) and <a href="https://www.gnu.org/software/coreutils/date">GNU date</a> (for <code>-d (--date)</code> option and <code>%F</code> format):</p>
<pre class="lang-sh"><code>xmlstarlet pyx "${infile:-file.xml}" |
sed -E '1v;/^(Adate )(.*)/ s//date -d "\2" "+\1%F"/e' |
xmlstarlet depyx</code></pre>
<p>The do-nothing <code>v</code> command fails on non-GNU <code>sed</code>s. The empty regex causes the last applied regex to be reused.</p>
<h4 id="convert-datetime-elements-from-basic-to-extended-iso-8601-format" class="shew-tgt">Convert <code>datetime</code> elements from basic to extended ISO 8601 format<a href="#convert-datetime-elements-from-basic-to-extended-iso-8601-format" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet pyx "${infile:-file.xml}" |
sed '/^(datetime$/,/^)datetime$/ { /^-\(....\)\(..\)\(..\)\(..\)\(..\)\(..\)/ s//-\1-\2-\3T\4:\5:\6/; }' |
xmlstarlet depyx</code></pre>
<p>Assuming non-nested <code>datetime</code> elements. The <code>/^-…/</code> condition leaves non-text nodes (incl. CDATA sections) unmodified.</p>
<h4 id="delete-foo-elements" class="shew-tgt">Delete <code>foo</code> elements<a href="#delete-foo-elements" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet pyx "${infile:-file.xml}" |
awk -v FS='\n' '
$0=="(foo" {flag++; next;}
$0==")foo" {flag--; next;}
!flag
' | 
xmlstarlet depyx</code></pre>
<p><code>!flag</code> prints current line if <code>flag</code> is zero.</p>
<h4 id="split-xml-file-by-parentelement" class="shew-tgt">Split XML file by <code>parent/element</code><a href="#split-xml-file-by-parentelement" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#pyx"></a><span class="relnop shew-hover"></span></div></h4>
<p>This <code>awk</code> script reads a <code>PYX</code>-format file and extracts each <code>group</code> element having a parent <code>glist</code> element (including any nested ditto) to a separate numbered file, converting each chunk from <code>PYX</code> to XML by invoking <code>xmlstarlet depyx</code>. Alternatively, output <code>PYX</code>-format files and convert them in parallel.</p>
<p><span class="caution"><strong>Caution</strong></span>: Doesn’t understand namespaces, and beware of <code>pyx/depyx</code> <a href="#pyx">side effects</a>.</p>
<pre class="lang-sh"><code>xmlstarlet pyx "${infile:-file.xml}" |
awk -v FS='\n' -v partfmt='./part%04d.xml' -v element='group' -v parent='glist' '
  /^\(/ { E[++level] = substr($0,2) }
  $0 ~ "[()]" element "$"  &amp;&amp;  E[level-1] == parent {
    if ( !flag &amp;&amp; "(" == substr($0,1,1) ) {
      fxml = sprintf(partfmt,++partnum)
      fpyx = fxml ".pyx.tmp"
      flag=1
    } else if ( flag ) {
      print &gt;&gt; fpyx
      close(fpyx)
      system("xmlstarlet depyx " fpyx " &gt; " fxml " &amp;&amp; rm " fpyx)
      flag=0
    }
  }
  /^\)/ { --level }
  flag { print &gt;&gt; fpyx }
'</code></pre>
<p><em>See also</em>: <a href="#create-multiple-result-documents">Create multiple result documents</a> example</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-escape">
<h2 id="escape" class="shew-tgt">Special characters: <code>xmlstarlet escape</code>, <code>unescape</code><a href="#escape" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#pyx"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#list"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>The <code>escape</code> (aka <code>esc</code>) command converts</p>
<ul>
<li>the XML <a href="#special-characters">special characters</a> <code>&amp;&lt;&gt;</code> to the equivalent <code>&amp;amp;</code> <code>&amp;lt;</code> <code>&amp;gt;</code> entity references</li>
<li>Unicode characters above U+007E to numeric character entity references</li>
</ul>
<p>taking its input from the first text string on the command line, or <code>stdin</code> if it’s <code>-</code> (dash) or absent.</p>
<p>The <code>unescape</code> (aka <code>unesc</code>) command does the inverse. <span class="caution"><strong>Caution</strong></span>: <code>unesc</code> leaves longer references such as <code>&amp;#x20AC;</code> unmodified (cf. <code>MAX_ENTITY_NAME = 1+4</code> in <a href="https://fossies.org/linux/xmlstarlet/src/xml_escape.c#l_63" title="Fossies - the Fresh Open Source Software Archive">src/xml_escape.c</a>), prints a diagnostic message, and returns zero.</p>
<p><em>See also</em>: <a href="#special-characters">Special characters</a> | <a href="#transform-opt-xinclude"><code>--xinclude</code></a> (for <code>parse="text"</code>)</p>
<h4 id="escape-usage" class="shew-tgt">Usage: <code>escape</code> [–help] [«text»]<a href="#escape-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#escape"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="unescape-usage" class="shew-tgt">Usage: <code>unescape</code> [–help] [«text»]<a href="#unescape-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#escape"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="escape-sample-session" class="shew-tgt">Sample session<a href="#escape-sample-session" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#escape"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-shell"><code>$ xmlstarlet escape 'a&amp;&lt;&gt;'\''"z'
a&amp;amp;&amp;lt;&amp;gt;'"z
$ :
$ xmlstarlet unescape 'a&amp;amp;&amp;lt;&amp;gt;&amp;apos;&amp;quot;z'; printf '\n'
a&amp;&lt;&gt;'"z
$ :
$ # Unicode U+20AC EURO SIGN
$ xmlstarlet esc '€'
&amp;#x20AC;
$ :
$ xmlstarlet unesc '&amp;#x61;&amp;#x20AC;&amp;#x9;100&amp;#x7A;&amp;#xA;'
entity name too long: &amp;#x20AC
a&amp;#x20AC;	100z
$ :
$ xmlstarlet esc &lt; "${infile:-file.xml}"
&amp;lt;foo&amp;gt;if they treat children as they do &amp;lt;bar&amp;gt;documentation&amp;lt;/bar&amp;gt; they'll be &amp;lt;bat&amp;gt;prosecuted&amp;lt;/bat&amp;gt;&amp;lt;/foo&amp;gt;
$ :
$ xmlstarlet esc &lt; "${infile:-file.xml}" | xmlstarlet unesc
&lt;foo&gt;if they treat children as they do &lt;bar&gt;documentation&lt;/bar&gt; they'll be &lt;bat&gt;prosecuted&lt;/bat&gt;&lt;/foo&gt;</code></pre>
<div class="dinkus1">

</div>
</section>
<section id="sec-list">
<h2 id="list" class="shew-tgt">Directory list: <code>xmlstarlet list</code><a href="#list" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#escape"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#transform"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>The <code>list</code> (aka <code>ls</code>) command prints the contents of a file system directory in XML format. It accepts a directory name as its only argument; default is current dir. No recursion option and no <code>-h (--help)</code> option available.</p>
<h4 id="list-usage" class="shew-tgt">Usage: <code>list</code> [«directory-name»]<a href="#list-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#list"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="list-output-sample" class="shew-tgt">Output sample<a href="#list-output-sample" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#list"></a><span class="relnop shew-hover"></span></div></h4>
<pre class="lang-sh"><code>xmlstarlet list /etc/sgml</code></pre>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;dir&gt;
&lt;f p="rw-r--r--" a="20220704T194637Z" m="20211001T213455Z" s="376"              n="docbook-xml.cat"/&gt;
&lt;d p="rwxr-xr-x" a="20220706T075545Z" m="20220419T100344Z" s="4096"             n="docbook-xml"/&gt;
&lt;l p="rwxrwxrwx" a="20220706T075532Z" m="20220702T102624Z" s="31"               n="catalog"/&gt;
&lt;f p="rw-r--r--" a="20220704T194637Z" m="20201229T232017Z" s="652"              n="sgml-data.cat"/&gt;
&lt;f p="rw-r--r--" a="20220704T194637Z" m="20190227T001849Z" s="45"               n="xml-core.cat"/&gt;
&lt;/dir&gt;</code></pre>
<p>Elements inside the <code>dir</code> document element have a one-char name indicating the file type,</p>
<pre class="lang-none"><code>f   regular file
d   directory
c   character device
b   block device
l   symlink
p   FIFO
s   socket
u   unknown</code></pre>
<p>and attributes as returned by <code>stat</code>:</p>
<pre class="lang-none"><code>p   read-write-execute permissions for user, group, and other
a   UTC time of last access in ISO 8601 basic format
m   UTC time of last modification in ISO 8601 basic format
s   file size in bytes
n   filename</code></pre>
<p>See <code>man 7 inode</code> for permissions <code>s</code> (S_ISUID, S_ISGID) and <code>t</code> (S_ISVTX).</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-transform">
<h2 id="transform" class="shew-tgt">The T in XSLT: <code>xmlstarlet transform</code><a href="#transform" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#list"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#namespaces"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>The <code>transform</code> (aka <code>tr</code>) command is an <a href="https://en.wikipedia.org/wiki/XSLT#Processor_implementations" title="'XSLT processor implementations' on Wikipedia">XSLT processor</a> supporting XSLT 1.0 plus several EXSLT, <code>crypto</code>, and <code>saxon</code> <a href="#exslt">extensions</a>.</p>
<p><code>xmlstarlet transform</code> returns the same <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-system-property" title="W3C XSLT 1.0 recommendation"><code>system-property()</code></a> values as <code>xmlstarlet select</code> and <code>xsltproc</code>:</p>
<pre class="lang-none"><code>xsl:vendor      libxslt
xsl:vendor-url  http://xmlsoft.org/XSLT/
xsl:version     1.0</code></pre>
<p><span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet transform</code> doesn’t flag invalid options (<a href="https://fossies.org/linux/xmlstarlet/src/xml_trans.c#l_66" title="Fossies - the Fresh Open Source Software Archive">src/xml_trans.c#trParseOptions()</a>).</p>
<p><span class="caution"><strong>Caution</strong></span>: The <code>--catalogs</code> option mentioned in the <a href="https://xmlstar.sourceforge.net/doc/UG/ch04s02.html">user’s guide</a> was never implemented, it seems; not listed by <code>xmlstarlet transform --help</code>.</p>
<h4 id="transform-usage" class="shew-tgt">Usage: <code>transform [option …] «xsl-file» [-p|-s «name»=«value» …] [«xml-file-or-uri» …]</code><a href="#transform-usage" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<h3 id="transform-local-options" class="shew-tgt">Local options<a href="#transform-local-options" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#transform"></a><a class="relnext shew-hover" href="#transform-parameters"></a><span class="relnop shew-hover"></span></div></h3>
<h4 id="transform-opt-help" class="shew-tgt"><code>-h (--help)</code> - display help<a href="#transform-opt-help" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="transform-opt-omit-decl" class="shew-tgt"><code>--omit-decl</code> - omit XML declaration<a href="#transform-opt-omit-decl" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#xml-declaration">XML declaration</a></p>
<h4 id="transform-opt-embed" class="shew-tgt"><code>-E (--embed)</code> - allow applying embedded stylesheet<a href="#transform-opt-embed" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: <a href="https://www.w3.org/TR/xml-stylesheet" title="Associating Style Sheets with XML documents 1.0"><code>&lt;?xml-stylesheet?&gt;</code></a> - W3C recommendation | <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#section-Embedding-Stylesheets" title="W3C XSLT 1.0 recommendation">Embedding stylesheets</a> - W3C XSLT 1.0 Rec</p>
<p>With an <code>e.xml</code> XML document containing an <code>&lt;?xml-stylesheet type="text/xml" href="e.xsl"?&gt;</code> <em>processing instruction</em> before the document element, the following command will run the XSLT stylesheet <code>e.xsl</code> on <code>e.xml</code>.</p>
<pre class="lang-sh"><code>xmlstarlet tr -E e.xml &gt; output</code></pre>
<p>This option is mentioned in <a href="https://fossies.org/linux/xmlstarlet/doc/xmlstarlet.txt">doc/xmlstarlet.txt</a> but not in the user’s guide.</p>
<h4 id="transform-opt-show-ext" class="shew-tgt"><code>--show-ext</code> - show list of extensions<a href="#transform-opt-show-ext" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p>Prints a <a href="#appendix-a-xmlstarlet-xslt-extensions">list</a> of registered XSLT extensions to <code>stderr</code> and terminates.</p>
<h4 id="transform-opt-val" class="shew-tgt"><code>--val</code> - allow validate against DTDs or schemas<a href="#transform-opt-val" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="transform-opt-net" class="shew-tgt"><code>--net</code> - allow fetch DTDs or entities over network<a href="#transform-opt-net" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>See also</em>: <a href="#global-opt-net">network access</a></p>
<h4 id="transform-opt-xinclude" class="shew-tgt"><code>--xinclude</code> - do XInclude processing on document input<a href="#transform-opt-xinclude" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: XML Inclusions <a href="https://www.w3.org/TR/xinclude/">XInclude</a> - W3C recommendation</p>
<p><em>See also</em>: the XSLT <a href="#use-the-document-function"><code>document()</code></a> function</p>
<div class="dinkus3">

</div>
<p>Basic XInclude example: include <code>file2.xml</code> in <code>file1.xml</code>.</p>
<pre class="lang-sh"><code>cat &lt;&lt; 'HERE' &gt; 'file1.xml'
&lt;root&gt;
  &lt;gs&gt;
    &lt;xi:include
      xmlns:xi="http://www.w3.org/2001/XInclude" 
      href="file2.xml"
      xpointer="xpointer(//g[@id='items']/*)"
      parse="xml"
    /&gt;
  &lt;/gs&gt;
&lt;/root&gt;
HERE

cat &lt;&lt; 'HERE' &gt; 'file2.xml'
&lt;doc&gt;&lt;g id="items"&gt;&lt;g1/&gt;&lt;g2/&gt;&lt;g3/&gt;&lt;g4/&gt;&lt;/g&gt;&lt;/doc&gt;
HERE

xmlstarlet select -C -t -c / |
xmlstarlet transform --xinclude /dev/stdin 'file1.xml'</code></pre>
<ul>
<li><code>xmlstarlet transform --xinclude</code> does the XInclude processing using an XSLT stylesheet (generated on the fly by <code>xmlstarlet select</code>) which duplicates its input by copying the root node (<code>/</code>)</li>
<li><code>xi:include</code> elements may appear in both the including and the included file(s)
<ul>
<li><code>parse="xml"</code> is the default and may be omitted, the only other option is <code>parse="text"</code> (sample output below)</li>
<li>if present the <code>href</code> attribute must refer to an XML document</li>
<li>if the <code>href</code> attribute is absent (or empty) when <code>parse="xml"</code> it refers to the including document in which case the <code>xpointer</code> attribute must be present</li>
<li>if no <code>xpointer</code> attribute is given, or its value set to <code>xpointer(/)</code>, the entire inclusion target will be included</li>
<li>the XPointer expression specifies the XPath of the nodes to include, it’s possible to use complex expressions here such as <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#NT-UnionExpr" title="W3C XPath 1.0 recommendation">unions</a></li>
</ul></li>
<li><code>xml:base</code> attributes will appear in output (cf. <a href="https://www.w3.org/TR/xmlbase/" title="W3C recommendation">XML Base</a> - W3C rec) unless the inclusion source and target(s) use a shared include location (hint: use absolute pathnames)</li>
<li>the <code>xmlns:xi</code> namespace node will appear in output if given outside the <code>xi:include</code> element (and may prove rather <a href="#namespaces-remove-redundant">sticky</a>)</li>
</ul>
<p>Output:</p>
<pre class="lang-xml"><code>&lt;root&gt;
  &lt;gs&gt;
    &lt;g1/&gt;&lt;g2/&gt;&lt;g3/&gt;&lt;g4/&gt;
  &lt;/gs&gt;
&lt;/root&gt;</code></pre>
<p>If instead <code>parse="text"</code>:</p>
<pre class="lang-xml"><code>&lt;root&gt;
  &lt;gs&gt;
    &amp;lt;doc&amp;gt;&amp;lt;g id="items"&amp;gt;&amp;lt;g1/&amp;gt;&amp;lt;g2/&amp;gt;&amp;lt;g3/&amp;gt;&amp;lt;g4/&amp;gt;&amp;lt;/g&amp;gt;&amp;lt;/doc&amp;gt;

  &lt;/gs&gt;
&lt;/root&gt;</code></pre>
<div class="dinkus3">

</div>
<p>An alternative to XInclude or <code>document()</code>:</p>
<p>The <a href="https://www.w3.org/Tools/HTML-XML-utils/man1/hxincl.html" title="hxincl - expand included HTML or XML files"><code>hxincl</code></a> utility from the W3C <a href="#selected-resources"><code>html-xml-utils</code></a> package is HTML/XML-aware and expands certain embedded comments – or prints a <code>makefile</code> rule listing the dependent include files – e.g. <code>hxincl -x -s incfnm=file2.xml file1.xml</code>.</p>
<h4 id="transform-opt-maxdepth" class="shew-tgt"><code>--maxdepth value</code> - increase the maximum depth<a href="#transform-opt-maxdepth" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p>Used to detect template loops, cf. variable <code>xsltMaxDepth</code> in <code>xslt.h</code>.</p>
<h4 id="transform-opt-html" class="shew-tgt"><code>--html</code> - input document(s) are in HTML format<a href="#transform-opt-html" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p>Reads input using the <a href="#selected-resources"><code>libxml2</code></a> HTML 4.0 parser, cf. <a href="#xml-parsing-and-serialization">XML parsing and serialization</a>.</p>
<h3 id="transform-parameters" class="shew-tgt">Parameters<a href="#transform-parameters" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#transform-local-options"></a><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="transform-param-xsl-file" class="shew-tgt"><code>«xsl-file»</code> - main XSLT stylesheet for transformation<a href="#transform-param-xsl-file" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p>Cf. option <a href="#transform-opt-embed"><code>-E (--embed)</code></a>.</p>
<h4 id="transform-param-p" class="shew-tgt"><code>-p</code> - parameter is an XPath expression<a href="#transform-param-p" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<h4 id="transform-param-s" class="shew-tgt"><code>-s</code> - parameter is a string literal<a href="#transform-param-s" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>-p</code> and <code>-s</code> are repeatable, up to a maximum of 256 key-value pairs.</p>
<h4 id="transform-param-name-equals-value" class="shew-tgt"><code>«name»=«value»</code> - name and value of the parameter passed to XSLT processor<a href="#transform-param-name-equals-value" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p>E.g. <code>… -p m1='"Hello, XSLT"' -s m2='0xab 0xbb' file.xml</code></p>
<h4 id="transform-param-xml-file" class="shew-tgt"><code>«xml-file»</code> - input XML document file name (<code>stdin</code> is used if missing)<a href="#transform-param-xml-file" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#transform"></a><span class="relnop shew-hover"></span></div></h4>
<p>This parameter is repeatable.</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-namespaces">
<h2 id="namespaces" class="shew-tgt">Namespaces<a href="#namespaces" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#transform"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#error-messages"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p><em>Links</em>: <a href="https://lenzconsulting.com/namespaces/">Understanding XML namespaces</a> - Evan Lenz | <a href="https://www.w3.org/TR/xml-names/">Namespaces in XML 1.0</a> / <a href="https://www.w3.org/TR/xml-names11/">1.1</a> - W3C rec | <a href="https://www.w3.org/XML/1998/namespace.html">The “xml:” namespace</a> - W3C memo | <a href="https://web.archive.org/web/20180305021934/http://www.dpawson.co.uk/xsl/sect2/N5536.html">Namespaces at Pawson Q&amp;A</a></p>
<h3 id="namespaces-topics" class="shew-tgt">Topics<a href="#namespaces-topics" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#namespaces"></a><a class="relnext shew-hover" href="#namespaces-examples"></a><span class="relnop shew-hover"></span></div></h3>
<h4 id="namespaces-use" class="shew-tgt">Use a namespace<a href="#namespaces-use" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet</code> predefines the namespaces <code>xml</code>, <code>xsl</code>, and those used with <a href="#exslt">EXSLT</a> functions and elements minus <code>crypto</code> plus <code>saxon</code>. By default (global option <a href="#global-opt-doc-namespace"><code>--doc-namespace</code></a> being in effect) <code>select</code> and <code>edit</code> can use the namespaces declared in the input’s <strong>root element</strong> (document element) without explicit <a href="#select-opt-n"><code>-N «prefix»=«value»</code></a> options; if the default namespace is declared there it is bound to the <code>_</code> (underscore) (aka <code>DEFAULT</code>) prefix.</p>
<div class="enhanced">
<p>A QName (<a href="https://www.w3.org/TR/xml-names11/#ns-qualnames" title="Namespaces in XML 1.1 - W3C recommendation">qualified name</a>) with no prefix appearing in an XPath expression uses the <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#node-tests" title="W3C XPath 1.0 recommendation">null namespace</a>, not the default namespace.</p>
</div>
<p>Prefixed namespace:</p>
<pre class="lang-sh"><code>xmlstarlet select --text -t \
  -m 'set:distinct(//mime:mime-type/@type)' -v '.' -n \
recently-used.xbel</code></pre>
<p>Default namespace:</p>
<pre class="lang-sh"><code>xmlstarlet edit --inplace --pf \
  -u '/_:html/_:head/_:link/@href[.="www.css"]' -v 'solarized.css' \
  -d '//_:*[contains(@class,"pull-quote"] | //_:aside' \
article.xhtml</code></pre>
<p>Null namespace:</p>
<pre class="lang-sh"><code>xmlstarlet select -T -t \
  -m 'recs/rec' -v '@date' -n \
file.xml</code></pre>
<p><em>See also</em>: User’s guide <a href="https://xmlstar.sourceforge.net/doc/UG/ch05.html#idm47989546158480">ch. 5</a> | <a href="#error-undefined-namespace-prefix">Undefined namespace prefix</a> error | <a href="#error-xmlxpathcompopeval-function-name-bound-to-undefined-prefix-name">name bound to undefined prefix</a> error</p>
<div class="dinkus3">

</div>
<pre class="lang-sh"><code>$ cat nspre.xml
&lt;p:r xmlns:p="urn:ns1"&gt;r1
  &lt;r xmlns="urn:ns2"&gt;r2
    &lt;p:e&gt;e1&lt;/p:e&gt;
    &lt;e&gt;e2&lt;/e&gt;
  &lt;/r&gt;
&lt;/p:r&gt;
$ :
$ xmlstarlet select -t -m '//p:*' -v 'normalize-space(text())' -n nspre.xml
r1
e1
$ :
$ xmlstarlet select -N p='urn:ns2' -t -m '//p:*' -v 'normalize-space(text())' -n nspre.xml
r2
e2</code></pre>
<h4 id="namespaces-create" class="shew-tgt">Create a namespace<a href="#namespaces-create" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p>A namespace declaration cannot be created directly with XSLT 1.0<sup>[1]</sup>. It’s done by adding element and attribute nodes which have a (possibly null) namespace and a local name. <em>Hint</em>: In the following examples, add <a href="#select-opt-comp"><code>-C (--comp)</code></a> before <code>select</code>’s <code>-t</code> option to list the generated XSLT code.</p>
<p><sup>[1]</sup> <code>xmlstarlet edit</code> isn’t so picky: see <a href="#edit-opt-n"><code>edit -N</code></a> | <a href="#create-a-soap-envelope">Create a SOAP envelope</a></p>
<p><em>See also</em>: <a href="#select-opt-root"><code>select -R (--root)</code></a></p>
<h5 id="namespaces-create-prefixed" class="shew-tgt">Prefixed namespace<a href="#namespaces-create-prefixed" class="permalink shew-hover"></a></h5>
<pre class="lang-sh"><code>echo '&lt;v/&gt;' |
xmlstarlet select -N m=urn:ssssssssskeyssssstickingagain:local -t \
  -e m:doc -a flag -o 1 -b -a m:flag -o 0</code></pre>
<pre class="lang-xml"><code>&lt;m:doc xmlns:m="urn:ssssssssskeyssssstickingagain:local" flag="1" m:flag="0"/&gt;</code></pre>
<h5 id="namespaces-create-default" class="shew-tgt">Default namespace<a href="#namespaces-create-default" class="permalink shew-hover"></a></h5>
<pre class="lang-sh"><code>echo '&lt;v/&gt;' |
xmlstarlet select -N ''='https://www.example.org' -t \
  -e 'doc' -a 'flag' -v '"x"'</code></pre>
<pre class="lang-xml"><code>&lt;doc xmlns="https://www.example.org" flag="x"/&gt;</code></pre>
<h5 id="namespaces-create-null" class="shew-tgt">Null namespace<a href="#namespaces-create-null" class="permalink shew-hover"></a></h5>
<pre class="lang-sh"><code>printf '&lt;ﬁ/&gt;' |
xmlstarlet select -t \
   -e fee -a faw -o fum -b -e fi -e fo -b -o fum</code></pre>
<pre class="lang-xml"><code>&lt;fee faw="fum"&gt;&lt;fi&gt;&lt;fo/&gt;fum&lt;/fi&gt;&lt;/fee&gt;</code></pre>
<div class="dinkus2">

</div>
<p>Input file:</p>
<pre class="lang-xml"><code>&lt;h:rs id="hrs" xmlns="urn:e" xmlns:f="urn:f" xmlns:g="urn:g" xmlns:h="urn:h"&gt;
  &lt;f:r id="fr"/&gt;&lt;g:r id="gr"/&gt;&lt;h:r id="hr"/&gt;
&lt;/h:rs&gt;</code></pre>
<p>Query:</p>
<pre class="lang-sh"><code>xmlstarlet select -t \
  -m 'h:rs' -e '{local-name()}' -c '@*' -b -n \
"${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;rs xmlns="urn:e" id="hrs"/&gt;</code></pre>
<p>Use <code>-N ''=''</code> for <code>xmlns=""</code>:</p>
<pre class="lang-sh"><code>xmlstarlet select -N = -t \
  -m 'h:rs' -e '{local-name()}' -c '@*' -b -n \
"${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;rs id="hrs"/&gt;</code></pre>
<p>Edit:</p>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl --pf \
  -s 'h:rs' -t elem -n 'foo' -v 'bar' \
  -s '$prev' -t attr -n 'xmlns' -v '' \
"${infile:-file.xml}"</code></pre>
<pre class="lang-xml"><code>&lt;h:rs xmlns="urn:e" xmlns:f="urn:f" xmlns:g="urn:g" xmlns:h="urn:h" id="hrs"&gt;
  &lt;f:r id="fr"/&gt;&lt;g:r id="gr"/&gt;&lt;h:r id="hr"/&gt;
&lt;foo xmlns=""&gt;bar&lt;/foo&gt;&lt;/h:rs&gt;</code></pre>
<h4 id="namespaces-move" class="shew-tgt">Move a namespace<a href="#namespaces-move" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet edit -m '//namespace::xsi' '/_:doc/_:el' examples/xml/S0.xml</code> returns non-zero and the error message <code>FIXME: can't move namespace nodes</code>.</p>
<p><em>Links</em>: <a href="https://fossies.org/linux/xmlstarlet/examples/xml/S0.xml">examples/xml/S0.xml</a></p>
<h4 id="namespaces-delete" class="shew-tgt">Delete a namespace<a href="#namespaces-delete" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet edit -d '//namespace::xsi' examples/xml/S0.xml</code> returns non-zero and the error message <code>FIXME: can't delete namespace nodes</code>.</p>
<p><em>Links</em>: <a href="https://fossies.org/linux/xmlstarlet/examples/xml/S0.xml">examples/xml/S0.xml</a></p>
<p><em>See also</em>: <a href="#extract-subtree-to-depth-n-removing-namespaces">null-ns hack</a></p>
<h4 id="namespaces-remove-redundant" class="shew-tgt">Remove unnecessary namespace declarations<a href="#namespaces-remove-redundant" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p>Tools to remove redundant namespace declarations include <code>xmlstarlet format</code>’s <a href="#format-opt-nsclean"><code>--nsclean</code></a> option, <a href="#c14n"><code>xmlstarlet c14n</code></a>, the<code>--nsclean</code> option of <a href="#selected-resources"><code>xmllint</code></a> – all with side effects – but they won’t remove <code>xmlns:xi</code> nodes left by <a href="#transform-opt-xinclude"><code>XInclude</code></a> processing.</p>
<p><a href="#selected-resources"><code>xml2/2xml</code></a> or <a href="#pyx"><code>pyx/depyx</code></a> and <code>grep</code> can do the doctoring (<span class="caution"><strong>Caution</strong></span>: no questions asked):</p>
<pre class="lang-sh"><code>xml2 &lt; file.xml | grep -v '^/doc/@xmlns:xi' | 2xml &gt; newfile.xml</code></pre>
<h4 id="namespaces-insert-issue" class="shew-tgt">Insert node with namespace prefix<a href="#namespaces-insert-issue" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p><span class="caution"><strong>Caution</strong></span>: <code>xmlstarlet edit</code> silently ignores the namespace of an inserted node referencing a previously inserted node having a namespace prefix.</p>
<p>For instance, to insert an element such as <code>&lt;ns1:c class="caveat"/&gt;</code> it’s logical to say,</p>
<pre class="lang-sh"><code>xmlstarlet edit \
  -s '/a/b' -t elem -n 'ns1:c' \
  -s '/a/b/ns1:c' -t attr -n 'class' -v 'caveat' \
file.xml</code></pre>
<p>but the output will not contain the attribute node as the following <code>-s</code> (or <code>-i</code> or <code>-a</code>) option returns an empty nodeset. In other words <code>ns1:c</code> gets inserted but is not available as such in following <code>edit</code> actions. This is on the to-do list as hinted by <code>NULL /* TODO: NS */</code> in <a href="https://fossies.org/linux/xmlstarlet/src/xml_edit.c#l_353" title="Fossies - the Fresh Open Source Software Archive">src/xml_edit.c#edInsert()</a>.</p>
<p>Workaround: Use the <a href="#edit-prev"><code>$prev</code></a> back reference instead, as in <code>… -s '$prev' -t attr …</code>.</p>
<p><em>See also</em>: <a href="#edit-opt-subnode"><code>-s (--subnode)</code></a></p>
<h3 id="namespaces-examples" class="shew-tgt">Examples<a href="#namespaces-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#namespaces-topics"></a><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="display-namespace-nodes-in-clark-notation" class="shew-tgt">Display namespace nodes in <q>Clark notation</q><a href="#display-namespace-nodes-in-clark-notation" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: XPath recommendation: <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#namspaces-nodes" title="W3C XPath 1.0 recommendation">Namespace nodes</a> | <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#axes" title="W3C XPath 1.0 recommendation"><code>namespace</code> axis</a></p>
<pre class="lang-sh"><code>&lt;doc xmlns="http://www.example.org"
     xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  a
  &lt;xi:include href="b.xml"/&gt;
  b
  &lt;c xmlns="urn:my:local"/&gt;
  &lt;d xmlns=""&gt;In no namespace&lt;/d&gt;
&lt;/doc&gt;</code></pre>
<pre class="lang-sh"><code>xmlstarlet select -T -t \
  -m 'set:distinct(//namespace::*)' \
    -v 'concat("{",.,"}",name())' -n \
"${infile:-file.xml}"</code></pre>
<p>Output:</p>
<pre class="lang-none"><code>{http://www.w3.org/XML/1998/namespace}xml
{http://www.w3.org/2001/XInclude}xi
{http://www.example.org}
{urn:my:local}
{}</code></pre>
<h4 id="create-a-soap-envelope" class="shew-tgt">Create a SOAP envelope<a href="#create-a-soap-envelope" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#namespaces"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: <a href="https://en.wikipedia.org/wiki/SOAP"><code>SOAP</code></a> on Wikipedia</p>
<pre class="lang-sh"><code>printf '%s' '&lt;v/&gt;' |
xmlstarlet select --xml-decl --indent \
  -N xsi='http://www.w3.org/2001/XMLSchema-instance' \
  -N soapenv='http://schemas.xmlsoap.org/soap/envelope/' \
  -N my='http://www.example.org/myService' \
  -t \
  -e 'soapenv:Envelope' \
    -e 'soapenv:Header' -o '' -b \
    -e 'soapenv:Body' \
      -e 'my:Service' \
        -e 'Param1' -a 'xsi:type' -o 'integer' -b -o '1' -b \
        -e 'Param2' -a 'xsi:type' -o 'string'  -b -o 'message' -b</code></pre>
<pre class="lang-xml"><code>&lt;?xml version="1.0"?&gt;
&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt;
  &lt;soapenv:Header/&gt;
  &lt;soapenv:Body&gt;
    &lt;my:Service xmlns:my="http://www.example.org/myService"&gt;
      &lt;Param1 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="integer"&gt;1&lt;/Param1&gt;
      &lt;Param2 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="string"&gt;message&lt;/Param2&gt;
    &lt;/my:Service&gt;
  &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</code></pre>
<div class="dinkus3">

</div>
<p>To force namespace nodes into the root element (<a href="https://lenzconsulting.com/namespace-normalizer/" title="Namespace normalizer - Evan Lenz">namespace normalization</a>) append dummy attributes there, then strip them:</p>
<pre class="lang-sh"><code>printf '%s' '&lt;v/&gt;' |
xmlstarlet select \
  -N xsi='http://www.w3.org/2001/XMLSchema-instance' \
  -N soapenv='http://schemas.xmlsoap.org/soap/envelope/' \
  -N my='http://www.example.org/myService' \
  -t \
  -e 'soapenv:Envelope' -a 'xsi:nslift' -b -a 'my:nslift' -b \
    -e 'soapenv:Header' -o '' -b \
    -e 'soapenv:Body' \
      -e 'my:Service' \
        -e 'Param1' -a 'xsi:type' -o 'integer' -b -o '1' -b \
        -e 'Param2' -a 'xsi:type' -o 'string'  -b -o 'message' -b \
| xmlstarlet edit -d 'soapenv:*/@xsi:nslift | soapenv:*/@my:nslift'</code></pre>
<pre class="lang-xml"><code>&lt;?xml version="1.0"?&gt;
&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:my="http://www.example.org/myService"&gt;
  &lt;soapenv:Header/&gt;
  &lt;soapenv:Body&gt;
    &lt;my:Service&gt;
      &lt;Param1 xsi:type="integer"&gt;1&lt;/Param1&gt;
      &lt;Param2 xsi:type="string"&gt;message&lt;/Param2&gt;
    &lt;/my:Service&gt;
  &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</code></pre>
<div class="dinkus3">

</div>
<p>To have <code>xmlstarlet edit</code> produce the latter version, for example:</p>
<pre class="lang-sh"><code>printf '%s' '&lt;v/&gt;' |
xmlstarlet edit \
  -r '*' -v 'soapenv:Envelope' \
  -a '*' -type attr -n 'xmlns:soapenv' -v 'http://schemas.xmlsoap.org/soap/envelope/' \
  -a '*' -type attr -n 'xmlns:xsi' -v 'http://www.w3.org/2001/XMLSchema-instance' \
  -a '*' -type attr -n 'xmlns:my' -v 'http://www.example.org/myService' \
  -s '*' -type elem -n 'soapenv:Header' -v '' \
  -s '*' -type elem -n 'soapenv:Body' \
  -s '$prev' -type elem -n 'my:Service' \
  --var svc '$prev' \
  -s '$svc'  -type elem -n 'Param1'   -v '1' \
  -s '$prev' -type attr -n 'xsi:type' -v 'integer' \
  -s '$svc'  -type elem -n 'Param2'   -v 'message' \
  -s '$prev' -type attr -n 'xsi:type' -v 'string'</code></pre>
<div class="dinkus1">

</div>
</section>
<section id="sec-error-messages">
<h2 id="error-messages" class="shew-tgt">Error messages<a href="#error-messages" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#namespaces"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#exslt"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>A non-exhaustive list of <code>xmlstarlet</code> messages follows.</p>
<h4 id="error-no-output-and-no-error" class="shew-tgt">(No output and no error)<a href="#error-no-output-and-no-error" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>See <code>xmlstarlet</code> user’s guide <a href="https://xmlstar.sourceforge.net/doc/UG/ch05.html#idm47989546158480">ch. 5</a> “Namespaces and default namespace”.</p>
<p><em>See also</em>: <a href="#namespaces-use">Use a namespace</a></p>
<h4 id="error-edit-usage-reminder" class="shew-tgt">(<code>xmlstarlet edit</code> displays its usage reminder)<a href="#error-edit-usage-reminder" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>… but offers no other clue</p>
<ul>
<li><a href="#edit-opt-insert">adding</a> a <code>text</code> node without a <code>-n (--name)</code> or <code>-v (--value)</code> clause?</li>
<li><a href="#edit-opt-rename">renaming</a> without a <code>-v (--value)</code> clause?</li>
</ul>
<h4 id="couldnt-read-file" class="shew-tgt">couldn’t read file<a href="#couldnt-read-file" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>See <a href="#failed-to-load-external-entity">failed to load external entity</a> (re <code>stdin</code>)</p>
<h4 id="failed-to-load-external-entity" class="shew-tgt">failed to load external entity<a href="#failed-to-load-external-entity" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>Triggered by:</p>
<ul>
<li>missing <a href="#global-opt-net"><code>--net</code></a> option</li>
<li><a href="#global-param-uri"><code>uri</code></a> parameter using HTTPS protocol</li>
<li>missing or inaccessible resource
<ul>
<li>if reading from <code>stdin</code> add a <code>-</code> (dash) to the command line to work around parsing issues, e.g. if <code>format</code>’s <a href="#format-opt-encode"><code>-e (--encode) «encoding»</code></a> is the last option (explanation: <code>«encoding»</code> mistaken for filename in <a href="https://fossies.org/linux/xmlstarlet/src/xml_format.c#l_270" title="Fossies - the Fresh Open Source Software Archive">src/xml_format.c#foProcess()</a>, similarly in <a href="https://fossies.org/linux/xmlstarlet/src/xml_validate.c#l_204" title="Fossies - the Fresh Open Source Software Archive">src/xml_validate.c#valParseOptions()</a>)</li>
</ul></li>
</ul>
<h4 id="error-fixme-cant-delete-namespace-nodes" class="shew-tgt">FIXME: can’t delete namespace nodes<a href="#error-fixme-cant-delete-namespace-nodes" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>See <a href="#namespaces-delete">Delete a namespace</a>.</p>
<h4 id="error-fixme-cant-move-namespace-nodes" class="shew-tgt">FIXME: can’t move namespace nodes<a href="#error-fixme-cant-move-namespace-nodes" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>See <a href="#namespaces-move">Move a namespace</a>.</p>
<h4 id="error-invalid-context-position-invalid-context-size" class="shew-tgt">Invalid context position / Invalid context size<a href="#error-invalid-context-position-invalid-context-size" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>See <a href="#edit-xpath-arguments"><code>xpath</code> arguments</a>.</p>
<h4 id="error-move-destination-is-not-a-single-node" class="shew-tgt">move destination is not a single node<a href="#error-move-destination-is-not-a-single-node" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>The destination operand of <code>xmlstarlet edit</code>’s <a href="#edit-opt-move"><code>-m (--move)</code></a> option does not exist or is not a single element node.</p>
<h4 id="error-namespace-prefix-not-defined" class="shew-tgt">Namespace prefix «name» … is not defined<a href="#error-namespace-prefix-not-defined" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>This is a message from the XML parser: a warning but not necessarily an error. Recall that <code>:</code> (colon) in component names is <a href="https://www.w3.org/TR/REC-xml/#dt-name" title="dt-name - W3C XML 1.1 recommendation">tolerated</a> but <a href="https://www.w3.org/TR/2009/REC-xml-names-20091208#dt-nwf" title="dt-nwf - W3C Namespaces in XML 1.0 recommendation">unrecommended</a> as it makes a document not <em>namespace-well-formed</em>.</p>
<p>Example:</p>
<pre class="lang-xml"><code>&lt;doc&gt;&lt;div vid="yo" abc:txt="hello"/&gt;&lt;/doc&gt;</code></pre>
<p>To copy the value of <code>@abc:txt</code> to <code>@vid</code>, for example:</p>
<pre class="lang-sh"><code>xmlstarlet -q edit \
  -u '*/*[@*[local-name()="abc:txt"][namespace-uri()=""]]/@vid' \
  -x 'string(../@*[local-name()="abc:txt"][namespace-uri()=""])' \
file.xml</code></pre>
<p>where</p>
<ul>
<li>the global <a href="#global-opt-quiet"><code>-q</code></a> option suppresses messages from the parser about the missing namespace definition</li>
<li><a href="https://www.w3.org/TR/1999/REC-xpath-19991116#function-local-name" title="string local-name(node-set?) - W3C XPath 1.0 recommendation"><code>local-name()</code></a> and <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#function-namespace-uri" title="string namespace-uri(node-set?) - W3C XPath 1.0 recommendation"><code>namespace-uri()</code></a> are used as a workaround in the special case where an unprefixed name contains a <code>:</code> (colon), because <code>@abc:txt</code> would cause the parser to look for the non-existing <code>abc</code> namespace</li>
</ul>
<p><em>See also</em>: <a href="#namespaces-use">Use a namespace</a> | <a href="#error-undefined-namespace-prefix">Undefined namespace prefix</a></p>
<h4 id="error-undefined-namespace-prefix" class="shew-tgt">Undefined namespace prefix<a href="#error-undefined-namespace-prefix" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>Triggered by</p>
<ul>
<li>using <a href="#global-opt-doc-namespace"><code>--doc-namespace</code></a> and prefix not declared in input’s root element or with <code>-N</code> option</li>
<li>using <a href="#global-opt-no-doc-namespace"><code>--no-doc-namespace</code></a> and prefix not declared with <code>-N</code> option</li>
<li>a typo</li>
</ul>
<p><em>See also</em>: <a href="#namespaces-use">Use a namespace</a> | <a href="#error-namespace-prefix-not-defined">Namespace prefix «name» … is not defined</a></p>
<h4 id="warning-unrecognized-option-option" class="shew-tgt">Warning: unrecognized option «option»<a href="#warning-unrecognized-option-option" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>edit</code>’s <a href="#edit-opt-n"><code>-N</code> option</a> must be the last non-action option.</p>
<h4 id="xmlsax2characters-huge-text-node-out-of-memory" class="shew-tgt">xmlSAX2Characters: huge text node: out of memory<a href="#xmlsax2characters-huge-text-node-out-of-memory" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>In <code>libxml2</code> the <code>XML_PARSE_HUGE</code> option is disabled by default to prevent denial-of-service attacks. This triggers the <code>xmlSAX2Characters: huge text node: out of memory</code> error when loading a text node larger than 10 MB.</p>
<p>For a workaround see this <a href="https://github.com/martin7th/xmlstarlet-patch-huge/">patch</a>.</p>
<h4 id="error-xmlxpathcompopeval-function-name-bound-to-undefined-prefix-name" class="shew-tgt">xmlXPathCompOpEval: function «name» bound to undefined prefix «name»<a href="#error-xmlxpathcompopeval-function-name-bound-to-undefined-prefix-name" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>Triggered by</p>
<ul>
<li><code>select</code>’s <a href="#select-exslt-namespace-issue"><code>--var «name»=«value»</code> namespace issue</a></li>
<li>an undeclared <code>crypto</code> namespace prefix; see <a href="#exslt">EXSLT</a></li>
<li>a typo</li>
</ul>
<p><em>See also</em>: <a href="#namespaces-use">Use a namespace</a> | <a href="#select-opt-n"><code>select -N</code></a>.</p>
<h4 id="error-xmlxpathcompopeval-function-name-not-found" class="shew-tgt">xmlXPathCompOpEval: function «name» not found<a href="#error-xmlxpathcompopeval-function-name-not-found" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet edit</code>’s <a href="#edit-xpath-arguments"><code>xpath</code></a> arguments do not support XSLT functions.</p>
<h4 id="error-xsl-extension-element-prefix-undefined-namespace-name" class="shew-tgt">xsl:extension-element-prefix : undefined namespace «name»<a href="#error-xsl-extension-element-prefix-undefined-namespace-name" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>See <a href="#exslt">EXSLT</a>.</p>
<h4 id="error-xsltparsestylesheettop-unknown-name-element" class="shew-tgt">xsltParseStylesheetTop: unknown «name» element<a href="#error-xsltparsestylesheettop-unknown-name-element" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#error-messages"></a><span class="relnop shew-hover"></span></div></h4>
<p>A <a href="#select-opt-break"><code>-b (--break)</code></a> too many was used.</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-exslt">
<h2 id="exslt" class="shew-tgt">EXSLT and other extensions<a href="#exslt" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#error-messages"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#code-generation"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<h4 id="exslt-functions-and-elements" class="shew-tgt">EXSLT functions and elements<a href="#exslt-functions-and-elements" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p>EXSLT is an extension library for XSLT, mainly for XSLT 1.0. It provides missing language features such as functions to handle strings, math, dates, and sets, as well as nodeset coercion, user-defined functions, and dynamic evaluation of strings containing XPath expressions.</p>
<p>Linked with the <a href="#selected-resources">libexslt</a> library <code>xmlstarlet</code>’s XSLT processing commands, <code>select</code> and <code>transform</code>, support a <a href="#appendix-a-xmlstarlet-xslt-extensions" title="List of extensions">larger</a> number of EXSLT functions (and a few elements) whereas <code>xmlstarlet edit</code> supports a <a href="#edit-exslt-in-xpath-arguments" title="EXSLT in `xpath` arguments">subset</a>.</p>
<p><code>xmlstarlet</code> predefines the EXSLT namespaces with prefixes <code>date</code>, <code>dyn</code>, <code>exslt</code> (not <code>exsl</code>), <code>math</code>, <code>set</code>, and <code>str</code>, as well as the <code>saxon</code> and <code>test</code> namespaces. To use <code>crypto</code> functions (or the <a href="https://exslt.github.io/func/index.html" title="`func:function` and `func:result` on exslt.github.io"><code>func</code></a> elements) declare the namespace explicitly with <a href="#select-opt-n"><code>-N</code></a>, for the <a href="https://exslt.github.io/exsl/elements/document/index.html"><code>exslt:document</code></a> element see <a href="#create-multiple-result-documents">example</a>.</p>
<p><em>Note</em>: In 2012 <code>str:replace</code> was removed as <a href="https://gitlab.gnome.org/GNOME/libxslt/-/commit/ae49d7a73b043bccb7631e7d9577bcaa0bbf8528">broken</a> when used in an XPath context (<code>xmlstarlet edit</code>) but remains available when used in an XSLT context (<code>select</code> and <code>transform</code>).</p>
<p><em>See also</em>: <a href="#appendix-a-xmlstarlet-xslt-extensions">List of XSLT extensions</a> | <a href="#transform-opt-show-ext"><code>transform --show-ext</code></a> | <a href="#select-opt-n"><code>select -N</code></a></p>
<p><em>Links</em>: <a href="https://exslt.github.io/">EXSLT docs on github.io</a> | <a href="https://github.com/exslt/exslt.github.io/">EXSLT project on github.com</a> | <a href="https://stackoverflow.com/questions/tagged/exslt">EXSLT on stackoverflow.com</a></p>
<p>Observations:</p>
<ul>
<li><code>libexslt</code>’s <a href="https://exslt.github.io/math/functions/random/index.html" title="EXSLT docs on github.io"><code>math:random</code></a> appears to use the standard C random generator, returning the same number sequence (beginning with <code>0.84018771715471</code>) in every <code>xmlstarlet</code> session</li>
<li><a href="https://gitlab.gnome.org/GNOME/libxslt/-/blob/master/libexslt/strings.c#L377"><code>libexslt</code></a> (not EXSLT) limits the length of <a href="https://exslt.github.io/str/functions/padding/index.html" title="EXSLT docs on github.io"><code>str:padding</code></a> to 100000 (one hundred thousand)</li>
</ul>
<h4 id="extensions-not-found-in-exslt-documentation" class="shew-tgt">Extensions not found in EXSLT documentation<a href="#extensions-not-found-in-exslt-documentation" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<ul>
<li><code>crypto</code> - 5 functions in namespace <code>http://exslt.org/crypto</code> (<code>md4</code>, <code>md5</code>, <code>rc4_decrypt</code>, <code>rc4_encrypt</code>, <code>sha1</code>), cf.  <a href="https://gitlab.gnome.org/GNOME/libxslt/-/blob/master/libexslt/crypto.c">libexslt/crypto.c</a> source code</li>
<li><code>saxon</code> - 5 functions in namespace <code>http://icl.com/saxon</code> (<code>eval</code>, <code>evaluate</code>, <code>expression</code>, <code>line-number</code>, <code>systemId</code>), from the <a href="https://saxon.sourceforge.net/saxon6.5.5/extensions.html" title="saxon 6.5.5 extensions on SourceForge">saxon 6.5.5</a> extensions</li>
<li><code>test</code> - function and element in namespace <code>http://xmlsoft.org/XSLT/</code> - echoes its argument</li>
</ul>
<h3 id="exslt-examples" class="shew-tgt">Examples<a href="#exslt-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<div id="toc-exslt" class="nav">
<ul>
<li><a href="#compute-xml-tree-height">Compute XML tree height</a> | <a href="#xml-to-csv">XML to CSV</a> | <a href="#from-h2-sections-with-foo-titles-select-div-with-the-most-p-children">From <code>h2</code> sections select <code>div</code> with the most <code>p</code> children</a> | <a href="#convert-between-local-and-utc-time">Convert between local and UTC time</a> | <a href="#use-setleading-and-settrailing">Use <code>set:leading</code> and <code>set:trailing</code></a> | <a href="#generate-a-date-sequence">Generate a date sequence</a> | <a href="#group-by-element-name-and-merge-text">Group by element name and merge text</a></li>
</ul>
</div>
<h4 id="compute-xml-tree-height" class="shew-tgt">Compute XML tree height<a href="#compute-xml-tree-height" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p>Compute the height of an XML tree as the maximum depth of a branch node of the tree. Root and leaf nodes count as zero.</p>
<ul>
<li><a href="#select-opt-template"><code>-t (--template)</code></a> makes <code>/</code> (root node) the current node</li>
<li>EXSLT’s <a href="https://exslt.github.io/dyn/functions/map/index.html"><code>dyn:map</code></a> function maps each XML element (root node descendants) to its depth: the number of its ancestor elements</li>
<li><a href="https://exslt.github.io/math/functions/max/index.html"><code>math:max</code></a> returns the maximum number</li>
</ul>
<pre class="lang-sh"><code>xmlstarlet select -T -t \
  -v 'math:max(dyn:map(descendant::*,"count(ancestor::*)"))' -n \
"${infile:-file.xml}"</code></pre>
<p><em>Links</em>: <a href="https://en.wikipedia.org/wiki/Tree_(data_structure)#Terminology" title="Wikipedia: Tree (data structure)">Tree (data structure)</a> on Wikipedia</p>
<h4 id="xml-to-csv" class="shew-tgt">XML to CSV<a href="#xml-to-csv" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p>A simple recordset enclosed in a root element,</p>
<pre class="lang-xml"><code>&lt;rs&gt;
  &lt;r id="1" user="3" name="abc" date="2017-08" flag1="false"/&gt;
  &lt;r id="2" user="7" name="defg" date="2019-12" flag1="false"/&gt;
  &lt;r id="3" user="9" name="hijkl" date="2020-02" flag1="true"/&gt;
  &lt;r id="4" user="11" name="mno" date="2022-01" flag1="false"/&gt;
  &lt;r id="5" user="14" name="pqrs" date="2022-01" flag1="false"/&gt;
&lt;/rs&gt;</code></pre>
<p>is converted to TSV by:</p>
<pre class="lang-sh"><code>xmlstarlet select --text -t \
  --var ishdr="${hdr:-1}" \
  --var ofs -o "$(printf '\t')" -b \
  --var ors -n -b \
  --var fnhdr='"concat($ofs,name())"' \
  --var fnrow='"concat($ofs,string())"' \
  -m '*/*[$ishdr and position() = 1]' \
    -v 'substring-after(str:concat(dyn:map(@*,$fnhdr)),$ofs)' -v '$ors' \
  -b \
  -m '*/*' \
    -v 'substring-after(str:concat(dyn:map(@*,$fnrow)),$ofs)' -v '$ors' \
  -b \
"${infile:-file.xml}"</code></pre>
<p>where:</p>
<ul>
<li>the <code>ofs</code> and <code>ors</code> variables hold output field and record separators, respectively</li>
<li>the <code>ishdr</code> flag controls output of a header line with attribute names</li>
<li><code>fnhdr</code> is the function argument (as text) to the EXSLT <a href="https://exslt.github.io/dyn/functions/map/index.html"><code>dyn:map</code></a> function mapping an attribute node to its <code>name()</code> preceded by a field separator; <code>dyn:map</code> returns a nodeset which is stringified by the EXSLT <a href="https://exslt.github.io/str/functions/concat/index.html"><code>str:concat</code></a> function, then stripped of the initial extra separator by <code>substring-after()</code></li>
<li><code>fnrow</code> is the ditto to map to its text value, in this case <code>.</code> (dot) can replace <code>string()</code></li>
<li>for a different input adjust <code>*/*</code> and <code>@*</code> only (both in 2 places)</li>
</ul>
<p>TSV output:</p>
<pre class="lang-none"><code>id      user    name    date    flag1
1       3       abc     2017-08 false
2       7       defg    2019-12 false
3       9       hijkl   2020-02 true
4       11      mno     2022-01 false
5       14      pqrs    2022-01 false</code></pre>
<p>If the data items exist as child elements of <code>/rs/r</code> (e.g. after: <code>xmlstarlet sel -t -e '{name(*)}' -m '*/*' -e '{name()}' -m '@*' -e '{name()}' -v . "${infile}"</code>), instead <code>dyn:map(*,…)</code> (2 places) to process <code>child::*</code> rather than <code>attribute::*</code>.</p>
<p><em>Links</em>: <code>packages.debian.org</code> <a href="https://packages.debian.org/bullseye/xml2" title="Convert between XML, HTML, CSV and a line-oriented format">xml2</a></p>
<h4 id="from-h2-sections-with-foo-titles-select-div-with-the-most-p-children" class="shew-tgt">From <code>h2</code> sections with <code>foo</code> titles select <code>div</code> with the most <code>p</code> children<a href="#from-h2-sections-with-foo-titles-select-div-with-the-most-p-children" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p>Process an HTML document where each <code>h2</code> element heads a number of <code>div</code>s:</p>
<pre class="lang-sh"><code>xmlstarlet select -t \
  --var T='//_:div[_:p][contains(preceding::_:h2[1]/text(),"foo")]' \
  -c '($T[count(_:p) = math:max(dyn:map($T,"count(_:p)"))])[1]' \
file.xhtml</code></pre>
<ul>
<li>var. <code>T</code> collects the <code>div</code> nodes with least one <code>p</code> child following each <code>h2</code> title containing the text <code>foo</code></li>
<li><a href="https://exslt.github.io/dyn/functions/map/index.html"><code>dyn:map</code></a> maps each <code>div</code> to the count of its <code>p</code> children, <a href="https://exslt.github.io/math/functions/max/index.html"><code>math:max</code></a> picks the maximum count</li>
<li><code>($T[…])[1]</code> selects the first of possibly more <code>div</code>s with a maximum <code>p</code> count</li>
</ul>
<h4 id="convert-between-local-and-utc-time" class="shew-tgt">Convert between local and UTC time<a href="#convert-between-local-and-utc-time" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p>Converting between local time (<code>L</code>) and UTC time (<code>Z</code>) in different time zones, the <a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html#tag_08_03" title="POSIX: 'This variable shall represent timezone information'"><code>TZ</code></a> environment variable selecting an entry in <a href="https://www.pathname.com/fhs/pub/fhs-2.3.html#USRSHAREARCHITECTUREINDEPENDENTDATA" title="Filesystem Hierarchy Standard - /usr/share : Architecture-independent data"><code>/usr/share/zoneinfo</code></a>, putting EXSLT functions <code>date:date-time</code>, <code>date:add</code>, <code>date:duration</code>, and <code>date:seconds</code> to use.</p>
<p><em>Links</em>: EXSLT <a href="https://exslt.github.io/date/index.html"><code>dates-and-times</code></a> docs | <a href="https://en.wikipedia.org/wiki/Tz_database">tz database</a> on Wikipedia</p>
<pre class="lang-sh"><code>for zone in \
  'America/Vancouver' 'Europe/Vatican' 'Asia/Manila' 'Pacific/Chatham'
do
  printf '&lt;v/&gt;\n' | 
  TZ=":$zone" xmlstarlet select --text \
  -t \
    --var ofs -o "$(printf '\t')" -b \
    --var ors -n -b \
    --var tz -o "$zone" -b \
    --var dttodayL -v 'date:date-time()' -b \
    --var tzoffset='substring($dttodayL,20)' \
    --var tzseconds='number(concat(
                     translate(substring($tzoffset,1,1),"-−+","--"),
                     substring($tzoffset,2,2) * 60 * 60 +
                     substring($tzoffset,5,2) * 60))' \
    --var dtepochL='concat("1970-01-01T00:00:00",$tzoffset)' \
    --var dtepochZ -o '1970-01-01T00:00:00+00:00' -b \
    --var dttodayZ='concat(substring-before(date:add($dtepochZ,
                    date:duration(date:seconds($dttodayL))),
                    "Z"),"+00:00")' \
    --var dttoday2L='date:add($dtepochL, 
                     date:duration(date:seconds($dttodayZ)+$tzseconds))' \
    -v 'concat(
       "# ",$tz,$ors
       ,"dttodayL", $ofs, $dttodayL, $ors
       ,"tzoffset", $ofs, $tzoffset, $ors
       ,"tzseconds",$ofs, $tzseconds,$ors
       ,"dttodayZ", $ofs, $dttodayZ, $ors
       ,"dttoday2L",$ofs, $dttoday2L,$ors
       )'
done |
expand -t 16</code></pre>
<p>Using <code>… -v 'date:date-time()' -b</code> (rather than <code>…='date:date-time()'</code>) to avoid <code>xmlstarlet select</code>’s <a href="#select-exslt-namespace-issue">EXSLT namespace issue</a>.</p>
<p>Output:</p>
<pre class="lang-none"><code># America/Vancouver
dttodayL        2023-08-15T13:04:07-07:00
tzoffset        -07:00
tzseconds       -25200
dttodayZ        2023-08-15T20:04:07+00:00
dttoday2L       2023-08-15T13:04:07-07:00
# Europe/Vatican
dttodayL        2023-08-15T22:04:07+02:00
tzoffset        +02:00
tzseconds       7200
dttodayZ        2023-08-15T20:04:07+00:00
dttoday2L       2023-08-15T22:04:07+02:00
# Asia/Manila
dttodayL        2023-08-16T04:04:07+08:00
tzoffset        +08:00
tzseconds       28800
dttodayZ        2023-08-15T20:04:07+00:00
dttoday2L       2023-08-16T04:04:07+08:00
# Pacific/Chatham
dttodayL        2023-08-16T08:49:07+12:45
tzoffset        +12:45
tzseconds       45900
dttodayZ        2023-08-15T20:04:07+00:00
dttoday2L       2023-08-16T08:49:07+12:45</code></pre>
<h4 id="use-setleading-and-settrailing" class="shew-tgt">Use <code>set:leading</code> and <code>set:trailing</code><a href="#use-setleading-and-settrailing" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: EXSLT <a href="https://exslt.github.io/set/index.html"><code>set</code> functions</a> on github.io</p>
<p>Using an explicit namespace declaration <code>-N str='…'</code> to avoid <code>xmlstarlet select</code>’s <a href="#select-exslt-namespace-issue">EXSLT namespace issue</a>.</p>
<pre class="lang-sh"><code>printf '%s\n' '&lt;v s="/fee/fi/fo/fum"/&gt;' |
xmlstarlet select -R \
  -N str='http://exslt.org/strings' \
  -t \
  --var sep='"/"' \
  --var T='str:split(*/@s,$sep)' \
  -n -c '$T' -n \
  -n -c 'set:leading($T,$T[.="fo"])' -n \
  -n -m '$T' -c  'set:leading($T,following-sibling::*[1])' -n -b \
  -n -m '$T' -c 'set:trailing($T,preceding-sibling::*[1])' -n -b \
  -n -e 'foo' -m 'set:trailing($T,$T[.="fee"])' -v 'concat($sep,.)' -b -b -n</code></pre>
<p>Output:</p>
<pre class="lang-none"><code>&lt;xsl-select&gt;
&lt;token&gt;fee&lt;/token&gt;&lt;token&gt;fi&lt;/token&gt;&lt;token&gt;fo&lt;/token&gt;&lt;token&gt;fum&lt;/token&gt;

&lt;token&gt;fee&lt;/token&gt;&lt;token&gt;fi&lt;/token&gt;

&lt;token&gt;fee&lt;/token&gt;
&lt;token&gt;fee&lt;/token&gt;&lt;token&gt;fi&lt;/token&gt;
&lt;token&gt;fee&lt;/token&gt;&lt;token&gt;fi&lt;/token&gt;&lt;token&gt;fo&lt;/token&gt;
&lt;token&gt;fee&lt;/token&gt;&lt;token&gt;fi&lt;/token&gt;&lt;token&gt;fo&lt;/token&gt;&lt;token&gt;fum&lt;/token&gt;

&lt;token&gt;fee&lt;/token&gt;&lt;token&gt;fi&lt;/token&gt;&lt;token&gt;fo&lt;/token&gt;&lt;token&gt;fum&lt;/token&gt;
&lt;token&gt;fi&lt;/token&gt;&lt;token&gt;fo&lt;/token&gt;&lt;token&gt;fum&lt;/token&gt;
&lt;token&gt;fo&lt;/token&gt;&lt;token&gt;fum&lt;/token&gt;
&lt;token&gt;fum&lt;/token&gt;

&lt;foo&gt;/fi/fo/fum&lt;/foo&gt;
&lt;/xsl-select&gt;</code></pre>
<p><em>See also</em>: <a href="#divide-a-document-into-sections">Divide a document into sections</a> | <a href="#generate-a-date-sequence">Generate a date sequence</a></p>
<h4 id="generate-a-date-sequence" class="shew-tgt">Generate a date sequence<a href="#generate-a-date-sequence" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p><em>Links</em>: <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> standard on Wikipedia | Daylight saving time (<a href="https://en.wikipedia.org/wiki/Daylight_saving_time">DST</a>) on Wikipedia | <a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html#tag_08_03" title="POSIX: 'This variable shall represent timezone information'"><code>TZ</code></a> env.var. on OpenGroup</p>
<p>This is where the EXSLT <a href="https://exslt.github.io/str/index.html"><code>strings</code></a>, <a href="https://exslt.github.io/set/index.html"><code>sets</code></a>, and <a href="https://exslt.github.io/date/index.html"><code>dates-and-times</code></a> modules come together to compute a datetime series from 3 arguments:</p>
<ol type="1">
<li><code>start</code>, default value is today in ISO 8601 extended format</li>
<li><code>step</code>, default value is 1 day in ISO 8601 format</li>
<li><code>maxct</code>, the maximum count, default value is 100</li>
</ol>
<p>XSLT doesn’t do loops but EXSLT lets you create a string of any length and <code>str:split</code> it into a nodeset each member of which contains the <code>step</code> interval. An initial empty time period (<code>PT0S</code>) is added to handle the first item. Using <code>set:leading</code> to collect N <code>step</code>s, <code>date:sum</code> to sum them up, then adding the sum to <code>start</code>, to arrive at a result for each item in the series. It’s an inefficient algorithm so nil points for performance (though probably fast enough for ordinary <code>maxct</code> values).</p>
<pre class="lang-sh"><code>xsdateseq0() {
  printf '&lt;v start="%s" step="%s" maxct="%s"/&gt;\n' \
          "${1:-$(date '+%Y-%m-%d')}" "${2:-P1D}" "${3:-100}" |
  xmlstarlet select --text \
    -N str='http://exslt.org/strings' \
    -t --var start='*/@start' \
       --var padlen='(*/@maxct - 1) * (1 + string-length(*/@step))' \
       --var D='str:split(concat("PT0S",str:padding($padlen, concat(" ",*/@step))))' \
    -m '$D' -v 'date:add($start, date:sum(set:leading($D,following-sibling::*[1])))' -n 
}</code></pre>
<p>Using an explicit namespace declaration <code>-N str='…'</code> to avoid <code>xmlstarlet select</code>’s <a href="#select-exslt-namespace-issue">EXSLT namespace issue</a>. <code>libexslt</code> doesn’t support <code>date:format-date</code> but there’s an <a href="https://exslt.github.io/date/functions/format-date/index.html">implementation</a> (EXSLT function and XSLT template) by Jeni Tennison.</p>
<div class="dinkus3">

</div>
<p>Print 53 dates starting on January 1st with a step value of 7 days.</p>
<pre class="lang-sh"><code>TZ=':Europe/Vatican' xsdateseq0 '2023-01-01' P7D 53 | pr -t -8 -s' ' - </code></pre>
<pre class="lang-none"><code>2023-01-01 2023-02-19 2023-04-09 2023-05-28 2023-07-16 2023-09-03 2023-10-15 2023-11-26
2023-01-08 2023-02-26 2023-04-16 2023-06-04 2023-07-23 2023-09-10 2023-10-22 2023-12-03
2023-01-15 2023-03-05 2023-04-23 2023-06-11 2023-07-30 2023-09-17 2023-10-29 2023-12-10
2023-01-22 2023-03-12 2023-04-30 2023-06-18 2023-08-06 2023-09-24 2023-11-05 2023-12-17
2023-01-29 2023-03-19 2023-05-07 2023-06-25 2023-08-13 2023-10-01 2023-11-12 2023-12-24
2023-02-05 2023-03-26 2023-05-14 2023-07-02 2023-08-20 2023-10-08 2023-11-19 2023-12-31
2023-02-12 2023-04-02 2023-05-21 2023-07-09 2023-08-27</code></pre>
<div class="dinkus3">

</div>
<p>Print 10 datetimes with a step value of 1 day, 1 hour, 1 minute, and 5 seconds.<br/>
<strong>Note</strong> the lack of DST adjustment.</p>
<pre class="lang-sh"><code>TZ=':Europe/Vatican' xsdateseq0 '2022-10-26T07:30:00+01:00' 'P1DT1H1M5S' 10 </code></pre>
<pre class="lang-none"><code>2022-10-26T07:30:00+01:00
2022-10-27T08:31:05+01:00
2022-10-28T09:32:10+01:00
2022-10-29T10:33:15+01:00
2022-10-30T11:34:20+01:00
2022-10-31T12:35:25+01:00
2022-11-01T13:36:30+01:00
2022-11-02T14:37:35+01:00
2022-11-03T15:38:40+01:00
2022-11-04T16:39:45+01:00</code></pre>
<div class="dinkus3">

</div>
<p>Print 8 datetimes in email format (RFC 822). Uses <a href="https://www.gnu.org/software/coreutils/date">GNU <code>date</code></a> for <code>-R</code> and <code>-f</code> options and DST adjustment.</p>
<pre class="lang-sh"><code>TZ=':Europe/Vatican' xsdateseq0 '2022-10-26T11:30:00' '' 8 | date -Rf-</code></pre>
<pre class="lang-none"><code>Wed, 26 Oct 2022 13:30:00 +0200
Thu, 27 Oct 2022 13:30:00 +0200
Fri, 28 Oct 2022 13:30:00 +0200
Sat, 29 Oct 2022 13:30:00 +0200
Sun, 30 Oct 2022 12:30:00 +0100
Mon, 31 Oct 2022 12:30:00 +0100
Tue, 01 Nov 2022 12:30:00 +0100
Wed, 02 Nov 2022 12:30:00 +0100</code></pre>
<h4 id="group-by-element-name-and-merge-text" class="shew-tgt">Group by element name and merge text<a href="#group-by-element-name-and-merge-text" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#exslt"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet select</code> doesn’t support <code>xsl:key</code> but grouping can be done using EXSLT functions. As an example, group repeating fields in each record by element name and merge their texts in document order.</p>
<pre class="lang-xml"><code>&lt;recs&gt;
  &lt;rec&gt;
    &lt;fb&gt;fee&lt;/fb&gt;
    &lt;fa&gt;foo&lt;/fa&gt;
    &lt;fd&gt;zzz&lt;/fd&gt;
    &lt;fc&gt;bat&lt;/fc&gt;
    &lt;fa&gt;bar&lt;/fa&gt;
    &lt;fb&gt;faw&lt;/fb&gt;
    &lt;fd&gt;bat&lt;/fd&gt;
    &lt;fb&gt;fum&lt;/fb&gt;
    &lt;fa&gt;quux&lt;/fa&gt;
  &lt;/rec&gt;
  &lt;rec&gt;
    &lt;fa&gt;fee&lt;/fa&gt;
    &lt;fc&gt;fo&lt;/fc&gt;
    &lt;fc&gt;fum&lt;/fc&gt;
    &lt;fa&gt;fi&lt;/fa&gt;
  &lt;/rec&gt;
&lt;/recs&gt;</code></pre>
<pre class="lang-sh"><code>xmlstarlet select --indent -t \
  --var sfs="'${sfs:- }'" \
  -e '{name(*)}' \
    -m '*/*' \
      --var rec='.' \
      -e '{name()}' \
        -m 'set:distinct(dyn:map(*,"name()"))' \
          -s 'A:T:-' '.' \
          -e '{.}' \
            -v 'substring-after(
                  str:concat(
                    dyn:map($rec/*[name()=current()],"concat($sfs,text())")
                  )
               ,$sfs)' \
"${infile:-file.xml}"</code></pre>
<ul>
<li>the sub-field separator, <code>sfs</code>, takes its value from a shell variable of the same name, defaulting to a single space character</li>
<li><a href="#select-opt-elem"><code>-e (--elem)</code></a> opens a named element using an <a href="https://www.w3.org/TR/1999/REC-xslt-19991116.html#attribute-value-templates" title="W3C XSLT 1.0 recommendation">attribute value template</a>, duplicating the input structure</li>
<li>the 1st <a href="#select-opt-match"><code>-m (--match)</code></a> iterates over <code>rec</code> elements, the 2nd over unique field names (also used as sort key): <a href="https://exslt.github.io/dyn/functions/map/index.html"><code>dyn:map</code></a> maps fields to their name and <a href="https://exslt.github.io/set/functions/distinct/index.html"><code>set:distinct</code></a> eliminates duplicates</li>
<li>to merge texts from <code>rec</code> elements with the same name as the current field <code>dyn:map</code> adds a sub-field separator to each text, returning a nodeset which is stringified by <a href="https://exslt.github.io/str/functions/concat/index.html"><code>str:concat</code></a> then stripped of the initial extra separator</li>
</ul>
<p>Output:</p>
<pre class="lang-sh"><code>&lt;recs&gt;
  &lt;rec&gt;
    &lt;fa&gt;foo bar quux&lt;/fa&gt;
    &lt;fb&gt;fee faw fum&lt;/fb&gt;
    &lt;fc&gt;bat&lt;/fc&gt;
    &lt;fd&gt;zzz bat&lt;/fd&gt;
  &lt;/rec&gt;
  &lt;rec&gt;
    &lt;fa&gt;fee fi&lt;/fa&gt;
    &lt;fc&gt;fo fum&lt;/fc&gt;
  &lt;/rec&gt;
&lt;/recs&gt;</code></pre>
<em>See also</em>: <a href="#remove-all-but-the-latest-member-of-each-group">Remove all but the latest member of each group</a> example
<div class="dinkus1">

</div>
</section>
<section id="sec-code-generation">
<h2 id="code-generation" class="shew-tgt">Code generation<a href="#code-generation" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#exslt"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#appendix-a-xmlstarlet-xslt-extensions"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>This section takes <code>xmlstarlet</code> off the beaten track.</p>
<div id="toc-code-generation" class="nav">
<ul>
<li><a href="#select-as-edit-script-generator"><code>select</code> as <code>edit</code> script generator</a><br/>
<a href="#code-generation-edit-examples">Examples</a> | <a href="#rename-elements">Rename elements</a> | <a href="#remove-all-but-the-latest-member-of-each-group">Remove all but the latest member of each group</a> | <a href="#translate-xliff-file">Translate XLIFF file</a></li>
<li><a href="#select-as-xslt-stylesheet-generator"><code>select</code> as XSLT stylesheet generator</a><br/>
<a href="#spell-it-out">Spell it out</a> | <a href="#next-step-dont-repeat-yourself">Next step: DRY</a> || <a href="#code-generation-xslt-examples">Examples</a> | <a href="#create-multiple-result-documents">Create multiple result documents</a></li>
</ul>
</div>
<h3 id="select-as-edit-script-generator" class="shew-tgt"><code>select</code> as <code>edit</code> script generator<a href="#select-as-edit-script-generator" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span><a class="relup shew-hover" href="#code-generation"></a><a class="relnext shew-hover" href="#code-generation-edit-examples"></a><a class="rellast shew-hover" href="#code-generation-xslt-examples"></a></div></h3>
<p><a href="#select"><code>xmlstarlet select</code></a> doesn’t copy its input to output; <a href="#edit"><code>edit</code></a> cannot do <code>xsl:for-each</code>, <code>xsl:choose</code>, or use XSLT functions. In tandem they have a wider range – but so does an XSLT stylesheet.</p>
<p><em>Links</em>: <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_02" title="Shell command language at Open Group (POSIX)"><em>shell quoting</em></a> | <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06" title="Shell command language at Open Group (POSIX)"><em>shell word expansions</em></a></p>
<h3 id="code-generation-edit-examples" class="shew-tgt">Examples<a href="#code-generation-edit-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><span class="relnop shew-hover"></span><a class="relprev shew-hover" href="#select-as-edit-script-generator"></a><a class="relup shew-hover" href="#code-generation"></a><a class="relnext shew-hover" href="#select-as-xslt-stylesheet-generator"></a><a class="rellast shew-hover" href="#code-generation-xslt-examples"></a></div></h3>
<h4 id="rename-elements" class="shew-tgt">Rename elements<a href="#rename-elements" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span></div></h4>
<p><code>xmlstarlet edit</code>’s <a href="#edit-opt-rename">rename</a> action requires a literal value for the new name so XPath functions are out. But <code>select</code> can generate the edit command, for example to number elements (here using the XSLT <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-format-number" title="W3C XSLT 1.0 recommendation"><code>format-number()</code></a> function):</p>
<pre class="lang-xml"><code>&lt;Names&gt;
  &lt;Name&gt;fee&lt;/Name&gt;
  &lt;Name&gt;faw&lt;/Name&gt;
  &lt;Name&gt;fum&lt;/Name&gt;
&lt;/Names&gt;</code></pre>
<pre class="lang-sh"><code># shellcheck shell=sh disable=SC2016
xmlstarlet select --text -t \
  --var sq -o "'" -b \
  -o "xmlstarlet edit --omit-decl \\" -n \
  -o "  --var N 'Names/Name' \\" -n \
  -m '*/*' \
    -o '  -r ' -v 'concat($sq,"$N[",position(),"]",$sq)' \
    -o '  -v ' -v 'concat($sq,name(),format-number(position(),"0000"),$sq)' -o " \\" -n \
  -b \
  -f -n \
"${infile:-file.xml}"</code></pre>
<p>Output:</p>
<pre class="lang-sh"><code>xmlstarlet edit --omit-decl \
  --var N 'Names/Name' \
  -r '$N[1]'  -v 'Name0001' \
  -r '$N[2]'  -v 'Name0002' \
  -r '$N[3]'  -v 'Name0003' \
file.xml</code></pre>
<p>To execute the output as a shell script:</p>
<pre class="lang-sh"><code>xmlstarlet-select-command | sh -s &gt; result.xml</code></pre>
<p>Alternatively, replace <code>$N</code> with <code>(Names/Name)</code>, or process elements in reverse order by repeatedly renaming <code>Names/Name[last()]</code> – the predicate <code>[…]</code> binding to the nearest XPath <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#section-Location-Steps" title="W3C XPath 1.0 recommendation">location step</a>.</p>
<h4 id="remove-all-but-the-latest-member-of-each-group" class="shew-tgt">Remove all but the latest member of each group<a href="#remove-all-but-the-latest-member-of-each-group" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span></div></h4>
<p><a href="#exslt">EXSLT</a> functions provide another way to do grouping. Here’s how to create a shell script invoking <code>xmlstarlet edit</code> to delete all but the latest member of each group. The input file has module ID strings on the form: group ID, <code>_</code> (underscore), major version number, <code>.</code> (dot), minor version number – as shown in this snippet:</p>
<pre class="lang-xml"><code>&lt;mod&gt;mrR_0.9&lt;/mod&gt;
&lt;mod&gt;mrR_0.10&lt;/mod&gt;
&lt;mod&gt;mrM_0.19&lt;/mod&gt;
&lt;mod&gt;mrM_0.2&lt;/mod&gt;
&lt;mod&gt;mrM_0.20&lt;/mod&gt;
&lt;mod&gt;mrM_0.3&lt;/mod&gt;</code></pre>
<p>Method:</p>
<ul>
<li>identify groups:
<ul>
<li><a href="https://exslt.github.io/dyn/functions/map/index.html"><code>dyn:map</code></a> a module ID string to its group ID (invoking <code>$fngrpid</code>)</li>
<li><a href="https://exslt.github.io/set/functions/distinct/index.html"><code>set:distinct</code></a> eliminates duplicates</li>
</ul></li>
<li>sort each group by version in descending order:
<ul>
<li><a href="https://exslt.github.io/str/functions/split/index.html"><code>str:split</code></a> the version into major and minor number</li>
<li><a href="https://exslt.github.io/dyn/functions/map/index.html"><code>dyn:map</code></a> each number to an N-digit string (invoking <code>$fnverno</code>)</li>
<li><a href="https://exslt.github.io/str/functions/concat/index.html"><code>str:concat</code></a> stringifies the nodeset returned by <code>dyn:map</code> creating strings on the form <code>00010011</code> (i.e. version <code>1.11</code>) to be passed to <a href="#select-opt-sort" title="select -s (--sort)"><code>-s (--sort)</code></a></li>
</ul></li>
<li>accumulate an XPath <a href="https://www.w3.org/TR/1999/REC-xpath-19991116#NT-UnionExpr" title="W3C XPath 1.0 recommendation">union</a> expression specifying what to keep
<ul>
<li>appending to the initial empty nodeset <code>/..</code> (root node has no parent)</li>
<li>preferring a single XPath expression to multiple <code>edit</code> actions</li>
<li>to keep it on one line remove <code>-n</code> before <code>-v</code></li>
</ul></li>
<li>delete the <a href="https://exslt.github.io/set/functions/difference/index.html"><code>set:difference</code></a> (<code>$M</code> minus <code>$keep</code>)
<ul>
<li>note the escaped <code>$</code>s (dollar signs) to guard against <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06" title="Shell command language at Open Group (POSIX)"><em>shell word expansions</em></a></li>
</ul></li>
</ul>
<pre class="lang-sh"><code># shellcheck shell=sh disable=SC2016,SC2064
xmlstarlet select --text -t \
  --var dq -o '"' -b \
  --var sep1='"_"' \
  --var sep2='"."' \
  --var fngrpid -o 'substring-before(.,$sep1)' -b \
  --var fnverno -o 'format-number(.,"0000")' -b \
  --var allm='//_:mods/_:mod' \
  -o "xmlstarlet edit \\" -n \
  -o "  --var M '//_:mods/_:mod' \\" -n \
  -o "  --var keep '/.. " \
  -m 'set:distinct(dyn:map($allm,$fngrpid))' \
    --var grpid_='concat(.,$sep1)' \
    -m '$allm[starts-with(.,$grpid_)]' \
      -s 'D:N:-' '0 + str:concat(dyn:map(str:split(substring-after(.,$sep1),$sep2),$fnverno))' \
      --if 'position() = 1' \
        -n -v 'concat("  | $M[.=",$dq,current(),$dq,"]")' \
      -b \
    -b \
  -b \
  -o "' \\" -n \
  -o "  --delete 'set:difference(\$M,\$keep)' \\" -n \
  -f -n \
"${infile:-file.xml}"</code></pre>
<p><em>See also</em>: <a href="#select-opt-var-break"><code>select</code>’s <code>--var</code></a> | <a href="#select-opt-match"><code>-m (--match)</code></a> | <a href="#select-opt-sort" title="select -s (--sort)"><code>-s (--sort)</code></a> | <a href="#select-opt-if"><code>-i (--if)</code></a> | <a href="#select-opt-break"><code>-b (--break)</code></a> | <a href="#select-opt-inp-name"><code>-f (--inp-name)</code></a> | <a href="#group-by-element-name-and-merge-text">Group by element name and merge text</a> example</p>
<p><em>Links</em>: XSLT functions <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-format-number" title="W3C XSLT 1.0 recommendation"><code>format-number()</code></a> | <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#function-current" title="W3C XSLT 1.0 recommendation"><code>current()</code></a></p>
<p>Output:</p>
<pre class="lang-sh"><code>xmlstarlet edit \
  --var M '//_:mods/_:mod' \
  --var keep '/.. 
  | $M[.="mrR_1.11"]
  | $M[.="mrS_0.7"]
  | $M[.="mrE_2.2"]
  | $M[.="mrM_0.20"]' \
  --delete 'set:difference($M,$keep)' \
file.xml</code></pre>
<p>To execute the output as a shell script:</p>
<pre class="lang-sh"><code>xmlstarlet-select-command | sh -s &gt; result.xml</code></pre>
<p><em>See also</em>: <a href="#edit-opt-var"><code>edit</code>’s <code>--var</code></a> | <a href="#edit-opt-delete"><code>-d (--delete)</code></a></p>
<h4 id="translate-xliff-file" class="shew-tgt">Translate XLIFF file<a href="#translate-xliff-file" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span></div></h4>
<p>This is the basic “update node with result of shell command” usecase.</p>
<p>Create a shell script to have <code>xmlstarlet edit</code> add missing targets to an <a href="https://en.wikipedia.org/wiki/XLIFF" title="'XML Localization Interchange File Format' on Wikipedia">XLIFF</a> version 2.0 localization data file by invoking <a href="https://www.soimort.org/translate-shell/"><code>translate-shell</code></a> to supply translated phrases:</p>
<pre class="lang-sh"><code># shellcheck shell=sh disable=SC2016
xmlstarlet select --text -t \
  --var sq -o "'" -b \
  --var dq -o '"' -b \
  --var cmdopt='concat("trans -from ",/_:xliff/@srcLang," -to ",/_:xliff/@trgLang)' \
  -o 'xmlstarlet edit --pf '\\ -n \
  -m '//_:segment[not(_:target)]' \
    --var xpath-a='concat("//_:unit[@id=",$dq,parent::_:unit/@id,$dq,"]/_:segment/_:source")' \
    --var src-e -v 'str:replace(_:source,$sq,concat($sq,"\",$sq,$sq))' -b \
    -o '  -a ' -v 'concat($sq,$xpath-a,$sq)' -o ' -t elem -n target '\\ -n \
    -o "  -u '\$xstar:prev'" -o ' -v "$(' -v 'concat($cmdopt," ",$sq,$src-e,$sq)' -o ')" '\\ -n \
    -o "  -i '\$xstar:prev' -t text -n indent -v '' \\" -n \
    -o "  -u '\$xstar:prev' -x 'preceding-sibling::node()[2][normalize-space()=\"\"]' \\" -n \
    -o '  '\\ -n \
  -b \
  -f -n \
"${infile:-file.xml}"</code></pre>
<ul>
<li><a href="#select-opt-text"><code>--text</code></a> option to generate a shell script</li>
<li><a href="#select-opt-var-equals" title="`select` variables"><code>--var</code></a> to define quote characters and longer substrings as XPath variables</li>
<li><a href="#select-opt-match"><code>-m</code></a> processes <code>segment</code> elements not having a <code>target</code></li>
<li>the <code>src-e</code> variable escapes single quotes in the <code>source</code> text, <a href="https://exslt.github.io/str/functions/replace/index.html"><code>str:replace</code></a> converting <code>'</code> to <code>'\''</code>,<br/>
using <code>--var … -b</code> to avoid <code>select</code>’s <a href="#select-exslt-namespace-issue"><code>--var «name»=«value»</code> namespace issue</a></li>
<li><a href="#select-opt-output"><code>-o</code></a> and <a href="#select-opt-value-of"><code>-v</code></a> generate text quoting correctly for both the shell and XPath, escaping <code>$</code> (dollar sign) inside double quotes to guard against <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06" title="Shell command language at Open Group (POSIX)"><em>shell word expansions</em></a></li>
</ul>
<p>Snippets from sample data file:</p>
<pre class="lang-xml"><code>&lt;source&gt;Über "O'ona"$tra"&lt;/source&gt;</code></pre>
<pre class="lang-xml"><code>&lt;source&gt;&amp;amp;Speichern als &amp;lt;.oona&amp;gt;&lt;/source&gt;</code></pre>
<p>Sample output:</p>
<pre class="lang-sh"><code>xmlstarlet edit --pf \
  -a '//_:unit[@id="2"]/_:segment/_:source' -t elem -n target \
  -u '$xstar:prev' -v "$(trans -from de -to en 'Über "O'\''ona"$tra"')" \
  -i '$xstar:prev' -t text -n indent -v '' \
  -u '$xstar:prev' -x 'preceding-sibling::node()[2][normalize-space()=""]' \
  \
  -a '//_:unit[@id="24"]/_:segment/_:source' -t elem -n target \
  -u '$xstar:prev' -v "$(trans -from de -to en '&amp;Speichern als &lt;.oona&gt;')" \
  -i '$xstar:prev' -t text -n indent -v '' \
  -u '$xstar:prev' -x 'preceding-sibling::node()[2][normalize-space()=""]' \
  \
file.xml</code></pre>
<ul>
<li><a href="#edit-opt-pf"><code>--pf</code></a> preserves original formatting</li>
<li><a href="#edit-opt-append"><code>-a</code></a> appends an empty <code>target</code> element (after <code>source</code>)</li>
<li><code>trans</code> is invoked through <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06_03" title="Shell command language at Open Group (POSIX)"><em>shell command substitution</em></a></li>
<li><a href="#edit-opt-update-value"><code>-u … -v "$(…)"</code></a> adds the translated text to the new <code>target</code> element – this is faster than <a href="#edit-opt-append"><code>-a … -v "$(…)"</code></a> which requires <code>&amp;</code> (ampersand) <a href="#special-characters">encoded</a> as <code>&amp;amp;</code> (i.e. avoids adding <a href="#escape"><code>xmlstarlet escape</code></a> to the pipeline)</li>
<li><a href="#edit-opt-insert"><code>-i …</code></a> and <a href="#edit-opt-update-value"><code>-u … -x …</code></a> indent <code>target</code> to the same column as <code>source</code></li>
<li>the 1st and 2nd <a href="#edit-prev"><code>$xstar:prev</code></a> reference the newly appended <code>target</code> element, the 3rd the indentation text</li>
</ul>
<div class="dinkus3">

</div>
<p>The output can be executed directly as a shell script:</p>
<pre class="lang-sh"><code>xmlstarlet-select-command | sh -s &gt; result.xlf</code></pre>
<p>Snippets from <code>result.xlf</code>:</p>
<pre class="lang-xml"><code>&lt;target&gt;About "O'ona"$tra"&lt;/target&gt;</code></pre>
<pre class="lang-xml"><code>&lt;target&gt;&amp;amp;Save as &amp;lt;.oona&amp;gt;&lt;/target&gt;</code></pre>
<h3 id="select-as-xslt-stylesheet-generator" class="shew-tgt"><code>select</code> as XSLT stylesheet generator<a href="#select-as-xslt-stylesheet-generator" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><a class="relfirst shew-hover" href="#select-as-edit-script-generator"></a><a class="relprev shew-hover" href="#code-generation-edit-examples"></a><a class="relup shew-hover" href="#code-generation"></a><a class="relnext shew-hover" href="#code-generation-xslt-examples"></a><span class="relnop shew-hover"></span></div></h3>
<p>This section is included for completion.</p>
<p><em>Links</em>: <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_02" title="Shell command language at Open Group (POSIX)"><em>shell quoting</em></a> | <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06" title="Shell command language at Open Group (POSIX)"><em>shell word expansions</em></a></p>
<h4 id="spell-it-out" class="shew-tgt">Spell it out<a href="#spell-it-out" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span></div></h4>
<p>To use XSLT or extension elements not supported by <code>xmlstarlet select</code>’s <a href="#select-usage">options</a> it’s possible to have <code>select</code> spell out an XSLT stylesheet. This example inserts one document into another, the first <code>xsl:template</code> is the <em>identity transform</em>.</p>
<pre class="lang-sh"><code>: "${xml1=z1.xml}"  "${xml2=z2.xml}"
test -s "$xml1" || printf '%s\n' '&lt;v&gt;&lt;THERE/&gt;&lt;/v&gt;' &gt; "$xml1"
test -s "$xml2" || printf '%s\n' '&lt;w&gt;&lt;x q="what"&gt;ever&lt;/x&gt;&lt;/w&gt;' &gt; "$xml2"

echo '&lt;v/&gt;' |
xmlstarlet select -t \
  -e xsl:transform  -a version -o 1.0 -b \
    -e xsl:param  -a name -o xdoc -b  -o /dev/null -b \
    -e xsl:template  -a match -o '@*|node()' -b \
      -e xsl:copy \
        -e xsl:apply-templates  -a select -o '@*|node()' -b  -b \
      -b \
    -b \
    -e xsl:template  -a match -o THERE -b \
      -e xsl:copy-of  -a select -o 'document($xdoc,/)' -b  -b \
    -b \
  -b |
xmlstarlet transform --omit-decl /dev/stdin -s xdoc="$xml2" "$xml1"</code></pre>
<p>Output: <code>&lt;v&gt;&lt;w&gt;&lt;x q="what"&gt;ever&lt;/x&gt;&lt;/w&gt;&lt;/v&gt;</code></p>
<p>Notes:</p>
<ul>
<li>the 2nd argument in <code>document($xdoc,/)</code> keeps the XSLT processor from resolving <code>$xdoc</code> relative to the stylesheet’s location and attempting to open the probably nonexisting <code>/dev/z2.xml</code></li>
<li>the last 4 <code>-b (--break)</code>s may be omitted as they’re not followed by any template options</li>
<li><code>$var</code> – unlike <code>${var}</code> – can be an XSLT or a shell variable</li>
</ul>
<p><em>See also</em>: <a href="#select-opt-template"><code>-t (--template)</code></a> | <a href="#select-opt-elem"><code>-e (--elem)</code></a> | <a href="#select-opt-attr"><code>-a (--attr)</code></a> | <a href="#select-opt-output"><code>-o (--output)</code></a> | <a href="#select-opt-break"><code>-b (--break)</code></a> | <a href="#transform"><code>transform</code></a></p>
<p><em>Links</em>: XSLT <a href="https://www.w3.org/TR/1999/REC-xslt-19991116#document" title="W3C XSLT 1.0 recommendation"><code>document()</code></a></p>
<h4 id="next-step-dont-repeat-yourself" class="shew-tgt">Next step: don’t repeat yourself<a href="#next-step-dont-repeat-yourself" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span></div></h4>
<p>Take this one step further and create a library of shorthand shell functions (causing <a href="https://www.shellcheck.net">shellcheck.net</a> a.o. to vociferate):</p>
<pre class="lang-sh"><code>xslxfm()  ## xsl:transform(); non-closed
  printf " -e xsl:transform  -a version -v '1.0' -b "

xsltpl()  ## xsl:template(match name?); non-closed
  printf " -e xsl:template  -a match -v '%s' -b%s" \
    "${1:?usage: template(match name?)}" "${2:+  -a name -v '$2' -b }"

xslapt()  ## xsl:apply-templates(select?); closed
  case $# in
  (0) printf ' -e xsl:apply-templates -b ' ;;
  (1) printf " -e xsl:apply-templates -a select -v '%s' -b -b " "$1" ;;
  (*) printf ' usage: xslapt(select?)\n' 1&gt;&amp;2; false ;;
  esac

xslIDN() { ## xsl:template name=identity; closed
  xsltpl '@*|node()' 'identity'
    printf " -e xsl:copy "
      xslapt '@*|node()'
  printf " -b -b "
}

xslhelp() { ## list xsl* functions in this file
  sed -n -e '/^\(xsl[^ ]*\)()[ {]*## \(.*\)/ s//\1	\2/p' "${_pnself_:-$0}" | 
  expand -t 12
}</code></pre>
<p>Produce the same output as above having <code>select</code>, not <code>transform</code>, include the external document,</p>
<pre class="lang-sh"><code>. "${pathto:-./}xsdefs.sh"
echo '&lt;v/&gt;' |
xmlstarlet sel -I -t $(xslxfm) $(xslIDN) $(xsltpl THERE) -c "document('${xml2}',/)" -b |
xmlstarlet tr --omit-decl /dev/stdin "$xml1"</code></pre>
<p>providing the following stylesheet to the XSLT processor,</p>
<pre class="lang-xsl"><code>&lt;xsl:transform xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"&gt;
  &lt;xsl:template match="@*|node()" name="identity"&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:apply-templates select="@*|node()"/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="THERE"&gt;
    &lt;w&gt;
      &lt;x q="what"&gt;ever&lt;/x&gt;
    &lt;/w&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:transform&gt;</code></pre>
<p>as <code>tee /dev/stderr |</code> inserted in the pipeline will show.</p>
<p><em>Links</em>: The <a href="https://www.w3.org/TR/1999/REC-xslt-19991116.xml">XML version</a> of the XSLT 1.0 Rec contains element syntax and function prototypes</p>
<h3 id="code-generation-xslt-examples" class="shew-tgt">Examples<a href="#code-generation-xslt-examples" class="permalink shew-hover"></a><div class="toolbar shew-hover h3"><a class="relfirst shew-hover" href="#select-as-edit-script-generator"></a><a class="relprev shew-hover" href="#select-as-xslt-stylesheet-generator"></a><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h3>
<h4 id="create-multiple-result-documents" class="shew-tgt">Create multiple result documents<a href="#create-multiple-result-documents" class="permalink shew-hover"></a><div class="toolbar shew-hover h4"><a class="relup shew-hover" href="#code-generation"></a><span class="relnop shew-hover"></span></div></h4>
<p>Use the EXSLT <a href="https://exslt.github.io/exsl/elements/document/index.html"><code>exslt:document</code></a> element as a template to split an XML document into multiple parts and output them as separate files in an existing directory.</p>
<p><span class="caution"><strong>Caution</strong></span>: Leaving out the <code>exslt:nop</code> attribute here triggers an <code>xsl:extension-element-prefix : undefined namespace exslt</code> error, with or without <code>-N exslt='http://exslt.org/common'</code> (<code>exslt</code> is <a href="#exslt">predefined</a>).</p>
<pre class="lang-sh"><code>printf '%s\n' '&lt;v&gt;&lt;x&gt;fee fi&lt;/x&gt;&lt;y&gt;fo fum&lt;/y&gt;&lt;/v&gt;' |
xmlstarlet select -I -t \
  --var part-prefix -o "${outDir:-/tmp/}part" -b \
  -e 'xsl:transform' \
    -a 'version' -o '1.0' -b \
    -a 'exslt:nop' -o '' -b \
    -a 'extension-element-prefixes' -o 'exslt' -b \
    -e 'xsl:template' \
      -a 'match' -o '/' -b \
      -m '*/*' \
        -e 'exslt:document' \
          -a 'href' -v 'concat($part-prefix,format-number(position(),"000"),".xml")' -b \
          -a 'method' -o 'xml' -b \
          -a 'omit-xml-declaration' -o 'yes' -b \
          -e 'part' \
            -a 'no' -v 'position()' -b \
            -a 'of' -v 'last()' -b \
            -c '.' |
{ printf '%s\n' '&lt;v/&gt;' | xmlstarlet transform /dev/fd/3 /dev/stdin ; } 3&lt;&amp;0</code></pre>
<p>Generated XSLT script:</p>
<pre class="lang-xml"><code>&lt;xsl:transform xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:exslt="http://exslt.org/common" version="1.0" exslt:nop="" extension-element-prefixes="exslt"&gt;
  &lt;xsl:template match="/"&gt;
    &lt;exslt:document href="/tmp/part001.xml" method="xml" omit-xml-declaration="yes"&gt;
      &lt;part no="1" of="2"&gt;
        &lt;x&gt;fee fi&lt;/x&gt;
      &lt;/part&gt;
    &lt;/exslt:document&gt;
    &lt;exslt:document href="/tmp/part002.xml" method="xml" omit-xml-declaration="yes"&gt;
      &lt;part no="2" of="2"&gt;
        &lt;y&gt;fo fum&lt;/y&gt;
      &lt;/part&gt;
    &lt;/exslt:document&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:transform&gt;</code></pre>
<p>Generated documents:</p>
<pre class="lang-xml"><code>&lt;part no="1" of="2"&gt;&lt;x&gt;fee fi&lt;/x&gt;&lt;/part&gt;</code></pre>
<pre class="lang-xml"><code>&lt;part no="2" of="2"&gt;&lt;y&gt;fo fum&lt;/y&gt;&lt;/part&gt;</code></pre>
<p><em>See also</em>: <a href="#split-xml-file-by-parentelement">Split XML file</a> example</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-app-a-xslt-extensions">
<h2 id="appendix-a-xmlstarlet-xslt-extensions" class="shew-tgt">Appendix A: <code>xmlstarlet</code> XSLT extensions<a href="#appendix-a-xmlstarlet-xslt-extensions" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#code-generation"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#appendix-b-xmlstarlet-news-summary"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>List of registered extension functions, elements, and modules:</p>
<pre class="lang-text"><code>Registered XSLT Extensions
--------------------------
Registered Extension Functions:
{http://exslt.org/common}node-set
{http://exslt.org/common}object-type
{http://exslt.org/crypto}md4
{http://exslt.org/crypto}md5
{http://exslt.org/crypto}rc4_decrypt
{http://exslt.org/crypto}rc4_encrypt
{http://exslt.org/crypto}sha1
{http://exslt.org/dates-and-times}add
{http://exslt.org/dates-and-times}add-duration
{http://exslt.org/dates-and-times}date
{http://exslt.org/dates-and-times}date-time
{http://exslt.org/dates-and-times}day-abbreviation
{http://exslt.org/dates-and-times}day-in-month
{http://exslt.org/dates-and-times}day-in-week
{http://exslt.org/dates-and-times}day-in-year
{http://exslt.org/dates-and-times}day-name
{http://exslt.org/dates-and-times}day-of-week-in-month
{http://exslt.org/dates-and-times}difference
{http://exslt.org/dates-and-times}duration
{http://exslt.org/dates-and-times}hour-in-day
{http://exslt.org/dates-and-times}leap-year
{http://exslt.org/dates-and-times}minute-in-hour
{http://exslt.org/dates-and-times}month-abbreviation
{http://exslt.org/dates-and-times}month-in-year
{http://exslt.org/dates-and-times}month-name
{http://exslt.org/dates-and-times}second-in-minute
{http://exslt.org/dates-and-times}seconds
{http://exslt.org/dates-and-times}sum
{http://exslt.org/dates-and-times}time
{http://exslt.org/dates-and-times}week-in-month
{http://exslt.org/dates-and-times}week-in-year
{http://exslt.org/dates-and-times}year
{http://exslt.org/dynamic}evaluate
{http://exslt.org/dynamic}map
{http://exslt.org/math}abs
{http://exslt.org/math}acos
{http://exslt.org/math}asin
{http://exslt.org/math}atan
{http://exslt.org/math}atan2
{http://exslt.org/math}constant
{http://exslt.org/math}cos
{http://exslt.org/math}exp
{http://exslt.org/math}highest
{http://exslt.org/math}log
{http://exslt.org/math}lowest
{http://exslt.org/math}max
{http://exslt.org/math}min
{http://exslt.org/math}power
{http://exslt.org/math}random
{http://exslt.org/math}sin
{http://exslt.org/math}sqrt
{http://exslt.org/math}tan
{http://exslt.org/sets}difference
{http://exslt.org/sets}distinct
{http://exslt.org/sets}has-same-node
{http://exslt.org/sets}intersection
{http://exslt.org/sets}leading
{http://exslt.org/sets}trailing
{http://exslt.org/strings}align
{http://exslt.org/strings}concat
{http://exslt.org/strings}decode-uri
{http://exslt.org/strings}encode-uri
{http://exslt.org/strings}padding
{http://exslt.org/strings}replace
{http://exslt.org/strings}split
{http://exslt.org/strings}tokenize
{http://icl.com/saxon}eval
{http://icl.com/saxon}evaluate
{http://icl.com/saxon}expression
{http://icl.com/saxon}line-number
{http://icl.com/saxon}systemId
{http://xmlsoft.org/XSLT/}test

Registered Extension Elements:
{http://exslt.org/common}document
{http://exslt.org/functions}result
{http://xmlsoft.org/XSLT/}test

Registered Extension Modules:
http://exslt.org/functions
http://icl.com/saxon
http://xmlsoft.org/XSLT/</code></pre>
<p>… as output by:</p>
<pre class="lang-text"><code>xmlstarlet transform --show-ext 2&gt;&amp;1 |
awk -F '\n' -v S='sort' '/^Registered|^-*$/{ close(S); print; next } { print | S }'</code></pre>
<p><span class="caution"><strong>Caution</strong></span>: Missing from above list is the EXSLT extension element <code>{http://exslt.org/functions}function</code> (aka <code>func:function</code>) which works as <a href="https://exslt.github.io/func/elements/function/index.html">documented</a> in <code>libexslt</code> despite<code>element-available("func:function")</code> returning <code>false</code>.</p>
<div class="dinkus1">

</div>
</section>
<section id="sec-app-b-news-summary">
<h2 id="appendix-b-xmlstarlet-news-summary" class="shew-tgt">Appendix B: <code>xmlstarlet</code> news summary<a href="#appendix-b-xmlstarlet-news-summary" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#appendix-a-xmlstarlet-xslt-extensions"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#appendix-c-xmlstarlet-wishlist-ad-2003"></a><a class="rellast shew-hover" href="#toc"></a></div></h2>
<p>Snipped from SourceForge <a href="https://sourceforge.net/p/xmlstar/news/">news</a> and <a href="https://sourceforge.net/projects/xmlstar/files/xmlstarlet/">files</a> sections. Covers versions 1.0.3 through 1.6.1 (in reverse order).</p>
<pre class="lang-text"><code>
XMLStarlet 1.6.1 Released

1.6.1: August 9, 2014

- handle unicode arguments under Windows

There is no difference for non-Windows platforms.
Posted by Noam Postavsky 2014-08-09


XMLStarlet 1.6.0 Released

Changes:

    get rid of "helpful" message about namespaces
    update user guide
    Enhancements:
        add --stop option to val
        add global option --no-doc-namespace
    Build:
        let the make install target succeed even if docs aren't built.

Posted by Noam Postavsky 2014-06-13


XMLStarlet 1.5.0 is released, changes:

    Bugs:
        avoid segfault on pyx non-existant file
        fix unescaping of entities straddling 4K byte boundary (Bug #102)
    Enhancements:
        unescape hex entities (&amp;#xXX;)
        give a helpful message if doc has default namespace and nothing matched
        add "_" and "DEFAULT" as names for document's top-level default namespace
        Adding a global quiet option
        ed: Allow omitting value argument to create empty element.
        use default attribute values in sel subcommand
    Build:
        fix test variables to work with newer automake (1.11 -&gt; 1.13)
        fix usage2c.awk for mawk
        scripts for building on mingw

Posted by Noam Postavsky 2013-07-07 


1.4.2: Dec 28, 2012

    - pyx: avoid segfault on documents with multiple attributes (Bug 
      #3595212)


1.4.1: Dec 8, 2012

    - avoid segfault when attempting to edit the document node (Bug
      #3575722)

    - Packaging:
      - include doc/xmlstar-fodoc-style.xsl in the dist so that the
        --enable-build-docs option works from the tarball (Bug
        #3580667)
      - AC_SUBST PACKAGE_TARNAME for automake so that documentation is
        installed to the right place (Bug #3561958)

    - Test Suite:
      - avoid test failures due to XML formatting and whitespace
        changes (also fixes Bug #3572789)
      - use automake's parallel test suite
      - make bigxml tests much faster by using whitespace instead of nodes
      - don't test str:replace() with ed: it doesn't work outside of
        xslt in new libxslt
      - ignore extra errors from libxml 2.9.0 bug
      - let tests run using busybox
      - add runAllTests.sh to run tests without make


1.4.0: Aug 26, 2012

    - Documentation:
        - executable name used in documentation now matches
          --transform-program-name (Bug #3283713)
        - added Makefile rules for generating documentation
          (./configure --enable-build-docs)

    - ed subcommand:
        - relative XPaths are now handled correctly (Bug #3527850)
        - the last nodeset inserted by an edit operation can be
          accessed as the XPath variable $prev (or $xstar:prev)
        - add --var option to define XPath variables
        - allow ed -u -x to insert nodesets instead of converting to
          string
        - remove hard limit for number of edit operations (Bug
          #3488240)

    - pyx now handles namespaces correctly


1.3.1: Jan 14, 2012

    - handle multiple values for --value-of properly (Bug #2563866)
    - substitute external entities (Bug #3467320)
    - pyx output needs space between attribute name and value (Bug #3440797)


1.3.0: Oct 7, 2011

    - avoid ASCII CRs in UTF-16/32 text (reported by Ming Chen)
    - --value-of outputs concat values of all nodes (Req #2563866)
    - encode special chars for ed -u -x
    - allow use of exslt functions in ed -u -x
    - add --var to select (allow --var &lt;name&gt;=&lt;value&gt; as well as --var
      &lt;name&gt; &lt;value&gt; --break)
    - work around libxml bug that passes bogus data to error handler
      (Bug #3362217)

Source: README.1.3.0, updated 2011-10-02 


1.2.1: July 07, 2011

    - check for NULL nodeset result (Bugs #3323189, #3323196)
    - "-" was being confused with --elif
    - generated XSLT should also have automatic namespaces
    - allow -N after other option (Bug #3325166)
    - namespace values were being registered as prefixes
    - avoid segfault when asked to move namespace nodes
    - missing newline in ed --help message
    - test scripts portability
      - no bashisms allowed in NetBSD sh
      - make BRE portable: '+' is not allowed
      - deal with msys path conversion properly (Bug #3178657)
    - don't use XML_SAVE_WSNONSIG #if libxml &lt; 2.7.8 (Bug #3310475)

Source: README.1.2.1, updated 2011-07-07


1.2.0: June 1, 2011

    - implement ed --update --expr
    - use top-level namespace definitions from first input file, this
      should remove the need to define namespaces on the command line
      with -N in most cases.
    - select exits with 0 only if result is non-empty (Req #3155702)
    - add -Q to select, like grep's -q
    - add column number to error messages
    - restore input context (lost in version 1.0.3) to error messages
      (Bug #3305659)
    - print extra string information in error messages
    - use entity definitions from dtd (Bug #3305659)
    - add --net option to c14n, ed, fo, and val (Req #1071398)
    - remove --catalog from tr --help message since it isn't actually supported
    - add --elif and --else to sel --help message

Source: README.1.2.0, updated 2011-06-01 


1.1.0: Apr 3, 2011

    - bug fix for BSD/OSX: check that O_BINARY is declared before
      #including io.h (Bug 3211822)
    - select improvements
      - add --elif and --else options
      - sorting on multiple fields
      - correct (for English) lexical sorting instead of ASCIIbetical
      - only outputs namespaces that are actually used
      - only outputs xsl:param inputFile if it's used
      - don't make separate templates if there is only 1
    - link to shared libxml and libxslt libraries by default
    - add library version info to --version output
    - add directory argument for ls; exit status indicates
      failure/success instead of file count
    - stop using old SAX1 interface, xmlstarlet will now link with a
      libxml configured --without-sax1 and --without-legacy

Source: README.1.1.0, updated 2011-04-04 


1.0.6: Mar 13 2011:

    - Bug fixes:
       - c14n: set stdout to binary mode on Windows to avoid carriage
         returns (Bug 840665)
       - fix broken --help options
    - put actual behaviour of -P, -S options in --help output (see
      Bug/Feature Request 2858514)
    - remove unneeded escape of quote in ./configure --help
    - don't distribute xmlstarlet.spec: it's generated by ./configure
    - add src/xml.o depends on version.h to Makefile.am so compile
      will succeed without dependency info (eg after make distclean)
    - add test for subcommands' --help option
    - Portability fixes:
       - yes isn't portable, use an awk program instead
       - neither read -r nor xargs -0 are portable, escape the command
         lines to xargs instead
       - don't use nonportable echo -n option

Source: README.1.0.6, updated 2011-03-13 


1.0.5: Feb 11 2011:

   - Bug fixes:
      - use XSLT_PARSE_OPTIONS, else CDATA nodes can cause corruption (Bug 3158482)
      - fix typo in help message
      - get rid of warnings in -ansi -pedantic mode
      - required libxml2 version is 2.6.23
      - usage strings use argv[0] as program name
      - --help prints to stdout and exits with success
      - double /'s under msys to avoid path conversion
   - Portability fixes:
      - don't use xargs (-d isn't portable)
      - use -Wall only for gcc
   -Build system:
      - use -ansi in configure, and check for strdup declaration
      - seperate list of sources and tests into subdirs
      - check git version during make, not just autoconf
      - tarball releases of configure.ac have actual version number
        instead of querying git

Source: README.1.0.5, updated 2011-02-11 


1.0.4: Jan 16 2011:

   - Bug fixes:
      - encode special XML characters in arguments (can now include quotes in xpath)
      - non-zero exit code when input file is not found (Bug 3158488)
      - ed with --pf/--ps options doesn't reformat output (Bug 3158490)
      - exit() instead of segfault when trying to delete namespace nodes
         (Bug 1120417)
   - added --disable-static-libs ./configure option to use shared libxml2 and libxslt
   - non-recursive make
   - use TESTS and XFAIL_TESTS for testing, nicer output

Source: README, updated 2011-01-16 


1.0.3: Nov 18 2010:

   - Bug fixes:
      escape --value in update mode (Bug 3052978)
      c14n now includes default attributes (Bug 1505579)
      Allow special characters in sel --output literal (Bug 1912978)
      remove warning from xml_trans.c (Bug 1521756)
      Use xmlReader interface so line numbers are 32-bit (Bug 1219072)
      test for error messages on lines past 2^16 (Bug 1219072)
      don't look for embedded dtd if not asked (Bug 1167215)

Source: README, updated 2010-11-18 
</code></pre>
<div class="dinkus1">

</div>
</section>
<section id="sec-app-c-wishlist-ad-2003">
<h2 id="appendix-c-xmlstarlet-wishlist-ad-2003" class="shew-tgt">Appendix C: <code>xmlstarlet</code> wishlist AD 2003<a href="#appendix-c-xmlstarlet-wishlist-ad-2003" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#appendix-b-xmlstarlet-news-summary"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><a class="relnext shew-hover" href="#toc"></a><span class="relnop shew-hover"></span></div></h2>
<p>In 2003 Mikhail Grushinskiy <a href="https://sourceforge.net/p/xmlstar/discussion/226077/thread/edede62a/">posted</a> his <code>xmlstarlet</code> wishlist.</p>
<pre class="lang-text"><code>Mikhail Grushinskiy - 2003-05-14

Here is a list of next steps in XmlStarlet on TODO or wishlist:

1. Editing xml documents with xml 'ed' option must be improved.

2. add --recover to fix broken XML documents

3. Document how to use proxy in XmlStarlet with nanohttp/ftp via http_proxy, ftp_proxy environment variables
ex: export http_proxy=http://192.168.0.1:8080/

4. Add ability to specify xpath expression in XmlStarlet 'el' option

5. -u option of XmlStarlet 'xml el' should work with others too. I.e. sort | uniq equivalent should work when attributes and attributes values are printed out.

6. Think about 'join' analogue

7.  Something like xml sel -t -m &lt;xpath&gt; --exec &lt;shell-cmd&gt; --args &lt;args&gt; is needed

8. How would be possible to insert one XML fragment into another XML document from command line without XInclude?

9. Make use of regular expressions ex: Make all element names uppercase

10. Start thinking about diff and patch. Several tree diff algorithms could be implemented for ordered and non ordered labeled trees. What about creating context diff? How to define context in XML space? Good luck solving NP-Complete problems.

11. What about XUpdate implementation?

12. How about making output with syntax coloring in case if it is running in terminal (not batch) mode. Similar to GNU ls?

13. Convert XML to Lisp S-expressions

14. XML Namespace normalization process (There is a XSLT stylesheet floating on the web which could do it).

15. Make use of performance updates from libxml2. mmap() for document chunks, XMLReader interface, etc.

16. More regression testing test cases required.

17. Better Documentation User Guide and Tutorial is needed. More good and real-world examples.

If you wish to enhance/add something to this list, please, reply.

XmlStarlet home page,
http://xmlstar.sourceforge.net/

Thanks,
--MG
 

    Mikhail Grushinskiy
    Mikhail Grushinskiy - 2003-05-23

    Few additions

    1. Better namespace support.
    2. something like xml head, and xml tail
    3. list directories in XML
    4. Defining variables in xml sel

    Ex: xml sel -t --m / -d var_name -v @elem

    -d would translate into

    &lt;xsl:variable name="var_name"&gt;
    &lt;/xml:variable&gt;

    and this variable could be referenced as $var_name
    in XPATH

    5. CygWin binaries?</code></pre>
<div class="dinkus1">

</div>
</section>
<section id="sec-toc">
<h2 id="toc" class="shew-tgt">Table of contents<a href="#toc" class="permalink shew-hover"></a><div class="toolbar shew-hover h2"><a class="relfirst shew-hover" href="#introduction"></a><a class="relprev shew-hover" href="#appendix-c-xmlstarlet-wishlist-ad-2003"></a><a class="relup shew-hover" href="#xmlstarlet-usage-notes"></a><span class="relnop shew-hover"></span><span class="relnop shew-hover"></span></div></h2>
<ul class="level1">
<li class="level1"><a href="#xmlstarlet-usage-notes"><code>xmlstarlet</code> usage notes</a>
<ul class="level2">
<li id="in-toc-introduction" class="level2"><a href="#introduction">Introduction</a>
<ul class="level3">
<li class="level3"><a href="#xmlstarlet-features"><code>xmlstarlet</code> features</a></li>
<li class="level3"><a href="#notation-used-in-this-document">Notation used in this document</a></li>
<li class="level3"><a href="#a-word-about-stylesheet-syntax">A word about stylesheet syntax</a></li>
</ul></li>
<li id="in-toc-documentation" class="level2"><a href="#documentation">Documentation</a>
<ul class="level3">
<li class="level3"><a href="#users-guide-examples-source-code-forums">User’s guide, examples, source code, forums</a></li>
<li class="level3"><a href="#selected-resources">Selected resources</a></li>
<li class="level3"><a href="#list-the-generated-xslt-xmlstarlet-select--c">List the generated XSLT: <code>xmlstarlet select -C</code></a></li>
</ul></li>
<li id="in-toc-xmlstarlet-commands" class="level2"><a href="#xmlstarlet-commands"><code>xmlstarlet</code> commands</a>
<ul class="level3">
<li class="level3"><a href="#general-notes">General notes</a>
<ul class="level4">
<li class="level4"><a href="#special-characters">Special characters</a></li>
<li class="level4"><a href="#xml-declaration">XML declaration</a></li>
<li class="level4"><a href="#xml-parsing-and-serialization">XML parsing and serialization</a></li>
<li class="level4"><a href="#xml-external-entities">XML external entities</a></li>
<li class="level4"><a href="#exit-values">Exit values</a></li>
<li class="level4"><a href="#numeric-representation">Numeric representation</a></li>
<li class="level4"><a href="#one-lining">One-lining</a></li>
<li class="level4"><a href="#makefile-notes-gnu-make"><code>makefile</code> notes (GNU Make)</a></li>
</ul></li>
<li class="level3"><a href="#global-options">Global options and parameters</a>
<ul class="level4">
<li class="level4"><a href="#global-opt-help"><code>--help</code></a></li>
<li class="level4"><a href="#global-opt-version"><code>--version</code></a></li>
<li class="level4"><a href="#global-opt-quiet"><code>-q (--quiet)</code>: suppress error output</a></li>
<li class="level4"><a href="#global-opt-no-doc-namespace"><code>--no-doc-namespace</code>: don’t use namespace bindings from input’s root element</a></li>
<li class="level4"><a href="#global-opt-doc-namespace"><code>--doc-namespace</code>: extract namespace bindings from input’s root element (<em>default</em>)</a></li>
<li class="level4"><a href="#global-opt-net">Network access (<code>--net</code>)</a></li>
<li class="level4"><a href="#global-param-uri"><code>uri</code> replacing input file</a></li>
</ul></li>
</ul></li>
<li id="in-toc-elements" class="level2"><a href="#elements">Display structure: <code>xmlstarlet elements</code></a>
<ul class="level3">
<li class="level3"><a href="#elements-usage">Usage: <code>elments [option] [«xml-file»]</code></a></li>
<li class="level3"><a href="#elements-local-options">Local options</a>
<ul class="level4">
<li class="level4"><a href="#elements-opt-a"><code>-a</code> - include attributes</a></li>
<li class="level4"><a href="#elements-opt-v"><code>-v</code> - include attribute values</a></li>
<li class="level4"><a href="#elements-opt-u"><code>-u</code> - sorted unique lines</a></li>
<li class="level4"><a href="#elements-opt-d"><code>-dN</code> - sorted unique lines to depth N</a></li>
</ul></li>
<li class="level3"><a href="#elements-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#elements-sample-session">Sample session</a></li>
</ul></li>
</ul></li>
<li id="in-toc-select" class="level2"><a href="#select">Query: <code>xmlstarlet select</code></a>
<ul class="level3">
<li class="level3"><a href="#select-usage">Usage: <code>select</code> [option …] template … [«xml-file» …]</a></li>
<li class="level3"><a href="#select-non-template-options">Non-template options</a>
<ul class="level4">
<li class="level4"><a href="#select-opt-help"><code>-h (--help)</code> - display help</a></li>
<li class="level4"><a href="#select-opt-quiet"><code>-Q (--quiet)</code> - do not write anything to standard output</a></li>
<li class="level4"><a href="#select-opt-comp"><code>-C (--comp)</code> - display generated XSLT</a></li>
<li class="level4"><a href="#select-opt-root"><code>-R (--root)</code> - print root element <code>&lt;xsl-select&gt;</code></a></li>
<li class="level4"><a href="#select-opt-text"><code>-T (--text)</code> - output is text (default is XML)</a></li>
<li class="level4"><a href="#select-opt-indent"><code>-I (--indent)</code> - indent output</a></li>
<li class="level4"><a href="#select-opt-xml-decl"><code>-D (--xml-decl)</code> - do not omit XML declaration line</a></li>
<li class="level4"><a href="#select-opt-noblanks"><code>-B (--noblanks)</code> - remove nonsignificant whitespace from XML tree</a></li>
<li class="level4"><a href="#select-opt-encode"><code>-E (--encode) «encoding»</code> - output in the given encoding</a></li>
<li class="level4"><a href="#select-opt-n"><code>-N «prefix»=«value»</code> - declare namespaces</a></li>
<li class="level4"><a href="#select-opt-net"><code>--net</code> - allow fetch DTDs or entities over network</a></li>
</ul></li>
<li class="level3"><a href="#select-template-options">Template options</a>
<ul class="level4">
<li class="level4"><a href="#select-opt-template"><code>-t (--template)</code> is <code>&lt;xsl:template match="/"&gt;</code></a></li>
<li class="level4"><a href="#select-opt-match"><code>-m (--match)</code> is <code>&lt;xsl:for-each select="xpath-expr"&gt;</code></a></li>
<li class="level4"><a href="#select-opt-sort"><code>-s (--sort)</code> is <code>&lt;xsl:sort …/&gt;</code></a></li>
<li class="level4"><a href="#select-opt-var-break"><code>--var «name» «value» --break</code> is <code>&lt;xsl:variable name="…"&gt;«value»&lt;/xsl:variable</code>&gt;</a></li>
<li class="level4"><a href="#select-opt-var-equals"><code>--var «name»=«value»</code> is <code>&lt;xsl:variable name="…"/&gt;</code></a></li>
<li class="level4"><a href="#select-exslt-namespace-issue"><code>--var «name»=«value»</code> namespace issue</a></li>
<li class="level4"><a href="#select-opt-output"><code>-o (--output)</code> is <code>&lt;xsl:text&gt;«value»&lt;/xsl:text&gt;</code></a></li>
<li class="level4"><a href="#select-opt-elem"><code>-e (--elem)</code> is <code>&lt;xsl:element name="…"&gt;</code></a></li>
<li class="level4"><a href="#select-opt-attr"><code>-a (--attr)</code> is <code>&lt;xsl:attribute name="…"&gt;</code></a></li>
<li class="level4"><a href="#select-opt-copy-of"><code>-c (--copy-of)</code> is <code>&lt;xsl:copy-of select="xpath-expr"/&gt;</code></a></li>
<li class="level4"><a href="#select-opt-value-of"><code>-v (--value-of)</code> is <code>string-join((xpath-expr),newline)</code></a></li>
<li class="level4"><a href="#select-opt-if"><code>-i (--if) [--elif …] [--else]</code> is <code>&lt;xsl:when&gt; … [&lt;xsl:otherwise&gt;]</code></a></li>
<li class="level4"><a href="#select-opt-break"><code>-b (--break)</code> ends current container element</a></li>
<li class="level4"><a href="#select-opt-nl"><code>-n (--nl)</code> prints a newline</a></li>
<li class="level4"><a href="#select-opt-inp-name"><code>-f (--inp-name)</code> prints pathname / URI of current input</a></li>
</ul></li>
<li class="level3"><a href="#select-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#query-euro-rates">Query Euro rates</a></li>
<li class="level4"><a href="#list-xml-files-matching-xpath-expression">List XML files matching XPath expression</a></li>
<li class="level4"><a href="#print-xpath-of-selected-elements-or-attributes">Print XPath of selected elements or attributes</a></li>
<li class="level4"><a href="#mark-up-plaintext">Mark up plaintext</a></li>
<li class="level4"><a href="#use-the-document-function">Use the <code>document()</code> function</a></li>
<li class="level4"><a href="#extract-subtree-to-depth-n-removing-namespaces">Extract subtree to depth N removing namespaces</a></li>
</ul></li>
</ul></li>
<li id="in-toc-edit" class="level2"><a href="#edit">Edit: <code>xmlstarlet edit</code></a>
<ul class="level3">
<li class="level3"><a href="#edit-usage">Usage: <code>edit</code> option […] [action …] [«xml-file-or-uri» …]</a></li>
<li class="level3"><a href="#edit-non-action-options">Non-action options</a>
<ul class="level4">
<li class="level4"><a href="#edit-opt-help"><code>-h (--help)</code> - display help</a></li>
<li class="level4"><a href="#edit-opt-omit-decl"><code>-O (--omit-decl)</code> - omit XML declaration</a></li>
<li class="level4"><a href="#edit-opt-pf"><code>-P (--pf)</code> - preserve original formatting</a></li>
<li class="level4"><a href="#edit-opt-ps"><code>-S (--ps)</code> - preserve non-significant spaces</a></li>
<li class="level4"><a href="#edit-opt-inplace"><code>-L (--inplace)</code> - edit input file(s) in-place</a></li>
<li class="level4"><a href="#edit-opt-net"><code>--net</code> - allow network access</a></li>
<li class="level4"><a href="#edit-opt-n"><code>-N «prefix»=«value»</code> - declare namespaces</a></li>
</ul></li>
<li class="level3"><a href="#edit-action-options">Action options</a>
<ul class="level4">
<li class="level4"><a href="#edit-opt-insert"><code>-i (--insert)</code> - add node before</a></li>
<li class="level4"><a href="#edit-opt-append"><code>-a (--append)</code> - add node after</a></li>
<li class="level4"><a href="#edit-opt-subnode"><code>-s (--subnode)</code> - add node as child</a></li>
<li class="level4"><a href="#edit-prev">Back reference <code>$prev</code> variable (aka <code>$xstar:prev</code>)</a></li>
<li class="level4"><a href="#edit-opt-var"><code>--var name 'xpath'</code></a></li>
<li class="level4"><a href="#edit-opt-update-value"><code>-u (--update) 'xpath' -v (--value) 'value'</code></a></li>
<li class="level4"><a href="#edit-opt-update-expr"><code>-u (--update) 'xpath' -x (--expr) 'xpath'</code></a></li>
<li class="level4"><a href="#edit-opt-delete"><code>-d (--delete) 'xpath'</code></a></li>
<li class="level4"><a href="#edit-opt-rename"><code>-r (--rename) 'xpath' -v (--value) 'new-name'</code></a></li>
<li class="level4"><a href="#edit-opt-move"><code>-m (--move) 'xpath1' 'xpath2'</code></a></li>
<li class="level4"><a href="#edit-xpath-arguments"><code>xpath</code> arguments</a></li>
<li class="level4"><a href="#edit-exslt-in-xpath-arguments">EXSLT in <code>xpath</code> arguments</a></li>
<li class="level4"><a href="#no-kidding-issue">“No kidding” issue</a></li>
</ul></li>
<li class="level3"><a href="#edit-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#insert-html-link">Insert HTML <code>&lt;link …/&gt;</code></a></li>
<li class="level4"><a href="#toggle-01-or-falsetrue">Toggle 0/1 or false/true</a></li>
<li class="level4"><a href="#replace-text">Replace text</a></li>
<li class="level4"><a href="#update-or-add-if-not-exists">Update or add if not exists</a></li>
<li class="level4"><a href="#add-if-condition">Add if «condition»</a></li>
<li class="level4"><a href="#duplicate-an-element-keep-the-formatting">Duplicate an element, keep the formatting</a></li>
<li class="level4"><a href="#edit-moving-nodes">Moving nodes using <code>xmlstarlet edit -m or -a, -u, -r, -d</code></a></li>
<li class="level4"><a href="#divide-a-document-into-sections">Divide a document into sections</a></li>
<li class="level4"><a href="#try-out-xmlstarlet-edits-formatting-options">Try out <code>xmlstarlet edit</code>’s formatting options</a></li>
</ul></li>
</ul></li>
<li id="in-toc-format" class="level2"><a href="#format">Format: <code>xmlstarlet format</code></a>
<ul class="level3">
<li class="level3"><a href="#format-usage">Usage: <code>format</code> [option …] [«xml-file»]</a></li>
<li class="level3"><a href="#format-local-options">Local options</a>
<ul class="level4">
<li class="level4"><a href="#format-opt-help"><code>-h (--help)</code> - display help</a></li>
<li class="level4"><a href="#format-opt-encode"><code>-e (--encode) «encoding»</code> - output in the given encoding</a></li>
<li class="level4"><a href="#format-opt-noindent"><code>-n (--noindent)</code> - do not indent</a></li>
<li class="level4"><a href="#format-opt-omit-decl"><code>-o (--omit-decl)</code> - omit XML declaration</a></li>
<li class="level4"><a href="#format-opt-indent-spaces"><code>-s (--indent-spaces) «N»</code> - indent output with N spaces</a></li>
<li class="level4"><a href="#format-opt-indent-tab"><code>-t (--indent-tab)</code> - indent output with tabulation</a></li>
<li class="level4"><a href="#format-opt-nocdata"><code>-C (--nocdata)</code> - replace CDATA section with text nodes</a></li>
<li class="level4"><a href="#format-opt-dropdtd"><code>-D (--dropdtd)</code> - remove the DOCTYPE of the input doc</a></li>
<li class="level4"><a href="#format-opt-html"><code>-H (--html)</code> - input is HTML</a></li>
<li class="level4"><a href="#format-opt-nsclean"><code>-N (--nsclean)</code> - remove redundant namespace declarations</a></li>
<li class="level4"><a href="#format-opt-quiet"><code>-Q (--quiet)</code> [undocumented] - suppress error output</a></li>
<li class="level4"><a href="#format-opt-recover"><code>-R (--recover)</code> - try to recover what is parsable</a></li>
<li class="level4"><a href="#format-opt-net"><code>--net</code> - allow network access</a></li>
</ul></li>
</ul></li>
<li id="in-toc-c14n" class="level2"><a href="#c14n">Compare: <code>xmlstarlet c14n</code></a>
<ul class="level3">
<li class="level3"><a href="#c14n-usage">Usage: <code>c14n [option] [«mode»] «xml-file» [«xpath-file»] [«inclusive-ns-list»]</code></a></li>
<li class="level3"><a href="#c14n-local-options">Local options</a>
<ul class="level4">
<li class="level4"><a href="#c14n-opt-help"><code>-h (--help)</code> - display help</a></li>
<li class="level4"><a href="#c14n-opt-net"><code>--net</code> - allow network access</a></li>
</ul></li>
<li class="level3"><a href="#c14n-parameters">Parameters</a>
<ul class="level4">
<li class="level4"><a href="#c14n-param-mode"><code>«mode»</code> - canonicalization mode</a></li>
<li class="level4"><a href="#c14n-param-xml-file"><code>«xml-file»</code> - input XML document file name (stdin is used if <code>-</code>)</a></li>
<li class="level4"><a href="#c14n-xpath-file"><code>«xpath-file»</code> - XML file with <em>document subset</em> expression</a></li>
<li class="level4"><a href="#c14n-param-inclusive-ns-list">«inclusive-ns-list» - list of inclusive namespace prefixes</a></li>
</ul></li>
</ul></li>
<li id="in-toc-validate" class="level2"><a href="#validate">Validate: <code>xmlstarlet validate</code></a>
<ul class="level3">
<li class="level3"><a href="#validate-usage">Usage: <code>validate</code> [option …] [«xml-file-or-uri» …]</a></li>
<li class="level3"><a href="#validate-local-options">Local options</a>
<ul class="level4">
<li class="level4"><a href="#validate-opt-well-formed"><code>-w (--well-formed)</code> - validate well-formedness only (<em>default</em>)</a></li>
<li class="level4"><a href="#validate-opt-dtd"><code>-d (--dtd) «dtd-file»</code> - validate against DTD</a></li>
<li class="level4"><a href="#validate-opt-net"><code>--net</code> - allow network access</a></li>
<li class="level4"><a href="#validate-opt-xsd"><code>-s (--xsd) «xsd-file»</code> - validate against XSD schema</a></li>
<li class="level4"><a href="#validate-opt-embed"><code>-E (--embed)</code> - validate using embedded DTD</a></li>
<li class="level4"><a href="#validate-opt-relaxng"><code>-r (--relaxng) «rng-file»</code> - validate against Relax-NG schema</a></li>
<li class="level4"><a href="#validate-opt-err"><code>-e (--err)</code> - print verbose error messages on stderr</a></li>
<li class="level4"><a href="#validate-opt-stop"><code>-S (--stop)</code> - stop on first error</a></li>
<li class="level4"><a href="#validate-opt-list-bad"><code>-b (--list-bad)</code> - list only files which do not validate</a></li>
<li class="level4"><a href="#validate-opt-list-good"><code>-g (--list-good)</code> - list only files which validate</a></li>
<li class="level4"><a href="#validate-opt-quiet"><code>-q (--quiet)</code> - do not list files (return result code only)</a></li>
</ul></li>
</ul></li>
<li id="in-toc-pyx" class="level2"><a href="#pyx">PYX: <code>xmlstarlet pyx</code>, <code>depyx</code></a>
<ul class="level3">
<li class="level3"><a href="#pyx-usage">Usage: <code>pyx</code> [–help] [«xml-file»]</a></li>
<li class="level3"><a href="#depyx-usage">Usage: <code>depyx</code> [–help] [«pyx-file»]</a></li>
<li class="level3"><a href="#pyx-output-sample">PYX output sample</a></li>
<li class="level3"><a href="#pyx-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#grep-for-dvorak-in-tags-text">Grep for <code>Dvorak</code> in tags’ text</a></li>
<li class="level4"><a href="#extract-uris">Extract URIs</a></li>
<li class="level4"><a href="#convert-date-attributes-to-extended-iso-8601-format">Convert <code>date</code> attributes to extended ISO 8601 format</a></li>
<li class="level4"><a href="#convert-datetime-elements-from-basic-to-extended-iso-8601-format">Convert <code>datetime</code> elements from basic to extended ISO 8601 format</a></li>
<li class="level4"><a href="#delete-foo-elements">Delete <code>foo</code> elements</a></li>
<li class="level4"><a href="#split-xml-file-by-parentelement">Split XML file by <code>parent/element</code></a></li>
</ul></li>
</ul></li>
<li id="in-toc-escape" class="level2"><a href="#escape">Special characters: <code>xmlstarlet escape</code>, <code>unescape</code></a>
<ul class="level3">
<li class="level3"><a href="#escape-usage">Usage: <code>escape</code> [–help] [«text»]</a></li>
<li class="level3"><a href="#unescape-usage">Usage: <code>unescape</code> [–help] [«text»]</a></li>
<li class="level3"><a href="#escape-sample-session">Sample session</a></li>
</ul></li>
<li id="in-toc-list" class="level2"><a href="#list">Directory list: <code>xmlstarlet list</code></a>
<ul class="level3">
<li class="level3"><a href="#list-usage">Usage: <code>list</code> [«directory-name»]</a></li>
<li class="level3"><a href="#list-output-sample">Output sample</a></li>
</ul></li>
<li id="in-toc-transform" class="level2"><a href="#transform">The T in XSLT: <code>xmlstarlet transform</code></a>
<ul class="level3">
<li class="level3"><a href="#transform-usage">Usage: <code>transform [option …] «xsl-file» [-p|-s «name»=«value» …] [«xml-file-or-uri» …]</code></a></li>
<li class="level3"><a href="#transform-local-options">Local options</a>
<ul class="level4">
<li class="level4"><a href="#transform-opt-help"><code>-h (--help)</code> - display help</a></li>
<li class="level4"><a href="#transform-opt-omit-decl"><code>--omit-decl</code> - omit XML declaration</a></li>
<li class="level4"><a href="#transform-opt-embed"><code>-E (--embed)</code> - allow applying embedded stylesheet</a></li>
<li class="level4"><a href="#transform-opt-show-ext"><code>--show-ext</code> - show list of extensions</a></li>
<li class="level4"><a href="#transform-opt-val"><code>--val</code> - allow validate against DTDs or schemas</a></li>
<li class="level4"><a href="#transform-opt-net"><code>--net</code> - allow fetch DTDs or entities over network</a></li>
<li class="level4"><a href="#transform-opt-xinclude"><code>--xinclude</code> - do XInclude processing on document input</a></li>
<li class="level4"><a href="#transform-opt-maxdepth"><code>--maxdepth value</code> - increase the maximum depth</a></li>
<li class="level4"><a href="#transform-opt-html"><code>--html</code> - input document(s) are in HTML format</a></li>
</ul></li>
<li class="level3"><a href="#transform-parameters">Parameters</a>
<ul class="level4">
<li class="level4"><a href="#transform-param-xsl-file"><code>«xsl-file»</code> - main XSLT stylesheet for transformation</a></li>
<li class="level4"><a href="#transform-param-p"><code>-p</code> - parameter is an XPath expression</a></li>
<li class="level4"><a href="#transform-param-s"><code>-s</code> - parameter is a string literal</a></li>
<li class="level4"><a href="#transform-param-name-equals-value"><code>«name»=«value»</code> - name and value of the parameter passed to XSLT processor</a></li>
<li class="level4"><a href="#transform-param-xml-file"><code>«xml-file»</code> - input XML document file name (<code>stdin</code> is used if missing)</a></li>
</ul></li>
</ul></li>
<li id="in-toc-namespaces" class="level2"><a href="#namespaces">Namespaces</a>
<ul class="level3">
<li class="level3"><a href="#namespaces-topics">Topics</a>
<ul class="level4">
<li class="level4"><a href="#namespaces-use">Use a namespace</a></li>
<li class="level4"><a href="#namespaces-create">Create a namespace</a></li>
<li class="level4"><a href="#namespaces-move">Move a namespace</a></li>
<li class="level4"><a href="#namespaces-delete">Delete a namespace</a></li>
<li class="level4"><a href="#namespaces-remove-redundant">Remove unnecessary namespace declarations</a></li>
<li class="level4"><a href="#namespaces-insert-issue">Insert node with namespace prefix</a></li>
</ul></li>
<li class="level3"><a href="#namespaces-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#display-namespace-nodes-in-clark-notation">Display namespace nodes in <q>Clark notation</q></a></li>
<li class="level4"><a href="#create-a-soap-envelope">Create a SOAP envelope</a></li>
</ul></li>
</ul></li>
<li id="in-toc-error-messages" class="level2"><a href="#error-messages">Error messages</a>
<ul class="level3">
<li class="level3"><a href="#error-no-output-and-no-error">(No output and no error)</a></li>
<li class="level3"><a href="#error-edit-usage-reminder">(<code>xmlstarlet edit</code> displays its usage reminder)</a></li>
<li class="level3"><a href="#couldnt-read-file">couldn’t read file</a></li>
<li class="level3"><a href="#failed-to-load-external-entity">failed to load external entity</a></li>
<li class="level3"><a href="#error-fixme-cant-delete-namespace-nodes">FIXME: can’t delete namespace nodes</a></li>
<li class="level3"><a href="#error-fixme-cant-move-namespace-nodes">FIXME: can’t move namespace nodes</a></li>
<li class="level3"><a href="#error-invalid-context-position-invalid-context-size">Invalid context position / Invalid context size</a></li>
<li class="level3"><a href="#error-move-destination-is-not-a-single-node">move destination is not a single node</a></li>
<li class="level3"><a href="#error-namespace-prefix-not-defined">Namespace prefix «name» … is not defined</a></li>
<li class="level3"><a href="#error-undefined-namespace-prefix">Undefined namespace prefix</a></li>
<li class="level3"><a href="#warning-unrecognized-option-option">Warning: unrecognized option «option»</a></li>
<li class="level3"><a href="#xmlsax2characters-huge-text-node-out-of-memory">xmlSAX2Characters: huge text node: out of memory</a></li>
<li class="level3"><a href="#error-xmlxpathcompopeval-function-name-bound-to-undefined-prefix-name">xmlXPathCompOpEval: function «name» bound to undefined prefix «name»</a></li>
<li class="level3"><a href="#error-xmlxpathcompopeval-function-name-not-found">xmlXPathCompOpEval: function «name» not found</a></li>
<li class="level3"><a href="#error-xsl-extension-element-prefix-undefined-namespace-name">xsl:extension-element-prefix : undefined namespace «name»</a></li>
<li class="level3"><a href="#error-xsltparsestylesheettop-unknown-name-element">xsltParseStylesheetTop: unknown «name» element</a></li>
</ul></li>
<li id="in-toc-exslt" class="level2"><a href="#exslt">EXSLT and other extensions</a>
<ul class="level3">
<li class="level3"><a href="#exslt-functions-and-elements">EXSLT functions and elements</a></li>
<li class="level3"><a href="#extensions-not-found-in-exslt-documentation">Extensions not found in EXSLT documentation</a></li>
<li class="level3"><a href="#exslt-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#compute-xml-tree-height">Compute XML tree height</a></li>
<li class="level4"><a href="#xml-to-csv">XML to CSV</a></li>
<li class="level4"><a href="#from-h2-sections-with-foo-titles-select-div-with-the-most-p-children">From <code>h2</code> sections with <code>foo</code> titles select <code>div</code> with the most <code>p</code> children</a></li>
<li class="level4"><a href="#convert-between-local-and-utc-time">Convert between local and UTC time</a></li>
<li class="level4"><a href="#use-setleading-and-settrailing">Use <code>set:leading</code> and <code>set:trailing</code></a></li>
<li class="level4"><a href="#generate-a-date-sequence">Generate a date sequence</a></li>
<li class="level4"><a href="#group-by-element-name-and-merge-text">Group by element name and merge text</a></li>
</ul></li>
</ul></li>
<li id="in-toc-code-generation" class="level2"><a href="#code-generation">Code generation</a>
<ul class="level3">
<li class="level3"><a href="#select-as-edit-script-generator"><code>select</code> as <code>edit</code> script generator</a></li>
<li class="level3"><a href="#code-generation-edit-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#rename-elements">Rename elements</a></li>
<li class="level4"><a href="#remove-all-but-the-latest-member-of-each-group">Remove all but the latest member of each group</a></li>
<li class="level4"><a href="#translate-xliff-file">Translate XLIFF file</a></li>
</ul></li>
<li class="level3"><a href="#select-as-xslt-stylesheet-generator"><code>select</code> as XSLT stylesheet generator</a>
<ul class="level4">
<li class="level4"><a href="#spell-it-out">Spell it out</a></li>
<li class="level4"><a href="#next-step-dont-repeat-yourself">Next step: don’t repeat yourself</a></li>
</ul></li>
<li class="level3"><a href="#code-generation-xslt-examples">Examples</a>
<ul class="level4">
<li class="level4"><a href="#create-multiple-result-documents">Create multiple result documents</a></li>
</ul></li>
</ul></li>
<li id="in-toc-appendix-a-xmlstarlet-xslt-extensions" class="level2"><a href="#appendix-a-xmlstarlet-xslt-extensions">Appendix A: <code>xmlstarlet</code> XSLT extensions</a></li>
<li id="in-toc-appendix-b-xmlstarlet-news-summary" class="level2"><a href="#appendix-b-xmlstarlet-news-summary">Appendix B: <code>xmlstarlet</code> news summary</a></li>
<li id="in-toc-appendix-c-xmlstarlet-wishlist-ad-2003" class="level2"><a href="#appendix-c-xmlstarlet-wishlist-ad-2003">Appendix C: <code>xmlstarlet</code> wishlist AD 2003</a></li>
<li id="in-toc-toc" class="level2"><a href="#toc">Table of contents</a></li>
</ul></li>
</ul></section>
<hr/>
</section>
</body>
</html>